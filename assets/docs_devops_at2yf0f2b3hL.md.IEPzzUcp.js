import{_ as n,a,o as l,a3 as p}from"./chunks/framework.dRMRuUHH.js";const b=JSON.parse('{"title":"更新kubernetes集群证书","description":"","frontmatter":{"id":2,"title":"更新kubernetes集群证书","createTime":"2023-08-08 18:30:16","category":"devops"},"headers":[],"relativePath":"docs/devops/at2yf0f2b3hL.md","filePath":"docs/devops/00201_update_expired_certificates.md"}'),e={name:"docs/devops/at2yf0f2b3hL.md"};function o(c,s,r,t,F,y){return l(),a("div",null,[...s[0]||(s[0]=[p(`<h2 id="使用说明" tabindex="-1">使用说明 <a class="header-anchor" href="#使用说明" aria-label="Permalink to “使用说明”">​</a></h2><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>该脚本只适用于<code>kubeadm</code>部署的环境, 更新后证书有效期为10年</p></div><p>执行脚本更新证书过期时间</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#A6E22E;">./update_certs_expiration</span><span style="color:#F8F8F2;"> [all </span><span style="color:#F92672;">|</span><span style="color:#A6E22E;"> etcd</span><span style="color:#F92672;">|</span><span style="color:#A6E22E;"> other]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="脚本内容" tabindex="-1">脚本内容 <a class="header-anchor" href="#脚本内容" aria-label="Permalink to “脚本内容”">​</a></h2><p><code>update_certs_expiration.sh</code></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">#!/bin/bash</span></span>
<span class="line"><span style="color:#88846F;"># set -x</span></span>
<span class="line"><span style="color:#66D9EF;">set</span><span style="color:#AE81FF;"> -e</span></span>
<span class="line"><span style="color:#66D9EF;">set</span><span style="color:#AE81FF;"> -o</span><span style="color:#E6DB74;"> pipefail</span></span>
<span class="line"><span style="color:#88846F;"># define expiration time</span></span>
<span class="line"><span style="color:#F8F8F2;">EXP</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">3650</span></span>
<span class="line"><span style="color:#88846F;"># define path of cert and kubeconfig</span></span>
<span class="line"><span style="color:#F8F8F2;">PATH_TMP</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;/tmp&quot;</span></span>
<span class="line"><span style="color:#88846F;">#PATH_BASE=&quot;./kubernetes&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">PATH_BASE</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;/etc/kubernetes&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">PATH_PKI</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">PATH_BASE</span><span style="color:#E6DB74;">}/pki&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">PATH_ETCD</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">PATH_PKI</span><span style="color:#E6DB74;">}/etcd&quot;</span></span>
<span class="line"><span style="color:#88846F;"># define ca cert</span></span>
<span class="line"><span style="color:#F8F8F2;">CERT_CA</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">PATH_PKI</span><span style="color:#E6DB74;">}/ca.crt&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">CERT_CA_ETCD</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">PATH_ETCD</span><span style="color:#E6DB74;">}/ca.crt&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">CERT_CA_FRONT_PROXY</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">PATH_PKI</span><span style="color:#E6DB74;">}/front-proxy-ca.crt&quot;</span></span>
<span class="line"><span style="color:#88846F;"># define cert</span></span>
<span class="line"><span style="color:#F8F8F2;">CERT_APISERVER</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">PATH_PKI</span><span style="color:#E6DB74;">}/apiserver.crt&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">CERT_APISERVER_ETCD_CLIENT</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">PATH_PKI</span><span style="color:#E6DB74;">}/apiserver-etcd-client.crt&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">CERT_APISERVER_KUBELET_CLIENT</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">PATH_PKI</span><span style="color:#E6DB74;">}/apiserver-kubelet-client.crt&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">CERT_FRONT_PROXY_CLIENT</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">PATH_PKI</span><span style="color:#E6DB74;">}/front-proxy-client.crt&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">CERT_HEALTHCHECK_CLIENT</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">PATH_ETCD</span><span style="color:#E6DB74;">}/healthcheck-client.crt&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">CERT_PEER</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">PATH_ETCD</span><span style="color:#E6DB74;">}/peer.crt&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">CERT_SERVER</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">PATH_ETCD</span><span style="color:#E6DB74;">}/server.crt&quot;</span></span>
<span class="line"><span style="color:#88846F;"># define kubeconfig</span></span>
<span class="line"><span style="color:#F8F8F2;">CONF_ADMIN</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">PATH_BASE</span><span style="color:#E6DB74;">}/admin.conf&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">CONF_CONTROLLER_MANAGER</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">PATH_BASE</span><span style="color:#E6DB74;">}/controller-manager.conf&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">CONF_SCHEDULER</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">PATH_BASE</span><span style="color:#E6DB74;">}/scheduler.conf&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">CONF_KUBE_USER</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">HOME</span><span style="color:#E6DB74;">}/.kube/config&quot;</span></span>
<span class="line"><span style="color:#88846F;"># define group of cert or kubeconfig</span></span>
<span class="line"><span style="color:#F8F8F2;">ITEMS_CERT_KUBE</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">ITEMS_CONF_KUBE</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">ITEMS_CERT_FRONT_PROXY</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">ITEMS_CERT_ETCD</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#88846F;"># info logger</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> log_info</span><span style="color:#F8F8F2;">(){</span></span>
<span class="line"><span style="color:#66D9EF;">    echo</span><span style="color:#AE81FF;"> -e</span><span style="color:#E6DB74;"> &quot;\\033[37m$(</span><span style="color:#A6E22E;">date</span><span style="color:#E6DB74;"> +&#39;%Y-%m-%d %T&#39;) [INFO] \${</span><span style="color:#F92672;">@</span><span style="color:#E6DB74;">}\\033[0m&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#88846F;"># error logger</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> log_err</span><span style="color:#F8F8F2;">(){</span></span>
<span class="line"><span style="color:#66D9EF;">    echo</span><span style="color:#AE81FF;"> -e</span><span style="color:#E6DB74;"> &quot;\\033[31m$(</span><span style="color:#A6E22E;">date</span><span style="color:#E6DB74;"> +&#39;%Y-%m-%d %T&#39;) [ERROR] \${</span><span style="color:#F92672;">@</span><span style="color:#E6DB74;">}\\033[0m&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#88846F;"># backup file or directory</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> backup</span><span style="color:#F8F8F2;">(){</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> src</span><span style="color:#F92672;">=</span><span style="color:#FD971F;font-style:italic;">\${1}</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> dest</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">src</span><span style="color:#E6DB74;">}_bak_$(</span><span style="color:#A6E22E;">date</span><span style="color:#E6DB74;"> +&#39;%Y%m%d_%H%M&#39;)&quot;</span></span>
<span class="line"><span style="color:#A6E22E;">    log_info</span><span style="color:#E6DB74;"> &quot;backup \${</span><span style="color:#F8F8F2;">src</span><span style="color:#E6DB74;">} start ...&quot;</span></span>
<span class="line"><span style="color:#F92672;">    if</span><span style="color:#F8F8F2;"> [[ </span><span style="color:#F92672;">-e</span><span style="color:#F8F8F2;"> \${src} </span><span style="color:#F92672;">&amp;&amp;</span><span style="color:#F92672;"> !</span><span style="color:#F92672;"> -e</span><span style="color:#F8F8F2;"> \${dest} ]];</span><span style="color:#F92672;">then</span></span>
<span class="line"><span style="color:#A6E22E;">        cp</span><span style="color:#AE81FF;"> -a</span><span style="color:#F8F8F2;"> \${src} \${dest}</span></span>
<span class="line"><span style="color:#A6E22E;">        log_info</span><span style="color:#E6DB74;"> &quot;backup \${</span><span style="color:#F8F8F2;">src</span><span style="color:#E6DB74;">} to \${</span><span style="color:#F8F8F2;">dest</span><span style="color:#E6DB74;">} complete.&quot;</span></span>
<span class="line"><span style="color:#F92672;">    else</span></span>
<span class="line"><span style="color:#A6E22E;">        log_err</span><span style="color:#E6DB74;"> &quot;\${</span><span style="color:#F8F8F2;">src</span><span style="color:#E6DB74;">} is not exists or \${</span><span style="color:#F8F8F2;">dest</span><span style="color:#E6DB74;">} is exists&quot;</span></span>
<span class="line"><span style="color:#66D9EF;">        exit</span></span>
<span class="line"><span style="color:#F92672;">    fi</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#88846F;"># set group of cert or kubeconfig </span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> set_group</span><span style="color:#F8F8F2;">(){</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> itype</span><span style="color:#F92672;">=</span><span style="color:#FD971F;font-style:italic;">\${1}</span></span>
<span class="line"><span style="color:#F92672;">    if</span><span style="color:#F8F8F2;"> [[ \${itype} </span><span style="color:#F92672;">=</span><span style="color:#E6DB74;"> &quot;etcd&quot;</span><span style="color:#F8F8F2;"> ]];</span><span style="color:#F92672;">then</span></span>
<span class="line"><span style="color:#F8F8F2;">        ITEMS_CERT_ETCD</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">(\${CERT_APISERVER_ETCD_CLIENT} \${CERT_HEALTHCHECK_CLIENT} \${CERT_PEER} \${CERT_SERVER})</span></span>
<span class="line"><span style="color:#F92672;">    elif</span><span style="color:#F8F8F2;"> [[ \${itype} </span><span style="color:#F92672;">=</span><span style="color:#E6DB74;"> &quot;other&quot;</span><span style="color:#F8F8F2;"> ]]; </span><span style="color:#F92672;">then</span></span>
<span class="line"><span style="color:#F8F8F2;">        ITEMS_CERT_KUBE</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">(\${CERT_APISERVER} \${CERT_APISERVER_KUBELET_CLIENT})</span></span>
<span class="line"><span style="color:#F8F8F2;">        ITEMS_CONF_KUBE</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">(\${CONF_ADMIN} \${CONF_CONTROLLER_MANAGER} \${CONF_SCHEDULER})</span></span>
<span class="line"><span style="color:#F8F8F2;">        ITEMS_CERT_FRONT_PROXY</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">(\${CERT_FRONT_PROXY_CLIENT})</span></span>
<span class="line"><span style="color:#F92672;">    else</span></span>
<span class="line"><span style="color:#F8F8F2;">        ITEMS_CERT_KUBE</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">(\${CERT_APISERVER} \${CERT_APISERVER_KUBELET_CLIENT})</span></span>
<span class="line"><span style="color:#F8F8F2;">        ITEMS_CONF_KUBE</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">(\${CONF_ADMIN} \${CONF_CONTROLLER_MANAGER} \${CONF_SCHEDULER})</span></span>
<span class="line"><span style="color:#F8F8F2;">        ITEMS_CERT_FRONT_PROXY</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">(\${CERT_FRONT_PROXY_CLIENT})</span></span>
<span class="line"><span style="color:#F8F8F2;">        ITEMS_CERT_ETCD</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">(\${CERT_APISERVER_ETCD_CLIENT} \${CERT_HEALTHCHECK_CLIENT} \${CERT_PEER} \${CERT_SERVER})</span></span>
<span class="line"><span style="color:#F92672;">    fi</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> get_help_etcd</span><span style="color:#F8F8F2;">(){</span></span>
<span class="line"><span style="color:#88846F;">    # param $1: tree/format</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> style</span><span style="color:#F92672;">=</span><span style="color:#FD971F;font-style:italic;">\${1}</span></span>
<span class="line"><span style="color:#F92672;">    if</span><span style="color:#F8F8F2;"> [[ \${style} </span><span style="color:#F92672;">=</span><span style="color:#E6DB74;"> &quot;tree&quot;</span><span style="color:#F8F8F2;"> ]]; </span><span style="color:#F92672;">then</span></span>
<span class="line"><span style="color:#66D9EF;">        echo</span><span style="color:#E6DB74;"> &quot;\${</span><span style="color:#F8F8F2;">PATH_BASE</span><span style="color:#E6DB74;">}</span></span>
<span class="line"><span style="color:#E6DB74;">    ├── pki</span></span>
<span class="line"><span style="color:#E6DB74;">    │   ├── apiserver-etcd-client.crt</span></span>
<span class="line"><span style="color:#E6DB74;">    │   ├── etcd</span></span>
<span class="line"><span style="color:#E6DB74;">    │   │   ├── healthcheck-client.crt</span></span>
<span class="line"><span style="color:#E6DB74;">    │   │   ├── peer.crt</span></span>
<span class="line"><span style="color:#E6DB74;">    │   │   ├── server.crt&quot;</span></span>
<span class="line"><span style="color:#F92672;">    else</span></span>
<span class="line"><span style="color:#F92672;">        for</span><span style="color:#F8F8F2;"> item </span><span style="color:#F92672;">in</span><span style="color:#F8F8F2;"> \${ITEMS_CERT_ETCD[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]}</span></span>
<span class="line"><span style="color:#F92672;">        do</span></span>
<span class="line"><span style="color:#66D9EF;">            printf</span><span style="color:#E6DB74;"> &quot;%-16s%-10s\\n&quot;</span><span style="color:#E6DB74;"> &quot;&quot;</span><span style="color:#E6DB74;"> &quot;\${</span><span style="color:#F8F8F2;">item</span><span style="color:#E6DB74;">}&quot;</span></span>
<span class="line"><span style="color:#F92672;">        done</span></span>
<span class="line"><span style="color:#F92672;">    fi</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> get_help_other</span><span style="color:#F8F8F2;">(){</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> style</span><span style="color:#F92672;">=</span><span style="color:#FD971F;font-style:italic;">$1</span></span>
<span class="line"><span style="color:#F92672;">    if</span><span style="color:#F8F8F2;"> [[ \${style} </span><span style="color:#F92672;">=</span><span style="color:#E6DB74;"> &quot;tree&quot;</span><span style="color:#F8F8F2;"> ]]; </span><span style="color:#F92672;">then</span></span>
<span class="line"><span style="color:#66D9EF;">        echo</span><span style="color:#E6DB74;"> &quot;\${</span><span style="color:#F8F8F2;">PATH_BASE</span><span style="color:#E6DB74;">}</span></span>
<span class="line"><span style="color:#E6DB74;">    ├── admin.conf</span></span>
<span class="line"><span style="color:#E6DB74;">    ├── controller-manager.conf</span></span>
<span class="line"><span style="color:#E6DB74;">    ├── pki</span></span>
<span class="line"><span style="color:#E6DB74;">    │   ├── apiserver.crt</span></span>
<span class="line"><span style="color:#E6DB74;">    │   ├── apiserver-kubelet-client.crt</span></span>
<span class="line"><span style="color:#E6DB74;">    │   ├── front-proxy-client.crt</span></span>
<span class="line"><span style="color:#E6DB74;">    └── scheduler.conf&quot;</span></span>
<span class="line"><span style="color:#F92672;">    else</span></span>
<span class="line"><span style="color:#F8F8F2;">        items</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">(\${ITEMS_CERT_KUBE[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]} \${ITEMS_CERT_FRONT_PROXY[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]} \${ITEMS_CONF_KUBE[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]})</span></span>
<span class="line"><span style="color:#F92672;">        for</span><span style="color:#F8F8F2;"> item </span><span style="color:#F92672;">in</span><span style="color:#F8F8F2;"> \${items[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]}</span></span>
<span class="line"><span style="color:#F92672;">        do</span></span>
<span class="line"><span style="color:#66D9EF;">            printf</span><span style="color:#E6DB74;"> &quot;%-16s%-10s\\n&quot;</span><span style="color:#E6DB74;"> &quot;&quot;</span><span style="color:#E6DB74;"> &quot;\${</span><span style="color:#F8F8F2;">item</span><span style="color:#E6DB74;">}&quot;</span></span>
<span class="line"><span style="color:#F92672;">        done</span></span>
<span class="line"><span style="color:#F92672;">    fi</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> get_help_all</span><span style="color:#F8F8F2;">(){</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> style</span><span style="color:#F92672;">=</span><span style="color:#FD971F;font-style:italic;">$1</span></span>
<span class="line"><span style="color:#F92672;">    if</span><span style="color:#F8F8F2;"> [[ \${style} </span><span style="color:#F92672;">=</span><span style="color:#E6DB74;"> &quot;tree&quot;</span><span style="color:#F8F8F2;"> ]]; </span><span style="color:#F92672;">then</span></span>
<span class="line"><span style="color:#66D9EF;">        echo</span><span style="color:#E6DB74;"> &quot;\${</span><span style="color:#F8F8F2;">PATH_BASE</span><span style="color:#E6DB74;">}</span></span>
<span class="line"><span style="color:#E6DB74;">    ├── admin.conf</span></span>
<span class="line"><span style="color:#E6DB74;">    ├── controller-manager.conf</span></span>
<span class="line"><span style="color:#E6DB74;">    ├── kubelet.conf</span></span>
<span class="line"><span style="color:#E6DB74;">    ├── pki</span></span>
<span class="line"><span style="color:#E6DB74;">    │   ├── apiserver.crt</span></span>
<span class="line"><span style="color:#E6DB74;">    │   ├── apiserver-etcd-client.crt</span></span>
<span class="line"><span style="color:#E6DB74;">    │   ├── apiserver-kubelet-client.crt</span></span>
<span class="line"><span style="color:#E6DB74;">    │   ├── etcd</span></span>
<span class="line"><span style="color:#E6DB74;">    │   │   ├── healthcheck-client.crt</span></span>
<span class="line"><span style="color:#E6DB74;">    │   │   ├── peer.crt</span></span>
<span class="line"><span style="color:#E6DB74;">    │   │   ├── server.crt</span></span>
<span class="line"><span style="color:#E6DB74;">    │   ├── front-proxy-client.crt</span></span>
<span class="line"><span style="color:#E6DB74;">    └── scheduler.conf&quot;</span></span>
<span class="line"><span style="color:#F92672;">    else</span></span>
<span class="line"><span style="color:#F8F8F2;">        items</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">(\${ITEMS_CERT_KUBE[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]} \${ITEMS_CONF_KUBE[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]} \${ITEMS_CERT_FRONT_PROXY[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]} \${ITEMS_CERT_ETCD[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]})</span></span>
<span class="line"><span style="color:#F92672;">        for</span><span style="color:#F8F8F2;"> item </span><span style="color:#F92672;">in</span><span style="color:#F8F8F2;"> \${items[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]}</span></span>
<span class="line"><span style="color:#F92672;">        do</span></span>
<span class="line"><span style="color:#66D9EF;">            printf</span><span style="color:#E6DB74;"> &quot;%-16s%-10s\\n&quot;</span><span style="color:#E6DB74;"> &quot;&quot;</span><span style="color:#E6DB74;"> &quot;\${</span><span style="color:#F8F8F2;">item</span><span style="color:#E6DB74;">}&quot;</span></span>
<span class="line"><span style="color:#F92672;">        done</span></span>
<span class="line"><span style="color:#F92672;">    fi</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> get_help</span><span style="color:#F8F8F2;">(){</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> cname</span><span style="color:#F92672;">=</span><span style="color:#FD971F;font-style:italic;">\${1}</span></span>
<span class="line"><span style="color:#66D9EF;">    echo</span><span style="color:#E6DB74;"> &quot;Usage: \${</span><span style="color:#F8F8F2;">cname</span><span style="color:#E6DB74;">} command&quot;</span></span>
<span class="line"><span style="color:#66D9EF;">    echo</span><span style="color:#E6DB74;"> &quot;Commands:&quot;</span></span>
<span class="line"><span style="color:#66D9EF;">    echo</span><span style="color:#AE81FF;"> -e</span><span style="color:#E6DB74;"> &quot;\\tetcd\\tUpdate etcd certificates, will update:&quot;</span></span>
<span class="line"><span style="color:#A6E22E;">    get_help_etcd</span></span>
<span class="line"><span style="color:#66D9EF;">    echo</span><span style="color:#AE81FF;"> -e</span><span style="color:#E6DB74;"> &quot;\\tother\\tUpdate api,kube proxy, admin, controller manager, scheduler certificates, will update:&quot;</span></span>
<span class="line"><span style="color:#A6E22E;">    get_help_other</span><span style="color:#F8F8F2;"> </span></span>
<span class="line"><span style="color:#66D9EF;">    echo</span><span style="color:#AE81FF;"> -e</span><span style="color:#E6DB74;"> &quot;\\tall\\tinclude command etcd and other, will update:&quot;</span></span>
<span class="line"><span style="color:#A6E22E;">    get_help_all</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#88846F;"># check file is exists and has read permission</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> check_file_perm</span><span style="color:#F8F8F2;">(){</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> item</span><span style="color:#F92672;">=</span><span style="color:#FD971F;font-style:italic;">\${1}</span></span>
<span class="line"><span style="color:#F92672;">    if</span><span style="color:#F8F8F2;"> [[ </span><span style="color:#F92672;">-r</span><span style="color:#F8F8F2;"> \${item} ]];</span><span style="color:#F92672;">then</span></span>
<span class="line"><span style="color:#A6E22E;">        log_info</span><span style="color:#E6DB74;"> &quot;\${</span><span style="color:#F8F8F2;">item</span><span style="color:#E6DB74;">} exists and read permission is granted.&quot;</span></span>
<span class="line"><span style="color:#F92672;">    else</span></span>
<span class="line"><span style="color:#A6E22E;">        log_err</span><span style="color:#E6DB74;"> &quot;\${</span><span style="color:#F8F8F2;">item</span><span style="color:#E6DB74;">} not exists or read permission is not granted.&quot;</span></span>
<span class="line"><span style="color:#66D9EF;">        exit</span><span style="color:#AE81FF;"> 1</span></span>
<span class="line"><span style="color:#F92672;">    fi</span></span>
<span class="line"><span style="color:#88846F;">    # if [[ ! -r \${item} ]];then</span></span>
<span class="line"><span style="color:#88846F;">    #     log_err &quot;\${item} not exists or read permission is not granted.&quot;</span></span>
<span class="line"><span style="color:#88846F;">    #     exit 1</span></span>
<span class="line"><span style="color:#88846F;">    # fi</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#88846F;"># execute task of check file</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> task_check_file_perm</span><span style="color:#F8F8F2;">(){</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> items</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> key</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;&quot;</span></span>
<span class="line"><span style="color:#A6E22E;">    log_info</span><span style="color:#E6DB74;"> &quot;check file perm start ...&quot;</span></span>
<span class="line"><span style="color:#88846F;">    # add cert and conf items</span></span>
<span class="line"><span style="color:#F8F8F2;">    items</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">(\${ITEMS_CERT_KUBE[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]} \${ITEMS_CERT_ETCD[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]} \${ITEMS_CERT_FRONT_PROXY[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]} \${ITEMS_CONF_KUBE[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]})</span></span>
<span class="line"><span style="color:#88846F;">    # add ca cert items</span></span>
<span class="line"><span style="color:#F92672;">    if</span><span style="color:#F8F8F2;"> [[ \${</span><span style="color:#F92672;">#</span><span style="color:#F8F8F2;">ITEMS_CERT_FRONT_PROXY[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]} </span><span style="color:#F92672;">-gt</span><span style="color:#AE81FF;"> 0</span><span style="color:#F8F8F2;"> ]]; </span><span style="color:#F92672;">then</span><span style="color:#F8F8F2;">  items</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">($CERT_CA_FRONT_PROXY \${items[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]}) ;</span><span style="color:#F92672;">fi</span></span>
<span class="line"><span style="color:#F92672;">    if</span><span style="color:#F8F8F2;"> [[ \${</span><span style="color:#F92672;">#</span><span style="color:#F8F8F2;">ITEMS_CERT_ETCD[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]} </span><span style="color:#F92672;">-gt</span><span style="color:#AE81FF;"> 0</span><span style="color:#F8F8F2;"> ]]; </span><span style="color:#F92672;">then</span><span style="color:#F8F8F2;">  items</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">($CERT_CA_ETCD \${items[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]}) ;</span><span style="color:#F92672;">fi</span></span>
<span class="line"><span style="color:#F92672;">    if</span><span style="color:#F8F8F2;"> [[ \${</span><span style="color:#F92672;">#</span><span style="color:#F8F8F2;">ITEMS_CERT_KUBE[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]} </span><span style="color:#F92672;">-gt</span><span style="color:#AE81FF;"> 0</span><span style="color:#F8F8F2;"> ]]; </span><span style="color:#F92672;">then</span><span style="color:#F8F8F2;">  items</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">($CERT_CA \${items[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]}) ;</span><span style="color:#F92672;">fi</span></span>
<span class="line"><span style="color:#88846F;">    # check cert items</span></span>
<span class="line"><span style="color:#F92672;">    for</span><span style="color:#F8F8F2;"> item </span><span style="color:#F92672;">in</span><span style="color:#F8F8F2;"> \${items[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]}</span></span>
<span class="line"><span style="color:#F92672;">    do</span></span>
<span class="line"><span style="color:#F92672;">        case</span><span style="color:#F8F8F2;"> \${item</span><span style="color:#F92672;">##*</span><span style="color:#F8F8F2;">.} </span><span style="color:#F92672;">in</span></span>
<span class="line"><span style="color:#E6DB74;">        crt</span><span style="color:#F92672;">)</span></span>
<span class="line"><span style="color:#A6E22E;">            check_file_perm</span><span style="color:#E6DB74;"> &quot;\${</span><span style="color:#F8F8F2;">item</span><span style="color:#F92672;">%</span><span style="color:#E6DB74;">.</span><span style="color:#F92672;">*</span><span style="color:#E6DB74;">}.key&quot;</span></span>
<span class="line"><span style="color:#A6E22E;">            check_file_perm</span><span style="color:#F8F8F2;"> \${item}</span></span>
<span class="line"><span style="color:#F8F8F2;">            ;;</span></span>
<span class="line"><span style="color:#E6DB74;">        conf</span><span style="color:#F92672;">)</span></span>
<span class="line"><span style="color:#A6E22E;">            check_file_perm</span><span style="color:#F8F8F2;"> \${item}</span></span>
<span class="line"><span style="color:#F8F8F2;">            ;;</span></span>
<span class="line"><span style="color:#F92672;">        *)</span></span>
<span class="line"><span style="color:#A6E22E;">            log_err</span><span style="color:#E6DB74;"> &quot;valueError&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">            ;;</span></span>
<span class="line"><span style="color:#F92672;">        esac</span></span>
<span class="line"><span style="color:#F92672;">    done</span></span>
<span class="line"><span style="color:#A6E22E;">    log_info</span><span style="color:#E6DB74;"> &quot;check file perm complete.&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#88846F;"># get expiration of cert or kubeconfig</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> get_expiration</span><span style="color:#F8F8F2;">(){</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> item</span><span style="color:#F92672;">=</span><span style="color:#FD971F;font-style:italic;">\${1}</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> ftype</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">\${item</span><span style="color:#F92672;">##*</span><span style="color:#F8F8F2;">.}</span></span>
<span class="line"><span style="color:#F92672;">    case</span><span style="color:#F8F8F2;"> \${ftype} </span><span style="color:#F92672;">in</span></span>
<span class="line"><span style="color:#E6DB74;">    crt</span><span style="color:#F92672;">)</span><span style="color:#F8F8F2;"> </span></span>
<span class="line"><span style="color:#66D9EF;">        echo</span><span style="color:#F8F8F2;"> $(</span><span style="color:#A6E22E;">openssl</span><span style="color:#E6DB74;"> x509</span><span style="color:#AE81FF;"> -in</span><span style="color:#F8F8F2;"> \${item} </span><span style="color:#AE81FF;">-enddate</span><span style="color:#AE81FF;"> -noout</span><span style="color:#F92672;"> |</span><span style="color:#A6E22E;"> sed</span><span style="color:#E6DB74;"> &#39;s/notAfter=//&#39;</span><span style="color:#F8F8F2;">) </span></span>
<span class="line"><span style="color:#F8F8F2;">        ;;</span></span>
<span class="line"><span style="color:#E6DB74;">    conf</span><span style="color:#F92672;">)</span><span style="color:#F8F8F2;"> </span></span>
<span class="line"><span style="color:#66D9EF;">        echo</span><span style="color:#F8F8F2;"> $(</span><span style="color:#A6E22E;">openssl</span><span style="color:#E6DB74;"> x509</span><span style="color:#AE81FF;"> -in</span><span style="color:#E6DB74;"> &lt;(</span><span style="color:#A6E22E;">awk</span><span style="color:#E6DB74;"> &#39;/client-certificate-data/{print $2}&#39; \${</span><span style="color:#F8F8F2;">item</span><span style="color:#E6DB74;">} </span><span style="color:#F92672;">|</span><span style="color:#A6E22E;"> base64</span><span style="color:#AE81FF;"> -d</span><span style="color:#E6DB74;">)</span><span style="color:#AE81FF;"> \\</span></span>
<span class="line"><span style="color:#AE81FF;">        -enddate</span><span style="color:#AE81FF;"> -noout</span><span style="color:#F92672;"> |</span><span style="color:#A6E22E;"> sed</span><span style="color:#E6DB74;"> &#39;s/notAfter=//&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">        ;;</span></span>
<span class="line"><span style="color:#F92672;">    *)</span><span style="color:#F8F8F2;"> </span></span>
<span class="line"><span style="color:#A6E22E;">        log_err</span><span style="color:#E6DB74;"> &quot;ValueError&quot;</span></span>
<span class="line"><span style="color:#66D9EF;">        exit</span><span style="color:#AE81FF;"> 1</span></span>
<span class="line"><span style="color:#F8F8F2;">        ;;</span></span>
<span class="line"><span style="color:#F92672;">    esac</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> get_subj</span><span style="color:#F8F8F2;">(){</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> cert</span><span style="color:#F92672;">=</span><span style="color:#FD971F;font-style:italic;">\${1}</span></span>
<span class="line"><span style="color:#A6E22E;">    openssl</span><span style="color:#E6DB74;"> x509</span><span style="color:#AE81FF;"> -in</span><span style="color:#F8F8F2;"> \${cert} </span><span style="color:#AE81FF;">-noout</span><span style="color:#AE81FF;"> -subject</span><span style="color:#F92672;"> |</span><span style="color:#A6E22E;"> awk</span><span style="color:#E6DB74;">  &#39;{print $2}&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> get_extconf</span><span style="color:#F8F8F2;">(){</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> cert</span><span style="color:#F92672;">=</span><span style="color:#FD971F;font-style:italic;">\${1}</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> extconf</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;[req]\\ndistinguished_name=dn\\n[dn]\\n[v3_ext]\\nkeyUsage=critical,digitalSignature,keyEncipherment\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">    extended_key_usage</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">$(</span><span style="color:#A6E22E;">openssl</span><span style="color:#E6DB74;"> x509</span><span style="color:#AE81FF;"> -in</span><span style="color:#F8F8F2;"> \${cert} </span><span style="color:#AE81FF;">-text</span><span style="color:#F92672;"> |</span><span style="color:#A6E22E;"> grep</span><span style="color:#E6DB74;"> &quot;TLS Web&quot;</span><span style="color:#F92672;"> |</span><span style="color:#A6E22E;"> sed</span><span style="color:#E6DB74;"> &#39;s/[[:space:]]//g&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F92672;">    if</span><span style="color:#F8F8F2;"> [[ \${extended_key_usage} </span><span style="color:#F92672;">=</span><span style="color:#E6DB74;"> &quot;TLSWebClientAuthentication&quot;</span><span style="color:#F8F8F2;"> ]]</span></span>
<span class="line"><span style="color:#F92672;">	then</span></span>
<span class="line"><span style="color:#F8F8F2;">		extconf</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">extconf</span><span style="color:#E6DB74;">}extendedKeyUsage=clientAuth\\n&quot;</span></span>
<span class="line"><span style="color:#F92672;">	elif</span><span style="color:#F8F8F2;"> [[ \${extended_key_usage} </span><span style="color:#F92672;">=</span><span style="color:#E6DB74;"> &quot;TLSWebServerAuthentication&quot;</span><span style="color:#F8F8F2;"> ]]</span></span>
<span class="line"><span style="color:#F92672;">	then</span></span>
<span class="line"><span style="color:#F8F8F2;">		extconf</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">extconf</span><span style="color:#E6DB74;">}extendedKeyUsage=serverAuth\\n&quot;</span></span>
<span class="line"><span style="color:#F92672;">	else</span></span>
<span class="line"><span style="color:#F8F8F2;">		extconf</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">extconf</span><span style="color:#E6DB74;">}extendedKeyUsage=serverAuth,clientAuth\\n&quot;</span></span>
<span class="line"><span style="color:#F92672;">	fi</span></span>
<span class="line"><span style="color:#F8F8F2;">    subject_alt_name</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">$(</span><span style="color:#A6E22E;">openssl</span><span style="color:#E6DB74;"> x509</span><span style="color:#AE81FF;"> -in</span><span style="color:#F8F8F2;"> \${cert} </span><span style="color:#AE81FF;">-text</span><span style="color:#AE81FF;"> -noout</span><span style="color:#F92672;"> |</span><span style="color:#A6E22E;"> grep</span><span style="color:#AE81FF;"> -A1</span><span style="color:#E6DB74;"> &quot;Alternative Name&quot;</span><span style="color:#F92672;"> |</span><span style="color:#A6E22E;"> tail</span><span style="color:#AE81FF;"> -n1</span><span style="color:#F92672;"> |</span><span style="color:#A6E22E;"> sed</span><span style="color:#E6DB74;"> &#39;s/Address//g;s/[[:space:]]//g&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F92672;">    if</span><span style="color:#F8F8F2;"> [[ </span><span style="color:#F92672;">-n</span><span style="color:#F8F8F2;"> \${subject_alt_name} ]];</span><span style="color:#F92672;">then</span></span>
<span class="line"><span style="color:#F8F8F2;">        extconf</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">extconf</span><span style="color:#E6DB74;">}subjectAltName=\${</span><span style="color:#F8F8F2;">subject_alt_name</span><span style="color:#E6DB74;">}&quot;</span></span>
<span class="line"><span style="color:#F92672;">    fi</span></span>
<span class="line"><span style="color:#66D9EF;">    echo</span><span style="color:#E6DB74;"> &quot;\${</span><span style="color:#F8F8F2;">extconf</span><span style="color:#E6DB74;">}&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> update_cert</span><span style="color:#F8F8F2;">(){</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> item</span><span style="color:#F92672;">=</span><span style="color:#FD971F;font-style:italic;">\${1}</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> ftype</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">\${item</span><span style="color:#F92672;">##*</span><span style="color:#F8F8F2;">.}</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> prefix</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">\${item</span><span style="color:#F92672;">%</span><span style="color:#F8F8F2;">.</span><span style="color:#F92672;">*</span><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> fname</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">\${prefix</span><span style="color:#F92672;">##*/</span><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> cert</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;&quot;</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> key</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;&quot;</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> csr</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">PATH_TMP</span><span style="color:#E6DB74;">}/\${</span><span style="color:#F8F8F2;">prefix</span><span style="color:#F92672;">##*/</span><span style="color:#E6DB74;">}.csr&quot;</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> subj</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;&quot;</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> extconf</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;&quot;</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> ca</span><span style="color:#F92672;">=</span><span style="color:#FD971F;font-style:italic;">\${2}</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> cakey</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">ca</span><span style="color:#F92672;">%</span><span style="color:#E6DB74;">.</span><span style="color:#F92672;">*</span><span style="color:#E6DB74;">}.key&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#F92672;">    if</span><span style="color:#F8F8F2;"> [[ \${ftype} </span><span style="color:#F92672;">=</span><span style="color:#E6DB74;"> &quot;crt&quot;</span><span style="color:#F8F8F2;"> ]];</span><span style="color:#F92672;">then</span></span>
<span class="line"><span style="color:#F8F8F2;">        cert</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">\${item}</span></span>
<span class="line"><span style="color:#F8F8F2;">        key</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">prefix</span><span style="color:#E6DB74;">}.key&quot;</span></span>
<span class="line"><span style="color:#F92672;">    elif</span><span style="color:#F8F8F2;"> [[ \${ftype} </span><span style="color:#F92672;">=</span><span style="color:#E6DB74;"> &quot;conf&quot;</span><span style="color:#F8F8F2;"> ]];</span><span style="color:#F92672;">then</span></span>
<span class="line"><span style="color:#F8F8F2;">        key</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">PATH_TMP</span><span style="color:#E6DB74;">}/\${</span><span style="color:#F8F8F2;">fname</span><span style="color:#E6DB74;">}.key&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">        cert</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;\${</span><span style="color:#F8F8F2;">PATH_TMP</span><span style="color:#E6DB74;">}/\${</span><span style="color:#F8F8F2;">fname</span><span style="color:#E6DB74;">}.crt&quot;</span></span>
<span class="line"><span style="color:#A6E22E;">        awk</span><span style="color:#E6DB74;"> &#39;/client-key-data/{print $2}&#39;</span><span style="color:#F8F8F2;"> \${item} </span><span style="color:#F92672;">|</span><span style="color:#A6E22E;"> base64</span><span style="color:#AE81FF;"> -d</span><span style="color:#F92672;"> &gt;</span><span style="color:#F8F8F2;"> \${key}</span></span>
<span class="line"><span style="color:#A6E22E;">        awk</span><span style="color:#E6DB74;"> &#39;/client-certificate-data/{print $2}&#39;</span><span style="color:#F8F8F2;"> \${item} </span><span style="color:#F92672;">|</span><span style="color:#A6E22E;"> base64</span><span style="color:#AE81FF;"> -d</span><span style="color:#F92672;"> &gt;</span><span style="color:#F8F8F2;"> \${cert}</span></span>
<span class="line"><span style="color:#F92672;">    else</span></span>
<span class="line"><span style="color:#A6E22E;">        log_err</span><span style="color:#E6DB74;"> &quot;valueError&quot;</span></span>
<span class="line"><span style="color:#66D9EF;">        exit</span><span style="color:#AE81FF;"> 1</span></span>
<span class="line"><span style="color:#F92672;">    fi</span></span>
<span class="line"><span style="color:#A6E22E;">    openssl</span><span style="color:#E6DB74;"> verify</span><span style="color:#AE81FF;"> -CAfile</span><span style="color:#F8F8F2;"> \${ca} \${cert} </span><span style="color:#F92672;">&gt;</span><span style="color:#E6DB74;"> /dev/null</span></span>
<span class="line"><span style="color:#F8F8F2;">    subj</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">$(</span><span style="color:#A6E22E;">get_subj</span><span style="color:#F8F8F2;"> \${cert})</span></span>
<span class="line"><span style="color:#F8F8F2;">    extconf</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">$(</span><span style="color:#A6E22E;">get_extconf</span><span style="color:#F8F8F2;"> \${cert})</span></span>
<span class="line"><span style="color:#A6E22E;">    openssl</span><span style="color:#E6DB74;"> req</span><span style="color:#AE81FF;"> -new</span><span style="color:#AE81FF;"> -key</span><span style="color:#F8F8F2;"> \${key} </span><span style="color:#AE81FF;">-subj</span><span style="color:#F8F8F2;"> \${subj} </span><span style="color:#AE81FF;">-config</span><span style="color:#E6DB74;"> &lt;(</span><span style="color:#66D9EF;">echo</span><span style="color:#AE81FF;"> -e</span><span style="color:#E6DB74;"> \${</span><span style="color:#F8F8F2;">extconf</span><span style="color:#E6DB74;">})</span><span style="color:#AE81FF;"> -reqexts</span><span style="color:#E6DB74;"> v3_ext</span><span style="color:#AE81FF;"> -out</span><span style="color:#F8F8F2;"> \${csr}</span></span>
<span class="line"><span style="color:#A6E22E;">    openssl</span><span style="color:#E6DB74;"> x509</span><span style="color:#AE81FF;"> -req</span><span style="color:#AE81FF;"> -in</span><span style="color:#F8F8F2;"> \${csr} </span><span style="color:#AE81FF;">-CA</span><span style="color:#F8F8F2;"> \${ca} </span><span style="color:#AE81FF;">-CAkey</span><span style="color:#F8F8F2;"> \${cakey} </span><span style="color:#AE81FF;">-CAcreateserial</span><span style="color:#AE81FF;"> -extensions</span><span style="color:#E6DB74;"> v3_ext</span><span style="color:#AE81FF;"> \\</span></span>
<span class="line"><span style="color:#AE81FF;">    -extfile</span><span style="color:#E6DB74;"> &lt;(</span><span style="color:#66D9EF;">echo</span><span style="color:#AE81FF;"> -e</span><span style="color:#E6DB74;"> \${</span><span style="color:#F8F8F2;">extconf</span><span style="color:#E6DB74;">})</span><span style="color:#AE81FF;"> -days</span><span style="color:#F8F8F2;"> \${EXP} </span><span style="color:#AE81FF;">-out</span><span style="color:#F8F8F2;"> \${cert} </span><span style="color:#F92672;">&gt;</span><span style="color:#E6DB74;"> /dev/null</span><span style="color:#F92672;"> 2&gt;&amp;1</span></span>
<span class="line"><span style="color:#A6E22E;">    log_info</span><span style="color:#E6DB74;"> &quot;update cert \${</span><span style="color:#F8F8F2;">cert</span><span style="color:#E6DB74;">} complete.&quot;</span></span>
<span class="line"><span style="color:#F92672;">    if</span><span style="color:#F8F8F2;"> [[ \${ftype} </span><span style="color:#F92672;">=</span><span style="color:#E6DB74;"> &quot;conf&quot;</span><span style="color:#F8F8F2;"> ]];</span><span style="color:#F92672;">then</span></span>
<span class="line"><span style="color:#F8F8F2;">        cert_b64</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">$(</span><span style="color:#A6E22E;">base64</span><span style="color:#AE81FF;"> -w</span><span style="color:#AE81FF;"> 0</span><span style="color:#F8F8F2;"> \${cert})</span></span>
<span class="line"><span style="color:#A6E22E;">        sed</span><span style="color:#AE81FF;"> -i</span><span style="color:#E6DB74;"> &quot;s/client-certificate-data:.*/client-certificate-data: \${</span><span style="color:#F8F8F2;">cert_b64</span><span style="color:#E6DB74;">}/g&quot;</span><span style="color:#F8F8F2;"> \${item}</span></span>
<span class="line"><span style="color:#A6E22E;">        log_info</span><span style="color:#E6DB74;"> &quot;update conf \${</span><span style="color:#F8F8F2;">item</span><span style="color:#E6DB74;">} complete.&quot;</span></span>
<span class="line"><span style="color:#F92672;">    fi</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#88846F;"># execute task of check expiration</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> task_check_expiration</span><span style="color:#F8F8F2;">(){</span></span>
<span class="line"><span style="color:#A6E22E;">    log_info</span><span style="color:#E6DB74;"> &quot;check cert expiration start ...&quot;</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> items</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">(\${ITEMS_CERT_KUBE[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]} \${ITEMS_CERT_ETCD[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]} \${ITEMS_CERT_FRONT_PROXY[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]} \${ITEMS_CONF_KUBE[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]})</span></span>
<span class="line"><span style="color:#F92672;">    for</span><span style="color:#F8F8F2;"> item </span><span style="color:#F92672;">in</span><span style="color:#F8F8F2;"> \${items[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]}</span></span>
<span class="line"><span style="color:#F92672;">    do</span></span>
<span class="line"><span style="color:#66D9EF;">        printf</span><span style="color:#E6DB74;"> &quot;\\033[34m%-50s %-30s\\033[0m\\n&quot;</span><span style="color:#E6DB74;"> &quot;\${</span><span style="color:#F8F8F2;">item</span><span style="color:#E6DB74;">}&quot;</span><span style="color:#E6DB74;"> &quot;$(</span><span style="color:#A6E22E;">get_expiration</span><span style="color:#E6DB74;"> \${</span><span style="color:#F8F8F2;">item</span><span style="color:#E6DB74;">})&quot;</span></span>
<span class="line"><span style="color:#F92672;">    done</span></span>
<span class="line"><span style="color:#A6E22E;">    log_info</span><span style="color:#E6DB74;"> &quot;check cert expiration complete.&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> task_update_cert</span><span style="color:#F8F8F2;">(){</span></span>
<span class="line"><span style="color:#88846F;">    # backup /etc/kubernetes</span></span>
<span class="line"><span style="color:#A6E22E;">    backup</span><span style="color:#F8F8F2;"> \${PATH_BASE}</span></span>
<span class="line"><span style="color:#88846F;">    # backup \${HOME}/.kube/config if exists</span></span>
<span class="line"><span style="color:#F92672;">    if</span><span style="color:#F8F8F2;"> [[ </span><span style="color:#F92672;">-r</span><span style="color:#F8F8F2;"> \${CONF_KUBE_USER} </span><span style="color:#F92672;">&amp;&amp;</span><span style="color:#F8F8F2;"> \${</span><span style="color:#F92672;">#</span><span style="color:#F8F8F2;">ITEMS_CONF_KUBE[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]} </span><span style="color:#F92672;">-gt</span><span style="color:#AE81FF;"> 0</span><span style="color:#F8F8F2;"> ]];</span><span style="color:#F92672;">then</span></span>
<span class="line"><span style="color:#A6E22E;">        backup</span><span style="color:#F8F8F2;"> \${CONF_KUBE_USER}</span></span>
<span class="line"><span style="color:#F92672;">    fi</span></span>
<span class="line"><span style="color:#A6E22E;">    log_info</span><span style="color:#E6DB74;"> &quot;update cert start ...&quot;</span></span>
<span class="line"><span style="color:#88846F;">    # \${ITEMS_CERT_ETCD[@]}</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> items</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">(\${ITEMS_CERT_KUBE[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]} \${ITEMS_CONF_KUBE[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]})</span></span>
<span class="line"><span style="color:#F92672;">    for</span><span style="color:#F8F8F2;"> item </span><span style="color:#F92672;">in</span><span style="color:#F8F8F2;"> \${items[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]}</span></span>
<span class="line"><span style="color:#F92672;">    do</span></span>
<span class="line"><span style="color:#A6E22E;">        update_cert</span><span style="color:#F8F8F2;"> \${item} \${CERT_CA}</span></span>
<span class="line"><span style="color:#F92672;">        if</span><span style="color:#F8F8F2;"> [[ </span><span style="color:#F92672;">-r</span><span style="color:#F8F8F2;"> \${CONF_KUBE_USER} </span><span style="color:#F92672;">&amp;&amp;</span><span style="color:#F8F8F2;"> \${item} </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> \${CONF_ADMIN} ]];</span><span style="color:#F92672;">then</span></span>
<span class="line"><span style="color:#A6E22E;">        cat</span><span style="color:#F8F8F2;"> \${item} </span><span style="color:#F92672;">&gt;</span><span style="color:#E6DB74;"> &quot;\${</span><span style="color:#F8F8F2;">CONF_KUBE_USER</span><span style="color:#E6DB74;">}&quot;</span></span>
<span class="line"><span style="color:#A6E22E;">        log_info</span><span style="color:#E6DB74;"> &quot;copy \${</span><span style="color:#F8F8F2;">item</span><span style="color:#E6DB74;">} to \${</span><span style="color:#F8F8F2;">CONF_KUBE_USER</span><span style="color:#E6DB74;">} complete.&quot;</span></span>
<span class="line"><span style="color:#F92672;">    fi</span></span>
<span class="line"><span style="color:#F92672;">    done</span></span>
<span class="line"><span style="color:#F92672;">    for</span><span style="color:#F8F8F2;"> item </span><span style="color:#F92672;">in</span><span style="color:#F8F8F2;"> \${ITEMS_CERT_ETCD[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]}</span></span>
<span class="line"><span style="color:#F92672;">    do</span></span>
<span class="line"><span style="color:#A6E22E;">        update_cert</span><span style="color:#F8F8F2;"> \${item} \${CERT_CA_ETCD}</span></span>
<span class="line"><span style="color:#F92672;">    done</span></span>
<span class="line"><span style="color:#F92672;">    for</span><span style="color:#F8F8F2;"> item </span><span style="color:#F92672;">in</span><span style="color:#F8F8F2;"> \${ITEMS_CERT_FRONT_PROXY[</span><span style="color:#F92672;">@</span><span style="color:#F8F8F2;">]}</span></span>
<span class="line"><span style="color:#F92672;">    do</span></span>
<span class="line"><span style="color:#A6E22E;">        update_cert</span><span style="color:#F8F8F2;"> \${item} \${CERT_CA_FRONT_PROXY}</span></span>
<span class="line"><span style="color:#F92672;">    done</span></span>
<span class="line"><span style="color:#A6E22E;">    log_info</span><span style="color:#E6DB74;"> &quot;update cert complete.&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> main</span><span style="color:#F8F8F2;">(){</span></span>
<span class="line"><span style="color:#F92672;">    local</span><span style="color:#F8F8F2;"> group</span><span style="color:#F92672;">=</span><span style="color:#FD971F;font-style:italic;">\${1}</span></span>
<span class="line"><span style="color:#A6E22E;">    set_group</span><span style="color:#F8F8F2;"> \${group}</span></span>
<span class="line"><span style="color:#F92672;">    case</span><span style="color:#F8F8F2;"> \${group} </span><span style="color:#F92672;">in</span></span>
<span class="line"><span style="color:#E6DB74;">    etcd</span><span style="color:#F92672;">)</span></span>
<span class="line"><span style="color:#A6E22E;">        log_info</span><span style="color:#E6DB74;"> &quot;this certificates will be update&quot;</span></span>
<span class="line"><span style="color:#A6E22E;">        get_help_etcd</span><span style="color:#E6DB74;"> &quot;tree&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">        ;;</span></span>
<span class="line"><span style="color:#E6DB74;">    other</span><span style="color:#F92672;">)</span></span>
<span class="line"><span style="color:#A6E22E;">        log_info</span><span style="color:#E6DB74;"> &quot;this certificates will be update&quot;</span></span>
<span class="line"><span style="color:#A6E22E;">        get_help_other</span><span style="color:#E6DB74;"> &quot;tree&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">        ;;</span></span>
<span class="line"><span style="color:#E6DB74;">    all</span><span style="color:#F92672;">)</span></span>
<span class="line"><span style="color:#A6E22E;">        log_info</span><span style="color:#E6DB74;"> &quot;this certificates will be update&quot;</span></span>
<span class="line"><span style="color:#A6E22E;">        get_help_all</span><span style="color:#E6DB74;"> &quot;tree&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">        ;;</span></span>
<span class="line"><span style="color:#F92672;">    *)</span></span>
<span class="line"><span style="color:#A6E22E;">        log_err</span><span style="color:#E6DB74;"> &quot;ValueError&quot;</span></span>
<span class="line"><span style="color:#A6E22E;">        get_help</span><span style="color:#FD971F;font-style:italic;"> \${0}</span></span>
<span class="line"><span style="color:#66D9EF;">        exit</span><span style="color:#AE81FF;"> 1</span></span>
<span class="line"><span style="color:#F8F8F2;">        ;;</span></span>
<span class="line"><span style="color:#F92672;">    esac</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    # 1.check certificate or kubeconfig exists and read permission is granted</span></span>
<span class="line"><span style="color:#A6E22E;">    task_check_file_perm</span></span>
<span class="line"><span style="color:#88846F;">    # 2.check expiration of certificate or kubeconfig </span></span>
<span class="line"><span style="color:#A6E22E;">    task_check_expiration</span></span>
<span class="line"><span style="color:#88846F;">    # 3.update expiration of certificate of kubeconfig</span></span>
<span class="line"><span style="color:#A6E22E;">    task_update_cert</span></span>
<span class="line"><span style="color:#A6E22E;">    task_check_expiration</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6E22E;">main</span><span style="color:#FD971F;font-style:italic;"> \${1}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br></div></div>`,7)])])}const E=n(e,[["render",o]]);export{b as __pageData,E as default};
