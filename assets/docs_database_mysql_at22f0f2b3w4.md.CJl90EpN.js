import{_ as n,a,o as l,a3 as p}from"./chunks/framework.dRMRuUHH.js";const b=JSON.parse('{"title":"mysqlä¸»ä»æ¨¡å¼éƒ¨ç½²","description":"","frontmatter":{"id":2201,"title":"mysqlä¸»ä»æ¨¡å¼éƒ¨ç½²","createTime":"2024-03-19 17:22:02","category":"database"},"headers":[],"relativePath":"docs/database/mysql/at22f0f2b3w4.md","filePath":"docs/database/mysql/00501_mysql_master_slave_tutorial.md"}'),e={name:"docs/database/mysql/at22f0f2b3w4.md"};function o(r,s,c,t,i,y){return l(),a("div",null,[...s[0]||(s[0]=[p(`<h2 id="ç¯å¢ƒè¯´æ˜" tabindex="-1">ç¯å¢ƒè¯´æ˜ <a class="header-anchor" href="#ç¯å¢ƒè¯´æ˜" aria-label="Permalink to â€œç¯å¢ƒè¯´æ˜â€">â€‹</a></h2><table tabindex="0"><thead><tr><th>role</th><th>ip</th><th>version</th></tr></thead><tbody><tr><td>master</td><td>192.168.10.12</td><td>mysql-5.7.21</td></tr><tr><td>slave</td><td>192.168.10.13</td><td>mysql-5.7.21</td></tr></tbody></table><h2 id="mysqlåˆå§‹åŒ–é…ç½®" tabindex="-1">mysqlåˆå§‹åŒ–é…ç½® <a class="header-anchor" href="#mysqlåˆå§‹åŒ–é…ç½®" aria-label="Permalink to â€œmysqlåˆå§‹åŒ–é…ç½®â€">â€‹</a></h2><p>æœ¬æ¬¡ç¤ºä¾‹é‡‡ç”¨äºŒè¿›åˆ¶çš„æ–¹å¼éƒ¨ç½²ğŸ‘‰<a href="https://downloads.mysql.com/archives/community/" target="_blank" rel="noreferrer">å®˜ç½‘ä¸‹è½½åœ°å€</a></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># wget https://cdn.mysql.com/archives/mysql-5.7/mysql-5.7.21-linux-glibc2.12-x86_64.tar.gz</span></span>
<span class="line"><span style="color:#A6E22E;">useradd</span><span style="color:#E6DB74;"> mysql</span><span style="color:#AE81FF;"> -s</span><span style="color:#E6DB74;"> /sbin/nologin</span></span>
<span class="line"><span style="color:#A6E22E;">mkdir</span><span style="color:#AE81FF;"> -p</span><span style="color:#E6DB74;"> /workspace/mysql/{data,logs,temp}</span></span>
<span class="line"><span style="color:#A6E22E;">chown</span><span style="color:#E6DB74;"> mysql.mysql</span><span style="color:#AE81FF;"> -R</span><span style="color:#E6DB74;"> /workspace/mysql</span></span>
<span class="line"><span style="color:#A6E22E;">tar</span><span style="color:#AE81FF;"> -zxvf</span><span style="color:#E6DB74;"> mysql-5.7.21-linux-glibc2.12-x86_64.tar.gz</span><span style="color:#AE81FF;"> -C</span><span style="color:#E6DB74;"> /opt/</span></span>
<span class="line"><span style="color:#A6E22E;">ln</span><span style="color:#AE81FF;"> -s</span><span style="color:#E6DB74;"> /opt/mysql-5.7.21-linux-glibc2.12-x86_64</span><span style="color:#E6DB74;"> /usr/local/mysql</span></span>
<span class="line"><span style="color:#A6E22E;">ln</span><span style="color:#AE81FF;"> -s</span><span style="color:#E6DB74;"> /usr/local/mysql/lib</span><span style="color:#E6DB74;"> /usr/lib/mysql</span></span>
<span class="line"><span style="color:#A6E22E;">ln</span><span style="color:#AE81FF;"> -s</span><span style="color:#E6DB74;"> /usr/local/mysql/include/mysql</span><span style="color:#E6DB74;"> /usr/include/mysql</span></span>
<span class="line"><span style="color:#A6E22E;">ln</span><span style="color:#AE81FF;"> -s</span><span style="color:#E6DB74;"> /usr/local/mysql/bin/mysql</span><span style="color:#E6DB74;"> /usr/local/bin/mysql</span></span>
<span class="line"><span style="color:#A6E22E;">ln</span><span style="color:#AE81FF;"> -s</span><span style="color:#E6DB74;"> /usr/local/mysql/bin/mysqlbinlog</span><span style="color:#E6DB74;"> /usr/local/bin/mysqlbinlog</span></span>
<span class="line"><span style="color:#A6E22E;">ln</span><span style="color:#AE81FF;"> -s</span><span style="color:#E6DB74;"> /usr/local/mysql/bin/mysqldump</span><span style="color:#E6DB74;"> /usr/local/bin/mysqldump</span></span>
<span class="line"><span style="color:#A6E22E;">ln</span><span style="color:#AE81FF;"> -s</span><span style="color:#E6DB74;"> /usr/local/mysql/support-files/mysql.server</span><span style="color:#E6DB74;"> /etc/init.d/mysqld</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="masterèŠ‚ç‚¹é…ç½®" tabindex="-1">masterèŠ‚ç‚¹é…ç½® <a class="header-anchor" href="#masterèŠ‚ç‚¹é…ç½®" aria-label="Permalink to â€œmasterèŠ‚ç‚¹é…ç½®â€">â€‹</a></h2><p>step01 ä¿®æ”¹<code>/etc/my.cnf</code>, masterèŠ‚ç‚¹éœ€è¦å¼€å¯<code>binlog</code></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F8F8F2;">[client]</span></span>
<span class="line"><span style="color:#F8F8F2;">port</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">3306</span></span>
<span class="line"><span style="color:#F8F8F2;">socket</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/workspace/mysql/logs/mysqld.sock</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">[mysqld]</span></span>
<span class="line"><span style="color:#88846F;"># server idéœ€è¦å”¯ä¸€</span></span>
<span class="line"><span style="color:#F8F8F2;">server-id</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">1</span></span>
<span class="line"><span style="color:#F8F8F2;">port</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">3306</span></span>
<span class="line"><span style="color:#F8F8F2;">user</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">mysql</span></span>
<span class="line"><span style="color:#F8F8F2;">socket</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/workspace/mysql/logs/mysqld.sock</span></span>
<span class="line"><span style="color:#F8F8F2;">pid-file</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/workspace/mysql/logs/mysqld.pid</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">basedir</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/usr/local/mysql</span></span>
<span class="line"><span style="color:#F8F8F2;">datadir</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/workspace/mysql/data</span></span>
<span class="line"><span style="color:#F8F8F2;">tmpdir</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/workspace/mysql/temp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">default-storage-engine</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">INNODB</span></span>
<span class="line"><span style="color:#F8F8F2;">log-error</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/workspace/mysql/logs/error.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">character-set-server</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">utf8mb4</span></span>
<span class="line"><span style="color:#F8F8F2;">collation-server</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">utf8mb4_unicode_ci</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">max-connections</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">200</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># å¼€å¯binglog</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">log-bin</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/workspace/mysql/logs/mysql-bin</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">sync-binlog</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">1</span></span>
<span class="line"><span style="color:#88846F;"># å¼€å¯å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°ã€è§¦å‘å™¨ç­‰å†…å®¹çš„åŒæ­¥åŠŸèƒ½</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">log-bin-trust-function-creators</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">1</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">binlog-format</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">ROW</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">max-binlog-size</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">256M</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">expire-logs-days</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">30</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># å¼€å¯GTIDå¤åˆ¶,å³slaveåŒæ­¥æ—¶ä¸éœ€è¦è®¾ç½®masterçš„binlogå’Œposition</span></span>
<span class="line"><span style="color:#F8F8F2;">gtid-mode</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">on</span></span>
<span class="line"><span style="color:#88846F;"># è·³è¿‡ä¸€äº›å¯èƒ½å¯¼è‡´æ‰§è¡Œå‡ºé”™çš„SQLè¯­å¥</span></span>
<span class="line"><span style="color:#F8F8F2;">enforce-gtid-consistency</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>step02 åˆå§‹åŒ–ä¸»åº“ï¼Œå¹¶å¯åŠ¨<code>mysqld</code>æœåŠ¡</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#A6E22E;">/usr/local/mysql/bin/mysqld</span><span style="color:#AE81FF;"> --initialize-insecure</span></span>
<span class="line"><span style="color:#A6E22E;">chkconfig</span><span style="color:#AE81FF;"> --add</span><span style="color:#E6DB74;"> mysqld</span></span>
<span class="line"><span style="color:#A6E22E;">chkconfig</span><span style="color:#E6DB74;"> mysqld</span><span style="color:#E6DB74;"> on</span></span>
<span class="line"><span style="color:#A6E22E;">service</span><span style="color:#E6DB74;"> mysqld</span><span style="color:#E6DB74;"> start</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>step03 è®¾ç½®<code>mysql</code>çš„<code>root</code>å¯†ç ï¼Œå¹¶åˆ›å»ºç”¨äºåŒæ­¥æ•°æ®çš„è´¦å·<code>repl</code></p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F92672;">alter</span><span style="color:#F92672;"> user</span><span style="color:#E6DB74;"> &quot;root&quot;</span><span style="color:#F8F8F2;">@</span><span style="color:#E6DB74;">&quot;localhost&quot;</span><span style="color:#F8F8F2;"> identified </span><span style="color:#F92672;">with</span><span style="color:#F8F8F2;"> mysql_native_password </span><span style="color:#F92672;">by</span><span style="color:#E6DB74;"> &quot;root&quot;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">create</span><span style="color:#F92672;"> user</span><span style="color:#F8F8F2;"> &quot;</span><span style="color:#A6E22E;">repl</span><span style="color:#F8F8F2;">&quot;@</span><span style="color:#E6DB74;">&quot;192.168.10.%&quot;</span><span style="color:#F8F8F2;"> identified </span><span style="color:#F92672;">by</span><span style="color:#E6DB74;"> &quot;testfind&quot;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">grant</span><span style="color:#F8F8F2;"> replication slave </span><span style="color:#F92672;">on</span><span style="color:#F92672;"> *</span><span style="color:#F8F8F2;">.</span><span style="color:#F92672;">*</span><span style="color:#F92672;"> to</span><span style="color:#E6DB74;"> &quot;repl&quot;</span><span style="color:#F8F8F2;">@</span><span style="color:#E6DB74;">&quot;192.168.10.%&quot;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">flush privileges;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="slaveèŠ‚ç‚¹é…ç½®" tabindex="-1">slaveèŠ‚ç‚¹é…ç½® <a class="header-anchor" href="#slaveèŠ‚ç‚¹é…ç½®" aria-label="Permalink to â€œslaveèŠ‚ç‚¹é…ç½®â€">â€‹</a></h2><p>step01 ä¿®æ”¹<code>/etc/my.cnf</code>é…ç½®ï¼ŒslaveèŠ‚ç‚¹éœ€è¦å¼€å¯ä¸­ç»§æ—¥å¿—</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F8F8F2;">[client]</span></span>
<span class="line"><span style="color:#F8F8F2;">port</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">3306</span></span>
<span class="line"><span style="color:#F8F8F2;">socket</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/workspace/mysql/logs/mysqld.sock</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">[mysqld]</span></span>
<span class="line"><span style="color:#88846F;"># server idéœ€è¦å”¯ä¸€</span></span>
<span class="line"><span style="color:#F8F8F2;">server-id</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">2</span></span>
<span class="line"><span style="color:#F8F8F2;">port</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">3306</span></span>
<span class="line"><span style="color:#F8F8F2;">user</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">mysql</span></span>
<span class="line"><span style="color:#F8F8F2;">socket</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/workspace/mysql/logs/mysqld.sock</span></span>
<span class="line"><span style="color:#F8F8F2;">pid-file</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/workspace/mysql/logs/mysqld.pid</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">basedir</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/usr/local/mysql</span></span>
<span class="line"><span style="color:#F8F8F2;">datadir</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/workspace/mysql/data</span></span>
<span class="line"><span style="color:#F8F8F2;">tmpdir</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/workspace/mysql/temp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">default-storage-engine</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">INNODB</span></span>
<span class="line"><span style="color:#F8F8F2;">log-error</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/workspace/mysql/logs/error.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">character-set-server</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">utf8mb4</span></span>
<span class="line"><span style="color:#F8F8F2;">collation-server</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">utf8mb4_unicode_ci</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">max-connections</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">200</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># å¼€å¯binglog</span></span>
<span class="line"><span style="color:#F8F8F2;">log-bin</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/workspace/mysql/logs/mysql-bin</span></span>
<span class="line"><span style="color:#F8F8F2;">sync-binlog</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">1</span></span>
<span class="line"><span style="color:#88846F;"># å¼€å¯å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°ã€è§¦å‘å™¨ç­‰å†…å®¹çš„åŒæ­¥åŠŸèƒ½</span></span>
<span class="line"><span style="color:#F8F8F2;">log-bin-trust-function-creators</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">1</span></span>
<span class="line"><span style="color:#F8F8F2;">binlog-format</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">ROW</span></span>
<span class="line"><span style="color:#F8F8F2;">max-binlog-size</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">256M</span></span>
<span class="line"><span style="color:#F8F8F2;">expire-logs-days</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">30</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># å¼€å¯GTIDå¤åˆ¶,å³slaveåŒæ­¥æ—¶ä¸éœ€è¦è®¾ç½®masterçš„binlogå’Œposition</span></span>
<span class="line"><span style="color:#F8F8F2;">gtid-mode</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">on</span></span>
<span class="line"><span style="color:#88846F;"># è·³è¿‡ä¸€äº›å¯èƒ½å¯¼è‡´æ‰§è¡Œå‡ºé”™çš„SQLè¯­å¥</span></span>
<span class="line"><span style="color:#F8F8F2;">enforce-gtid-consistency</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># å¼€å¯relay log</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">relay-log</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/workspace/mysql/logs/relay-bin</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">relay-log-index</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/workspace/mysql/logs/relay-bin.index</span></span>
<span class="line"><span style="color:#88846F;"># åŒæ­¥æ‰§è¡Œè·³è¿‡ä¸€äº›é”™è¯¯ç </span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">slave-skip-errors</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">1062</span></span>
<span class="line"><span style="color:#88846F;"># å¿½ç•¥åŒæ­¥åº“</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">replicate-ignore-db</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">mysql</span><span style="color:#F8F8F2;"> </span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">replicate-ignore-db</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">information_schema</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">replicate-ignore-db</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">performance_schema</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>step02 åˆå§‹åŒ–ä»åº“ï¼Œå¹¶å¯åŠ¨<code>mysqld</code>æœåŠ¡</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#A6E22E;">/usr/local/mysql/bin/mysqld</span><span style="color:#AE81FF;"> --initialize-insecure</span></span>
<span class="line"><span style="color:#A6E22E;">chkconfig</span><span style="color:#AE81FF;"> --add</span><span style="color:#E6DB74;"> mysqld</span></span>
<span class="line"><span style="color:#A6E22E;">chkconfig</span><span style="color:#E6DB74;"> mysqld</span><span style="color:#E6DB74;"> on</span></span>
<span class="line"><span style="color:#A6E22E;">service</span><span style="color:#E6DB74;"> mysqld</span><span style="color:#E6DB74;"> start</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>step03 è®¾ç½®<code>mysql</code>çš„<code>root</code>å¯†ç </p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#A6E22E;">alter</span><span style="color:#E6DB74;"> user</span><span style="color:#E6DB74;"> &quot;root&quot;@&quot;localhost&quot;</span><span style="color:#E6DB74;"> identified</span><span style="color:#E6DB74;"> with</span><span style="color:#E6DB74;"> mysql_native_password</span><span style="color:#E6DB74;"> by</span><span style="color:#E6DB74;"> &quot;root&quot;</span><span style="color:#F8F8F2;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="ä¸»ä»åŒæ­¥" tabindex="-1">ä¸»ä»åŒæ­¥ <a class="header-anchor" href="#ä¸»ä»åŒæ­¥" aria-label="Permalink to â€œä¸»ä»åŒæ­¥â€">â€‹</a></h2><h3 id="åŸºäºbinlogæ¨¡å¼åŒæ­¥" tabindex="-1">åŸºäºbinlogæ¨¡å¼åŒæ­¥ <a class="header-anchor" href="#åŸºäºbinlogæ¨¡å¼åŒæ­¥" aria-label="Permalink to â€œåŸºäºbinlogæ¨¡å¼åŒæ­¥â€">â€‹</a></h3><p>åŸºäºä¼ ç»Ÿçš„äºŒè¿›åˆ¶æ—¥å¿—å¤åˆ¶åŒæ­¥æ¨¡å¼ï¼ŒåŒæ­¥æ—¶éœ€è¦çŸ¥é“æ—¥å¿—æ–‡ä»¶å’Œæ—¥å¿—çš„åç§»é‡</p><p>step01 <code>master</code>æ‰§è¡Œå‘½ä»¤è¡ŒæŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</p><p>å¯ä»¥çœ‹åˆ°ç›®å‰ä¸»åº“ä½¿ç”¨çš„<code>mysql-bin.000002</code>è¿™ä¸ªæ–‡ä»¶ï¼Œ<code>Position</code>ä¸º1013</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F8F8F2;">show </span><span style="color:#F92672;">master</span><span style="color:#F92672;"> status</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#88846F;">-- +------------------+----------+--------------+------------------+-------------------+</span></span>
<span class="line"><span style="color:#88846F;">-- | File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span></span>
<span class="line"><span style="color:#88846F;">-- +------------------+----------+--------------+------------------+-------------------+</span></span>
<span class="line"><span style="color:#88846F;">-- | mysql-bin.000002 |     1013 |              | mysql            |                   |</span></span>
<span class="line"><span style="color:#88846F;">-- +------------------+----------+--------------+------------------+-------------------+</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>step02 <code>slave</code>èŠ‚ç‚¹ä¸Šè®¾ç½®<code>master</code>èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå¹¶å¼€å¯åŒæ­¥</p><p><code>slave</code>ä¼šä»¥å®¢æˆ·ç«¯çš„å½¢å¼è¯·æ±‚<code>master</code>çš„<code>binlog</code>ï¼Œå¹¶å°†æ•°æ®å†™å…¥åˆ°<code>relay log</code>ä¹Ÿå°±æ˜¯ä¸­ç»§æ—¥å¿—ä¸­ï¼Œ<code>slave</code>ä¸­çš„çº¿ç¨‹ä¼šè‡ªåŠ¨è§£æå…¥åº“</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">-- è®¾ç½®masterèŠ‚ç‚¹çš„åœ°å€ã€è´¦å·ã€å¯†ç ã€ç«¯å£ã€æ—¥å¿—æ–‡ä»¶åç§°å’Œ Positionï¼Œå»ºç«‹å’Œmasterçš„è¿æ¥</span></span>
<span class="line"><span style="color:#F8F8F2;">change </span><span style="color:#F92672;">master</span><span style="color:#F92672;"> to</span><span style="color:#F8F8F2;"> master_host</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;192.168.10.12&quot;</span><span style="color:#F8F8F2;">,master_user</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;repl&quot;</span><span style="color:#F8F8F2;">, master_password</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;testfind&quot;</span><span style="color:#F8F8F2;">,master_port</span><span style="color:#F92672;">=</span><span style="color:#AE81FF;">3306</span><span style="color:#F8F8F2;">,master_log_file</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;mysql-bin.000002&quot;</span><span style="color:#F8F8F2;">,master_log_pos</span><span style="color:#F92672;">=</span><span style="color:#AE81FF;">1013</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">-- å¼€å¯slaveåŒæ­¥çº¿ç¨‹</span></span>
<span class="line"><span style="color:#F92672;">start</span><span style="color:#F8F8F2;"> slave;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">-- æŸ¥çœ‹slaveèŠ‚ç‚¹è¿æ¥çŠ¶æ€ï¼Œä¸»è¦å…³æ³¨ Slave_IO_Running å’Œ Slave_SQL_Running çš„å€¼</span></span>
<span class="line"><span style="color:#F8F8F2;">show slave </span><span style="color:#F92672;">status</span><span style="color:#F8F8F2;"> \\G;</span></span>
<span class="line"><span style="color:#88846F;">-- *************************** 1. row ***************************</span></span>
<span class="line"><span style="color:#88846F;">--                Slave_IO_State: Waiting for master to send event</span></span>
<span class="line"><span style="color:#88846F;">--                   Master_Host: 192.168.10.12</span></span>
<span class="line"><span style="color:#88846F;">--                   Master_User: repl</span></span>
<span class="line"><span style="color:#88846F;">--                   Master_Port: 3306</span></span>
<span class="line"><span style="color:#88846F;">--                 Connect_Retry: 60</span></span>
<span class="line"><span style="color:#88846F;">--               Master_Log_File: mysql-bin.000002</span></span>
<span class="line"><span style="color:#88846F;">--           Read_Master_Log_Pos: 1013</span></span>
<span class="line"><span style="color:#88846F;">--                Relay_Log_File: relay-bin.000002</span></span>
<span class="line"><span style="color:#88846F;">--                 Relay_Log_Pos: 320</span></span>
<span class="line"><span style="color:#88846F;">--         Relay_Master_Log_File: mysql-bin.000002</span></span>
<span class="line"><span style="color:#88846F;">--              Slave_IO_Running: Yes</span></span>
<span class="line"><span style="color:#88846F;">--             Slave_SQL_Running: Yes</span></span>
<span class="line"><span style="color:#88846F;">--                              ...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="åŸºäºgtidæ¨¡å¼åŒæ­¥" tabindex="-1">åŸºäºGTIDæ¨¡å¼åŒæ­¥ <a class="header-anchor" href="#åŸºäºgtidæ¨¡å¼åŒæ­¥" aria-label="Permalink to â€œåŸºäºGTIDæ¨¡å¼åŒæ­¥â€">â€‹</a></h3><p>é€šè¿‡<code>gtid</code>ä¿è¯äº†æ¯ä¸ªåœ¨ä¸»åº“ä¸Šæäº¤çš„äº‹åŠ¡åœ¨é›†ç¾¤ä¸­æœ‰ä¸€ä¸ªå”¯ä¸€çš„<code>ID</code>ã€‚è¿™ç§æ–¹å¼å¼ºåŒ–äº†æ•°æ®åº“çš„ä¸»å¤‡ä¸€è‡´æ€§ï¼Œæ•…éšœæ¢å¤ä»¥åŠå®¹é”™èƒ½åŠ›ï¼Œæ˜¯<code>mysql5.6</code>ä¹‹åä¸“é—¨ç”¨äºå¤„ç†ä»åº“å¯»ç‚¹é—®é¢˜å¼•å…¥çš„ä¸€ç§å¤åˆ¶æŠ€æœ¯ã€‚</p><p>step01 <code>slave</code>èŠ‚ç‚¹è®¾ç½®<code>master</code>èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¹¶å¼€å¯åŒæ­¥</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">-- è®¾ç½®masterèŠ‚ç‚¹çš„åœ°å€ã€è´¦å·ã€å¯†ç ã€ç«¯å£ï¼Œå»ºç«‹å’Œmasterçš„è¿æ¥</span></span>
<span class="line"><span style="color:#F8F8F2;">change </span><span style="color:#F92672;">master</span><span style="color:#F92672;"> to</span><span style="color:#F8F8F2;"> master_host</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;192.168.10.12&quot;</span><span style="color:#F8F8F2;">,master_user</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;repl&quot;</span><span style="color:#F8F8F2;">, master_password</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;testfind&quot;</span><span style="color:#F8F8F2;">,master_port</span><span style="color:#F92672;">=</span><span style="color:#AE81FF;">3306</span><span style="color:#F8F8F2;">,master_auto_position</span><span style="color:#F92672;">=</span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">-- å¼€å¯slaveåŒæ­¥çº¿ç¨‹</span></span>
<span class="line"><span style="color:#F92672;">start</span><span style="color:#F8F8F2;"> slave;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">-- æŸ¥çœ‹slaveèŠ‚ç‚¹è¿æ¥çŠ¶æ€ï¼Œä¸»è¦å…³æ³¨ Slave_IO_Running å’Œ Slave_SQL_Running çš„å€¼</span></span>
<span class="line"><span style="color:#F8F8F2;">show slave </span><span style="color:#F92672;">status</span><span style="color:#F8F8F2;"> \\G;</span></span>
<span class="line"><span style="color:#88846F;">-- *************************** 1. row ***************************</span></span>
<span class="line"><span style="color:#88846F;">--                Slave_IO_State: Waiting for master to send event</span></span>
<span class="line"><span style="color:#88846F;">--                   Master_Host: 192.168.10.12</span></span>
<span class="line"><span style="color:#88846F;">--                   Master_User: repl</span></span>
<span class="line"><span style="color:#88846F;">--                   Master_Port: 3306</span></span>
<span class="line"><span style="color:#88846F;">--                 Connect_Retry: 60</span></span>
<span class="line"><span style="color:#88846F;">--               Master_Log_File: mysql-bin.000002</span></span>
<span class="line"><span style="color:#88846F;">--           Read_Master_Log_Pos: 1013</span></span>
<span class="line"><span style="color:#88846F;">--                Relay_Log_File: relay-bin.000002</span></span>
<span class="line"><span style="color:#88846F;">--                 Relay_Log_Pos: 1226</span></span>
<span class="line"><span style="color:#88846F;">--         Relay_Master_Log_File: mysql-bin.000002</span></span>
<span class="line"><span style="color:#88846F;">--              Slave_IO_Running: Yes</span></span>
<span class="line"><span style="color:#88846F;">--             Slave_SQL_Running: Ye</span></span>
<span class="line"><span style="color:#88846F;">--                             ...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="æµ‹è¯•ä¸»ä»åŒæ­¥" tabindex="-1">æµ‹è¯•ä¸»ä»åŒæ­¥ <a class="header-anchor" href="#æµ‹è¯•ä¸»ä»åŒæ­¥" aria-label="Permalink to â€œæµ‹è¯•ä¸»ä»åŒæ­¥â€">â€‹</a></h2><p>step01 åœ¨<code>master</code>èŠ‚ç‚¹ä¸Šåˆ›å»ºæ•°æ®åº“ã€è¡¨å¹¶ä¸”æ’å…¥æ•°æ®</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F92672;">create</span><span style="color:#F92672;"> database</span><span style="color:#A6E22E;"> if</span><span style="color:#F92672;"> not</span><span style="color:#F92672;"> exists</span><span style="color:#F8F8F2;"> db01;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">use</span><span style="color:#F8F8F2;"> db01;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">create</span><span style="color:#F92672;"> table</span><span style="color:#A6E22E;"> if</span><span style="color:#F92672;"> not</span><span style="color:#F92672;"> exists</span><span style="color:#F8F8F2;"> tb01(id </span><span style="color:#66D9EF;font-style:italic;">int</span><span style="color:#F92672;"> primary key</span><span style="color:#F8F8F2;">, </span><span style="color:#F92672;">data</span><span style="color:#66D9EF;font-style:italic;"> varchar</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">32</span><span style="color:#F8F8F2;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">insert into</span><span style="color:#F8F8F2;"> tb01 </span><span style="color:#F92672;">values</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">,</span><span style="color:#E6DB74;">&quot;tom&quot;</span><span style="color:#F8F8F2;">),(</span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;">,</span><span style="color:#E6DB74;">&quot;jerry&quot;</span><span style="color:#F8F8F2;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>step02 åœ¨<code>slave</code>èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹æ˜¯å¦æœ‰æ•°æ®</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F92672;">select</span><span style="color:#F92672;"> *</span><span style="color:#F92672;"> from</span><span style="color:#AE81FF;"> db01</span><span style="color:#F8F8F2;">.</span><span style="color:#AE81FF;">tb01</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#88846F;">-- +----+-------+</span></span>
<span class="line"><span style="color:#88846F;">-- | id | data  |</span></span>
<span class="line"><span style="color:#88846F;">-- +----+-------+</span></span>
<span class="line"><span style="color:#88846F;">-- |  1 | tom   |</span></span>
<span class="line"><span style="color:#88846F;">-- |  2 | jerry |</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div>`,37)])])}const m=n(e,[["render",o]]);export{b as __pageData,m as default};
