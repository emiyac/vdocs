import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.eabe3503.js";const B=JSON.parse('{"title":"mysql主从模式部署","description":"","frontmatter":{"title":"mysql主从模式部署","createTime":"2024/03/19 17:22:02","updateTime":"2024/03/21 15:26:42","isPublished":true,"tags":["mysql"]},"headers":[],"relativePath":"middleware/00501_mysql_master_slave_tutorial.md","filePath":"middleware/00501_mysql_master_slave_tutorial.md"}'),p={name:"middleware/00501_mysql_master_slave_tutorial.md"},e=l(`<h2 id="环境说明" tabindex="-1">环境说明 <a class="header-anchor" href="#环境说明" aria-label="Permalink to &quot;环境说明&quot;">​</a></h2><table><thead><tr><th>role</th><th>ip</th><th>version</th></tr></thead><tbody><tr><td>master</td><td>192.168.10.12</td><td>mysql-5.7.21</td></tr><tr><td>slave</td><td>192.168.10.13</td><td>mysql-5.7.21</td></tr></tbody></table><h2 id="mysql初始化配置" tabindex="-1">mysql初始化配置 <a class="header-anchor" href="#mysql初始化配置" aria-label="Permalink to &quot;mysql初始化配置&quot;">​</a></h2><p>本次示例采用二进制的方式部署👉 <a href="https://downloads.mysql.com/archives/community/" target="_blank" rel="noreferrer">官网下载地址</a></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># wget https://cdn.mysql.com/archives/mysql-5.7/mysql-5.7.21-linux-glibc2.12-x86_64.tar.gz</span></span>
<span class="line"><span style="color:#FFCB6B;">useradd</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mysql</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/sbin/nologin</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/workspace/mysql/{data,logs,temp}</span></span>
<span class="line"><span style="color:#FFCB6B;">chown</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mysql.mysql</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-R</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/workspace/mysql</span></span>
<span class="line"><span style="color:#FFCB6B;">tar</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-zxvf</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mysql-5.7.21-linux-glibc2.12-x86_64.tar.gz</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-C</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/opt/</span></span>
<span class="line"><span style="color:#FFCB6B;">ln</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/opt/mysql-5.7.21-linux-glibc2.12-x86_64</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/mysql</span></span>
<span class="line"><span style="color:#FFCB6B;">ln</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/mysql/lib</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/lib/mysql</span></span>
<span class="line"><span style="color:#FFCB6B;">ln</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/mysql/include/mysql</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/include/mysql</span></span>
<span class="line"><span style="color:#FFCB6B;">ln</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/mysql/bin/mysql</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/bin/mysql</span></span>
<span class="line"><span style="color:#FFCB6B;">ln</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/mysql/bin/mysqlbinlog</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/bin/mysqlbinlog</span></span>
<span class="line"><span style="color:#FFCB6B;">ln</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/mysql/bin/mysqldump</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/bin/mysqldump</span></span>
<span class="line"><span style="color:#FFCB6B;">ln</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/mysql/support-files/mysql.server</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/etc/init.d/mysqld</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="master节点配置" tabindex="-1">master节点配置 <a class="header-anchor" href="#master节点配置" aria-label="Permalink to &quot;master节点配置&quot;">​</a></h2><p>step01 修改<code>/etc/my.cnf</code>, master节点需要开启<code>binlog</code></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">client</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3306</span></span>
<span class="line"><span style="color:#BABED8;">socket</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/mysqld.sock</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">mysqld</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># server id需要唯一</span></span>
<span class="line"><span style="color:#BABED8;">server-id</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3306</span></span>
<span class="line"><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">mysql</span></span>
<span class="line"><span style="color:#BABED8;">socket</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/mysqld.sock</span></span>
<span class="line"><span style="color:#BABED8;">pid-file</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/mysqld.pid</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">basedir</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/usr/local/mysql</span></span>
<span class="line"><span style="color:#BABED8;">datadir</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/data</span></span>
<span class="line"><span style="color:#BABED8;">tmpdir</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/temp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">default-storage-engine</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">INNODB</span></span>
<span class="line"><span style="color:#BABED8;">log-error</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/error.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">character-set-server</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">utf8mb4</span></span>
<span class="line"><span style="color:#BABED8;">collation-server</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">utf8mb4_unicode_ci</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">max-connections</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">200</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 开启binglog</span></span>
<span class="line highlighted"><span style="color:#BABED8;">log-bin</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/mysql-bin</span></span>
<span class="line highlighted"><span style="color:#BABED8;">sync-binlog</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 开启存储过程、函数、触发器等内容的同步功能</span></span>
<span class="line highlighted"><span style="color:#BABED8;">log-bin-trust-function-creators</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line highlighted"><span style="color:#BABED8;">binlog-format</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">ROW</span></span>
<span class="line highlighted"><span style="color:#BABED8;">max-binlog-size</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">256</span><span style="color:#C3E88D;">M</span></span>
<span class="line highlighted"><span style="color:#BABED8;">expire-logs-days</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">30</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 开启GTID复制,即slave同步时不需要设置master的binlog和position</span></span>
<span class="line"><span style="color:#BABED8;">gtid-mode</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">on</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 跳过一些可能导致执行出错的SQL语句</span></span>
<span class="line"><span style="color:#BABED8;">enforce-gtid-consistency</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>step02 初始化主库，并启动<code>mysqld</code>服务</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">/usr/local/mysql/bin/mysqld</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--initialize-insecure</span></span>
<span class="line"><span style="color:#FFCB6B;">chkconfig</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--add</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mysqld</span></span>
<span class="line"><span style="color:#FFCB6B;">chkconfig</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mysqld</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">on</span></span>
<span class="line"><span style="color:#FFCB6B;">service</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mysqld</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">start</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>step03 设置<code>mysql</code>的<code>root</code>密码，并创建用于同步数据的账号<code>repl</code></p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">alter</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">user</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;"> identified </span><span style="color:#F78C6C;">with</span><span style="color:#BABED8;"> mysql_native_password </span><span style="color:#F78C6C;">by</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">user</span><span style="color:#BABED8;"> &quot;</span><span style="color:#82AAFF;">repl</span><span style="color:#BABED8;">&quot;@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">192.168.10.%</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;"> identified </span><span style="color:#F78C6C;">by</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">testfind</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">grant</span><span style="color:#BABED8;"> replication slave </span><span style="color:#F78C6C;">on</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;">.</span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">to</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">repl</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">192.168.10.%</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">flush privileges;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="slave节点配置" tabindex="-1">slave节点配置 <a class="header-anchor" href="#slave节点配置" aria-label="Permalink to &quot;slave节点配置&quot;">​</a></h2><p>step01 修改<code>/etc/my.cnf</code>配置，slave节点需要开启中继日志</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">client</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3306</span></span>
<span class="line"><span style="color:#BABED8;">socket</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/mysqld.sock</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">mysqld</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># server id需要唯一</span></span>
<span class="line"><span style="color:#BABED8;">server-id</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#BABED8;">port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3306</span></span>
<span class="line"><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">mysql</span></span>
<span class="line"><span style="color:#BABED8;">socket</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/mysqld.sock</span></span>
<span class="line"><span style="color:#BABED8;">pid-file</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/mysqld.pid</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">basedir</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/usr/local/mysql</span></span>
<span class="line"><span style="color:#BABED8;">datadir</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/data</span></span>
<span class="line"><span style="color:#BABED8;">tmpdir</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/temp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">default-storage-engine</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">INNODB</span></span>
<span class="line"><span style="color:#BABED8;">log-error</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/error.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">character-set-server</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">utf8mb4</span></span>
<span class="line"><span style="color:#BABED8;">collation-server</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">utf8mb4_unicode_ci</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">max-connections</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">200</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 开启binglog</span></span>
<span class="line"><span style="color:#BABED8;">log-bin</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/mysql-bin</span></span>
<span class="line"><span style="color:#BABED8;">sync-binlog</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 开启存储过程、函数、触发器等内容的同步功能</span></span>
<span class="line"><span style="color:#BABED8;">log-bin-trust-function-creators</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">binlog-format</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">ROW</span></span>
<span class="line"><span style="color:#BABED8;">max-binlog-size</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">256</span><span style="color:#C3E88D;">M</span></span>
<span class="line"><span style="color:#BABED8;">expire-logs-days</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">30</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 开启GTID复制,即slave同步时不需要设置master的binlog和position</span></span>
<span class="line"><span style="color:#BABED8;">gtid-mode</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">on</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 跳过一些可能导致执行出错的SQL语句</span></span>
<span class="line"><span style="color:#BABED8;">enforce-gtid-consistency</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 开启relay log</span></span>
<span class="line highlighted"><span style="color:#BABED8;">relay-log</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/relay-bin</span></span>
<span class="line highlighted"><span style="color:#BABED8;">relay-log-index</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/relay-bin.index</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 同步执行跳过一些错误码</span></span>
<span class="line highlighted"><span style="color:#BABED8;">slave-skip-errors</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1062</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 忽略同步库</span></span>
<span class="line highlighted"><span style="color:#BABED8;">replicate-ignore-db</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">mysql</span><span style="color:#BABED8;"> </span></span>
<span class="line highlighted"><span style="color:#BABED8;">replicate-ignore-db</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">information_schema</span></span>
<span class="line highlighted"><span style="color:#BABED8;">replicate-ignore-db</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">performance_schema</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>step02 初始化从库，并启动<code>mysqld</code>服务</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">/usr/local/mysql/bin/mysqld</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--initialize-insecure</span></span>
<span class="line"><span style="color:#FFCB6B;">chkconfig</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--add</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mysqld</span></span>
<span class="line"><span style="color:#FFCB6B;">chkconfig</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mysqld</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">on</span></span>
<span class="line"><span style="color:#FFCB6B;">service</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mysqld</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">start</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>step03 设置<code>mysql</code>的<code>root</code>密码</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">alter</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">user</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">identified</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">with</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mysql_native_password</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">by</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="主从同步" tabindex="-1">主从同步 <a class="header-anchor" href="#主从同步" aria-label="Permalink to &quot;主从同步&quot;">​</a></h2><h3 id="基于binlog模式同步" tabindex="-1">基于binlog模式同步 <a class="header-anchor" href="#基于binlog模式同步" aria-label="Permalink to &quot;基于binlog模式同步&quot;">​</a></h3><p>基于传统的二进制日志复制同步模式，同步时需要知道日志文件和日志的偏移量</p><p>step01 <code>master</code>执行命令行查看节点状态</p><p>可以看到目前主库使用的<code>mysql-bin.000002</code>这个文件，<code>Position</code>为1013</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">show </span><span style="color:#F78C6C;">master</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">status</span><span style="color:#BABED8;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- +------------------+----------+--------------+------------------+-------------------+</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- | File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- +------------------+----------+--------------+------------------+-------------------+</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- | mysql-bin.000002 |     1013 |              | mysql            |                   |</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- +------------------+----------+--------------+------------------+-------------------+</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>step02 <code>slave</code>节点上设置<code>master</code>节点的信息，并开启同步</p><p><code>slave</code>会以客户端的形式请求<code>master</code>的<code>binlog</code>，并将数据写入到<code>relay log</code>也就是中继日志中，<code>slave</code>中的线程会自动解析入库</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">-- 设置master节点的地址、账号、密码、端口、日志文件名称和 Position，建立和master的连接</span></span>
<span class="line"><span style="color:#BABED8;">change </span><span style="color:#F78C6C;">master</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">to</span><span style="color:#BABED8;"> master_host</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">192.168.10.12</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">,master_user</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">repl</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">, master_password</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">testfind</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">,master_port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3306</span><span style="color:#BABED8;">,master_log_file</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mysql-bin.000002</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">,master_log_pos</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1013</span><span style="color:#BABED8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- 开启slave同步线程</span></span>
<span class="line"><span style="color:#F78C6C;">start</span><span style="color:#BABED8;"> slave;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- 查看slave节点连接状态，主要关注 Slave_IO_Running 和 Slave_SQL_Running 的值</span></span>
<span class="line"><span style="color:#BABED8;">show slave </span><span style="color:#F78C6C;">status</span><span style="color:#BABED8;"> \\G;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- *************************** 1. row ***************************</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--                Slave_IO_State: Waiting for master to send event</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--                   Master_Host: 192.168.10.12</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--                   Master_User: repl</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--                   Master_Port: 3306</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--                 Connect_Retry: 60</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--               Master_Log_File: mysql-bin.000002</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--           Read_Master_Log_Pos: 1013</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--                Relay_Log_File: relay-bin.000002</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--                 Relay_Log_Pos: 320</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--         Relay_Master_Log_File: mysql-bin.000002</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--              Slave_IO_Running: Yes</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--             Slave_SQL_Running: Yes</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--                              ...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="基于gtid模式同步" tabindex="-1">基于GTID模式同步 <a class="header-anchor" href="#基于gtid模式同步" aria-label="Permalink to &quot;基于GTID模式同步&quot;">​</a></h3><p>通过<code>gtid</code>保证了每个在主库上提交的事务在集群中有一个唯一的<code>ID</code>。这种方式强化了数据库的主备一致性，故障恢复以及容错能力，是<code>mysql5.6</code>之后专门用于处理从库寻点问题引入的一种复制技术。</p><p>step01 <code>slave</code>节点设置<code>master</code>节点信息，并开启同步</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">-- 设置master节点的地址、账号、密码、端口，建立和master的连接</span></span>
<span class="line"><span style="color:#BABED8;">change </span><span style="color:#F78C6C;">master</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">to</span><span style="color:#BABED8;"> master_host</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">192.168.10.12</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">,master_user</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">repl</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">, master_password</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">testfind</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">,master_port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3306</span><span style="color:#BABED8;">,master_auto_position</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- 开启slave同步线程</span></span>
<span class="line"><span style="color:#F78C6C;">start</span><span style="color:#BABED8;"> slave;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- 查看slave节点连接状态，主要关注 Slave_IO_Running 和 Slave_SQL_Running 的值</span></span>
<span class="line"><span style="color:#BABED8;">show slave </span><span style="color:#F78C6C;">status</span><span style="color:#BABED8;"> \\G;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- *************************** 1. row ***************************</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--                Slave_IO_State: Waiting for master to send event</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--                   Master_Host: 192.168.10.12</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--                   Master_User: repl</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--                   Master_Port: 3306</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--                 Connect_Retry: 60</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--               Master_Log_File: mysql-bin.000002</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--           Read_Master_Log_Pos: 1013</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--                Relay_Log_File: relay-bin.000002</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--                 Relay_Log_Pos: 1226</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--         Relay_Master_Log_File: mysql-bin.000002</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--              Slave_IO_Running: Yes</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--             Slave_SQL_Running: Ye</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--                             ...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="测试主从同步" tabindex="-1">测试主从同步 <a class="header-anchor" href="#测试主从同步" aria-label="Permalink to &quot;测试主从同步&quot;">​</a></h2><p>step01 在<code>master</code>节点上创建数据库、表并且插入数据</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">create</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">database</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">if</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">not</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">exists</span><span style="color:#BABED8;"> db01;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">use</span><span style="color:#BABED8;"> db01;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">table</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">if</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">not</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">exists</span><span style="color:#BABED8;"> tb01(id </span><span style="color:#C792EA;">int</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">primary key</span><span style="color:#BABED8;">, </span><span style="color:#F78C6C;">data</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">varchar</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">32</span><span style="color:#BABED8;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">insert into</span><span style="color:#BABED8;"> tb01 </span><span style="color:#F78C6C;">values</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tom</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">),(</span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">jerry</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>step02 在<code>slave</code>节点上查看是否有数据</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">select</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">from</span><span style="color:#BABED8;"> db01.tb01;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- +----+-------+</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- | id | data  |</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- +----+-------+</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- |  1 | tom   |</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- |  2 | jerry |</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div>`,37),o=[e];function r(c,t,i,y,D,b){return n(),a("div",null,o)}const u=s(p,[["render",r]]);export{B as __pageData,u as default};
