import{_ as n,a,o as l,a3 as p}from"./chunks/framework.dRMRuUHH.js";const b=JSON.parse('{"title":"mysqlæ•°æ®å¤‡ä»½å’Œæ¢å¤","description":"","frontmatter":{"id":2203,"title":"mysqlæ•°æ®å¤‡ä»½å’Œæ¢å¤","createTime":"2024-03-20 17:10:20","category":"database"},"headers":[],"relativePath":"docs/database/mysql/at22f0f2b3ws.md","filePath":"docs/database/mysql/00503_mysql_backup_recover_tutorial.md"}'),o={name:"docs/database/mysql/at22f0f2b3ws.md"};function e(r,s,c,F,t,i){return l(),a("div",null,[...s[0]||(s[0]=[p(`<h2 id="mysqlæ•°æ®å¤‡ä»½" tabindex="-1">mysqlæ•°æ®å¤‡ä»½ <a class="header-anchor" href="#mysqlæ•°æ®å¤‡ä»½" aria-label="Permalink to â€œmysqlæ•°æ®å¤‡ä»½â€">â€‹</a></h2><p>ç›¸å…³å‚æ•°è¯´æ˜</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#A6E22E;">mysqldump</span><span style="color:#AE81FF;"> -uroot</span><span style="color:#AE81FF;"> -proot</span><span style="color:#AE81FF;"> --master-data=2</span><span style="color:#AE81FF;"> --single-transaction</span><span style="color:#AE81FF;"> -R</span><span style="color:#AE81FF;"> -E</span><span style="color:#AE81FF;"> --all-databases</span><span style="color:#F92672;"> |</span><span style="color:#A6E22E;"> gzip</span><span style="color:#F92672;"> &gt;</span><span style="color:#E6DB74;"> /workspace/backup/mysql_backup.sql.gz</span></span>
<span class="line"><span style="color:#88846F;"># --master-data        å°†ä¸»åº“çš„bin-logä¿¡æ¯å†™å…¥åˆ°dumpæ–‡ä»¶ä¸­ï¼Œ1ï¼šä¼šå°†change masterè¯­å¥å†™å…¥dumpæ–‡ä»¶ä¸­ï¼Œ2ï¼šä¼šå°†change masterè¯­å¥å†™å…¥dumpæ–‡ä»¶ä¸­ï¼Œåªä¸è¿‡ä¼šè¢«æ³¨é‡Šæ‰</span></span>
<span class="line"><span style="color:#88846F;"># --single-transaction ä½¿å¤‡ä»½è¿‡ç¨‹ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œï¼Œä»è€Œé¿å…äº†è„è¯»çš„é—®é¢˜</span></span>
<span class="line"><span style="color:#88846F;"># -R, --routines       å¯¼å‡ºå‡½æ•°å’Œå­˜å‚¨è¿‡ç¨‹</span></span>
<span class="line"><span style="color:#88846F;"># -E, --events         å¯¼å‡ºäº‹ä»¶</span></span>
<span class="line"><span style="color:#88846F;"># -A, --all-databases  å¯¼å‡ºæ‰€æœ‰æ•°æ®åº“</span></span>
<span class="line"><span style="color:#88846F;"># gzip                 ç”¨äºå‹ç¼©æ–‡ä»¶</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>å¤‡ä»½è„šæœ¬ï¼Œå¯ä»¥é…åˆå®šæ—¶ä»»åŠ¡ä½¿ç”¨</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">#!/bin/bash</span></span>
<span class="line"><span style="color:#88846F;"># set -x</span></span>
<span class="line"><span style="color:#66D9EF;">set</span><span style="color:#AE81FF;"> -e</span></span>
<span class="line"><span style="color:#66D9EF;">set</span><span style="color:#AE81FF;"> -o</span><span style="color:#E6DB74;"> pipefail</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">MYSQL_HOST</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">localhost</span></span>
<span class="line"><span style="color:#F8F8F2;">MYSQL_PORT</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">3306</span></span>
<span class="line"><span style="color:#F8F8F2;">MYSQL_USER</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">root</span></span>
<span class="line"><span style="color:#F8F8F2;">MYSQL_PASSWORD</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">root</span></span>
<span class="line"><span style="color:#F8F8F2;">BACKUP_DIR</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">/workspace/backup</span></span>
<span class="line"><span style="color:#F8F8F2;">BACKUP_LOG</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">\${BACKUP_DIR}</span><span style="color:#E6DB74;">/mysql_backup.log</span></span>
<span class="line"><span style="color:#66D9EF;">echo</span><span style="color:#F8F8F2;"> $(</span><span style="color:#A6E22E;">date</span><span style="color:#E6DB74;"> +&quot;%Y-%m-%d %T&quot;</span><span style="color:#F8F8F2;">) </span><span style="color:#E6DB74;">&quot;[INFO] start backup mysql&quot;</span><span style="color:#F92672;"> &gt;&gt;</span><span style="color:#F8F8F2;"> \${BACKUP_LOG}</span></span>
<span class="line"><span style="color:#88846F;"># backup</span></span>
<span class="line"><span style="color:#A6E22E;">/usr/local/mysql/bin/mysqldump</span><span style="color:#AE81FF;"> -h\${</span><span style="color:#F8F8F2;">MYSQL_HOST</span><span style="color:#AE81FF;">}</span><span style="color:#AE81FF;"> -P\${</span><span style="color:#F8F8F2;">MYSQL_PORT</span><span style="color:#AE81FF;">}</span><span style="color:#AE81FF;"> -u\${</span><span style="color:#F8F8F2;">MYSQL_USER</span><span style="color:#AE81FF;">}</span><span style="color:#AE81FF;"> -p\${</span><span style="color:#F8F8F2;">MYSQL_PASSWORD</span><span style="color:#AE81FF;">}</span><span style="color:#AE81FF;"> --master-data=2</span><span style="color:#AE81FF;"> --single-transaction</span><span style="color:#AE81FF;"> -R</span><span style="color:#AE81FF;"> -E</span><span style="color:#AE81FF;"> --all-databases</span><span style="color:#F92672;"> |</span><span style="color:#A6E22E;"> gzip</span><span style="color:#F92672;"> &gt;</span><span style="color:#F8F8F2;"> \${BACKUP_DIR}</span><span style="color:#E6DB74;">/mysql_backup_</span><span style="color:#F8F8F2;">$(</span><span style="color:#A6E22E;">date</span><span style="color:#E6DB74;"> +%Y%m%d</span><span style="color:#F8F8F2;">)</span><span style="color:#E6DB74;">.sql.gz</span></span>
<span class="line"><span style="color:#A6E22E;">find</span><span style="color:#F8F8F2;"> \${BACKUP_DIR} </span><span style="color:#AE81FF;">-mtime</span><span style="color:#E6DB74;"> +7</span><span style="color:#AE81FF;"> -type</span><span style="color:#E6DB74;"> f</span><span style="color:#AE81FF;"> -name</span><span style="color:#E6DB74;"> &#39;*.sql.gz&#39;</span><span style="color:#AE81FF;"> -exec</span><span style="color:#E6DB74;"> rm</span><span style="color:#AE81FF;"> -rf</span><span style="color:#E6DB74;"> {}</span><span style="color:#AE81FF;"> \\;</span></span>
<span class="line"><span style="color:#66D9EF;">echo</span><span style="color:#F8F8F2;"> $(</span><span style="color:#A6E22E;">date</span><span style="color:#E6DB74;"> +&quot;%Y-%m-%d %T&quot;</span><span style="color:#F8F8F2;">) </span><span style="color:#E6DB74;">&quot;[INFO] backup mysql success&quot;</span><span style="color:#F92672;"> &gt;&gt;</span><span style="color:#F8F8F2;"> \${BACKUP_LOG}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="mysqlæ¢å¤æ•°æ®" tabindex="-1">mysqlæ¢å¤æ•°æ® <a class="header-anchor" href="#mysqlæ¢å¤æ•°æ®" aria-label="Permalink to â€œmysqlæ¢å¤æ•°æ®â€">â€‹</a></h2><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>ğŸ˜‚ æ¢å¤æ•°æ®çš„æ—¶å€™ï¼Œå»ºè®®å…ˆå°†æ•°æ®åº“æ¢å¤åˆ°æµ‹è¯•åº“ä¸­ï¼Œå†å°†ç›¸å…³æ•°æ®å¯¼å…¥åˆ°ç”Ÿäº§åº“ä¸­</p></div><h3 id="ä½¿ç”¨å¤‡ä»½æ¢å¤æ•°æ®" tabindex="-1">ä½¿ç”¨å¤‡ä»½æ¢å¤æ•°æ® <a class="header-anchor" href="#ä½¿ç”¨å¤‡ä»½æ¢å¤æ•°æ®" aria-label="Permalink to â€œä½¿ç”¨å¤‡ä»½æ¢å¤æ•°æ®â€">â€‹</a></h3><p>step01 è§£å‹å¤‡ä»½æ•°æ®</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#66D9EF;">cd</span><span style="color:#E6DB74;"> /tmp</span></span>
<span class="line"><span style="color:#A6E22E;">cp</span><span style="color:#AE81FF;"> -a</span><span style="color:#E6DB74;"> /workspace/backup/mysql_backup_xxx.sql.gz</span><span style="color:#E6DB74;"> .</span></span>
<span class="line"><span style="color:#A6E22E;">gzip</span><span style="color:#AE81FF;"> -d</span><span style="color:#E6DB74;"> mysql_backup_xxx.sql</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>step02 åˆ©ç”¨å¤‡ä»½æ¢å¤æ•°æ®åº“</p><p>âš¡ è¿™ç§æ–¹å¼åªèƒ½æ¢å¤å¤‡ä»½ä¹‹å‰çš„æ•°æ®ï¼Œå¦‚æœåªéœ€è¦æ¢å¤å°‘é‡çš„æ•°æ®ï¼Œå¯ä»¥å…ˆå°†æ•°æ®æ¢å¤åˆ°æµ‹è¯•åº“ä¸­ï¼Œå†å°†ç›¸å…³æ•°æ®å¯¼å…¥åˆ°ç”Ÿäº§åº“ä¸­</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># å»ºè®®å…ˆå»ºä¸€ä¸ªæµ‹è¯•åº“ï¼Œåœ¨æµ‹è¯•åº“æ“ä½œ</span></span>
<span class="line"><span style="color:#A6E22E;">mysql</span><span style="color:#AE81FF;"> -uroot</span><span style="color:#AE81FF;"> -p</span><span style="color:#F92672;"> &lt;</span><span style="color:#E6DB74;"> /tmp/mysql_backup_xxx.sql</span></span>
<span class="line"><span style="color:#88846F;"># æˆ–è€…è¿æ¥æ•°æ®åº“å</span></span>
<span class="line"><span style="color:#66D9EF;">source</span><span style="color:#E6DB74;"> /tmp/mysql_backup_xxx.sql</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="ä½¿ç”¨mysqlbinlogæ¢å¤æ•°æ®" tabindex="-1">ä½¿ç”¨mysqlbinlogæ¢å¤æ•°æ® <a class="header-anchor" href="#ä½¿ç”¨mysqlbinlogæ¢å¤æ•°æ®" aria-label="Permalink to â€œä½¿ç”¨mysqlbinlogæ¢å¤æ•°æ®â€">â€‹</a></h3><p>éœ€è¦æ•°æ®åº“å¼€å¯<code>binlog</code></p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">-- æŸ¥çœ‹æ•°æ®åº“æ˜¯å¦å¼€å¯äº†binlog</span></span>
<span class="line"><span style="color:#F8F8F2;">show variables </span><span style="color:#F92672;">like</span><span style="color:#E6DB74;"> &quot;log_bin%&quot;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;"># </span><span style="color:#F92672;">+</span><span style="color:#88846F;">---------------------------------+---------------------------------------+</span></span>
<span class="line"><span style="color:#F8F8F2;"># | Variable_name                   | </span><span style="color:#F92672;">Value</span><span style="color:#F8F8F2;">                                 |</span></span>
<span class="line"><span style="color:#F8F8F2;"># </span><span style="color:#F92672;">+</span><span style="color:#88846F;">---------------------------------+---------------------------------------+</span></span>
<span class="line"><span style="color:#F8F8F2;"># | log_bin                         | </span><span style="color:#F92672;">ON</span><span style="color:#F8F8F2;">                                    |</span></span>
<span class="line"><span style="color:#F8F8F2;"># | log_bin_basename                | </span><span style="color:#F92672;">/</span><span style="color:#F8F8F2;">workspace</span><span style="color:#F92672;">/</span><span style="color:#F8F8F2;">mysql</span><span style="color:#F92672;">/</span><span style="color:#F8F8F2;">logs</span><span style="color:#F92672;">/</span><span style="color:#F8F8F2;">mysql</span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">bin       |</span></span>
<span class="line"><span style="color:#F8F8F2;"># | log_bin_index                   | </span><span style="color:#F92672;">/</span><span style="color:#F8F8F2;">workspace</span><span style="color:#F92672;">/</span><span style="color:#F8F8F2;">mysql</span><span style="color:#F92672;">/</span><span style="color:#F8F8F2;">logs</span><span style="color:#F92672;">/</span><span style="color:#F8F8F2;">mysql</span><span style="color:#F92672;">-</span><span style="color:#AE81FF;">bin</span><span style="color:#F8F8F2;">.</span><span style="color:#AE81FF;">index</span><span style="color:#F8F8F2;"> |</span></span>
<span class="line"><span style="color:#F8F8F2;"># | log_bin_trust_function_creators | </span><span style="color:#F92672;">OFF</span><span style="color:#F8F8F2;">                                   |</span></span>
<span class="line"><span style="color:#F8F8F2;"># | log_bin_use_v1_row_events       | </span><span style="color:#F92672;">OFF</span><span style="color:#F8F8F2;">                                   |</span></span>
<span class="line"><span style="color:#F8F8F2;"># </span><span style="color:#F92672;">+</span><span style="color:#88846F;">---------------------------------+---------------------------------------+</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>æµ‹è¯•æ•°æ®</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">-- 1.å¤‡ä»½å‰çš„æ•°æ®</span></span>
<span class="line"><span style="color:#F8F8F2;">mysql</span><span style="color:#F92672;">&gt;</span><span style="color:#F92672;"> select</span><span style="color:#F92672;"> *</span><span style="color:#F92672;"> from</span><span style="color:#F8F8F2;"> tb01;</span></span>
<span class="line"><span style="color:#F92672;">+</span><span style="color:#88846F;">----+-------+</span></span>
<span class="line"><span style="color:#F8F8F2;">| id | </span><span style="color:#F92672;">data</span><span style="color:#F8F8F2;">  |</span></span>
<span class="line"><span style="color:#F92672;">+</span><span style="color:#88846F;">----+-------+</span></span>
<span class="line"><span style="color:#F8F8F2;">|  </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;"> | tom   |</span></span>
<span class="line"><span style="color:#F8F8F2;">|  </span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;"> | jerry |</span></span>
<span class="line"><span style="color:#F92672;">+</span><span style="color:#88846F;">----+-------+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">-- 2.æ–°å¢çš„æ•°æ®</span></span>
<span class="line"><span style="color:#F92672;">insert into</span><span style="color:#F8F8F2;"> tb01 </span><span style="color:#F92672;">values</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">3</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&quot;mira&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">select</span><span style="color:#F92672;"> *</span><span style="color:#F92672;"> from</span><span style="color:#F8F8F2;"> tb01;</span></span>
<span class="line"><span style="color:#F92672;">+</span><span style="color:#88846F;">----+-------+</span></span>
<span class="line"><span style="color:#F8F8F2;">| id | </span><span style="color:#F92672;">data</span><span style="color:#F8F8F2;">  |</span></span>
<span class="line"><span style="color:#F92672;">+</span><span style="color:#88846F;">----+-------+</span></span>
<span class="line"><span style="color:#F8F8F2;">|  </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;"> | tom   |</span></span>
<span class="line"><span style="color:#F8F8F2;">|  </span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;"> | jerry |</span></span>
<span class="line"><span style="color:#F8F8F2;">|  </span><span style="color:#AE81FF;">3</span><span style="color:#F8F8F2;"> | mira  |</span></span>
<span class="line"><span style="color:#F92672;">+</span><span style="color:#88846F;">----+-------+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">-- æ¨¡æ‹Ÿåˆ é™¤æ•°æ®</span></span>
<span class="line"><span style="color:#F92672;">truncate</span><span style="color:#F8F8F2;"> tb01;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>å…ˆåˆ©ç”¨<code>mysqlbackup</code>çš„å¤‡ä»½æ¢å¤å¤‡ä»½ä¹‹å‰çš„æ•°æ®</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">-- 1.æ¢å¤å¤‡ä»½ä¹‹å‰çš„æ•°æ®</span></span>
<span class="line"><span style="color:#F8F8F2;">source </span><span style="color:#F92672;">/</span><span style="color:#F8F8F2;">tmp</span><span style="color:#F92672;">/</span><span style="color:#AE81FF;">mysql_backup</span><span style="color:#F8F8F2;">.</span><span style="color:#AE81FF;">sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;"># </span><span style="color:#F92672;">select</span><span style="color:#F92672;"> *</span><span style="color:#F92672;"> from</span><span style="color:#F8F8F2;"> tb01;</span></span>
<span class="line"><span style="color:#F8F8F2;"># </span><span style="color:#F92672;">+</span><span style="color:#88846F;">----+-------+</span></span>
<span class="line"><span style="color:#F8F8F2;"># | id | </span><span style="color:#F92672;">data</span><span style="color:#F8F8F2;">  |</span></span>
<span class="line"><span style="color:#F8F8F2;"># </span><span style="color:#F92672;">+</span><span style="color:#88846F;">----+-------+</span></span>
<span class="line"><span style="color:#F8F8F2;"># |  </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;"> | tom   |</span></span>
<span class="line"><span style="color:#F8F8F2;"># |  </span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;"> | jerry |</span></span>
<span class="line"><span style="color:#F8F8F2;"># </span><span style="color:#F92672;">+</span><span style="color:#88846F;">----+-------+</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>step02 æŸ¥çœ‹<code>mysqlbackup</code>æ–‡ä»¶ä¸­<code>MASTER_LOG_FILE</code>å’Œ<code>MASTER_LOG_POS</code>,åˆ©ç”¨<code>binlog</code>æ¥æ¢å¤å¤‡ä»½ä¹‹åçš„æ•°æ®</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">-- ...</span></span>
<span class="line"><span style="color:#88846F;">--</span></span>
<span class="line"><span style="color:#88846F;">-- Position to start replication or point-in-time recovery from</span></span>
<span class="line"><span style="color:#88846F;">--</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">-- CHANGE MASTER TO MASTER_LOG_FILE=&#39;mysql-bin.000004&#39;, MASTER_LOG_POS=317778;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">-- ...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>å¯ä»¥çŸ¥é“å¤‡ä»½æ—¶ä½¿ç”¨çš„æ—¥å¿—ä¸º<code>mysql-bin.000004</code>,ä½ç½®ä¸º317778</p><p>è§£æ<code>binlog</code>æ–‡ä»¶</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#A6E22E;">mysqlbinlog</span><span style="color:#E6DB74;"> mysql-bin.000004</span><span style="color:#AE81FF;"> -vv</span><span style="color:#F92672;"> &gt;</span><span style="color:#E6DB74;"> /tmp/test-bin.log</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>æ‰¾åˆ°æ’å…¥æ•°æ®å¹¶<code>commit</code>ä¹‹åï¼Œæ¸…ç©ºè¡¨ä¹‹å‰çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯476606</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F8F8F2;">BINLOG </span><span style="color:#E6DB74;">&#39;</span></span>
<span class="line"><span style="color:#E6DB74;">V4X6ZRMBAAAAMgAAAHJFBwAAAMABAAAAAAEABGRiMDEABHRiMDEAAgMPAoAAAvhYuRQ=</span></span>
<span class="line"><span style="color:#E6DB74;">V4X6ZR4BAAAALQAAAJ9FBwAAAMABAAAAAAEAAgAC//wDAAAABG1pcmFet/32</span></span>
<span class="line"><span style="color:#E6DB74;">&#39;</span><span style="color:#88846F;">/*!*/</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">### </span><span style="color:#F92672;">INSERT INTO</span><span style="color:#E6DB74;"> \`db01\`</span><span style="color:#F8F8F2;">.</span><span style="color:#E6DB74;">\`tb01\`</span></span>
<span class="line"><span style="color:#F8F8F2;">### </span><span style="color:#F92672;">SET</span></span>
<span class="line"><span style="color:#F8F8F2;">###   @1</span><span style="color:#F92672;">=</span><span style="color:#AE81FF;">3</span><span style="color:#88846F;"> /* INT meta=0 nullable=0 is_null=0 */</span></span>
<span class="line"><span style="color:#F8F8F2;">###   @2</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&#39;mira&#39;</span><span style="color:#88846F;"> /* VARSTRING(128) meta=128 nullable=1 is_null=0 */</span></span>
<span class="line"><span style="color:#F8F8F2;"># </span><span style="color:#F92672;">at</span><span style="color:#AE81FF;"> 476575</span></span>
<span class="line"><span style="color:#F8F8F2;">#</span><span style="color:#AE81FF;">240320</span><span style="color:#AE81FF;"> 14</span><span style="color:#F8F8F2;">:</span><span style="color:#AE81FF;">42</span><span style="color:#F8F8F2;">:</span><span style="color:#AE81FF;">31</span><span style="color:#F92672;"> server</span><span style="color:#F8F8F2;"> id </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">  end_log_pos </span><span style="color:#AE81FF;">476606</span><span style="color:#F8F8F2;"> CRC32 0x5ad42bef       Xid </span><span style="color:#F92672;">=</span><span style="color:#AE81FF;"> 4181</span></span>
<span class="line"><span style="color:#F92672;">COMMIT</span><span style="color:#88846F;">/*!*/</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;"># </span><span style="color:#F92672;">at</span><span style="color:#AE81FF;"> 476606</span></span>
<span class="line"><span style="color:#F8F8F2;">#</span><span style="color:#AE81FF;">240320</span><span style="color:#AE81FF;"> 14</span><span style="color:#F8F8F2;">:</span><span style="color:#AE81FF;">53</span><span style="color:#F8F8F2;">:</span><span style="color:#AE81FF;">28</span><span style="color:#F92672;"> server</span><span style="color:#F8F8F2;"> id </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">  end_log_pos </span><span style="color:#AE81FF;">476671</span><span style="color:#F8F8F2;"> CRC32 0x76470308       Anonymous_GTID  last_committed</span><span style="color:#F92672;">=</span><span style="color:#AE81FF;">145</span><span style="color:#F8F8F2;">      sequence_number</span><span style="color:#F92672;">=</span><span style="color:#AE81FF;">146</span><span style="color:#F8F8F2;">     rbr_only</span><span style="color:#F92672;">=no</span></span>
<span class="line"><span style="color:#F92672;">SET</span><span style="color:#F8F8F2;"> @@</span><span style="color:#AE81FF;">SESSION</span><span style="color:#F8F8F2;">.</span><span style="color:#AE81FF;">GTID_NEXT</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;"> &#39;ANONYMOUS&#39;</span><span style="color:#88846F;">/*!*/</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;"># </span><span style="color:#F92672;">at</span><span style="color:#AE81FF;"> 476671</span></span>
<span class="line"><span style="color:#F8F8F2;">#</span><span style="color:#AE81FF;">240320</span><span style="color:#AE81FF;"> 14</span><span style="color:#F8F8F2;">:</span><span style="color:#AE81FF;">53</span><span style="color:#F8F8F2;">:</span><span style="color:#AE81FF;">28</span><span style="color:#F92672;"> server</span><span style="color:#F8F8F2;"> id </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">  end_log_pos </span><span style="color:#AE81FF;">476751</span><span style="color:#F8F8F2;"> CRC32 0x45183fa6       Query   thread_id</span><span style="color:#F92672;">=</span><span style="color:#AE81FF;">10</span><span style="color:#F8F8F2;">    exec_time</span><span style="color:#F92672;">=</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">     error_code</span><span style="color:#F92672;">=</span><span style="color:#AE81FF;">0</span></span>
<span class="line"><span style="color:#F92672;">SET</span><span style="color:#66D9EF;font-style:italic;"> TIMESTAMP</span><span style="color:#F92672;">=</span><span style="color:#AE81FF;">1710917608</span><span style="color:#88846F;">/*!*/</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">truncate</span><span style="color:#F8F8F2;"> tb01</span></span>
<span class="line"><span style="color:#88846F;">/*!*/</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;"># </span><span style="color:#F92672;">at</span><span style="color:#AE81FF;"> 476751</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>ä¹Ÿå°±æ˜¯éœ€è¦æ¢å¤317778~476606ä¹‹å‰çš„æ•°æ®</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#A6E22E;">mysqlbinlog</span><span style="color:#E6DB74;"> /tmp/mysql-bin.000004</span><span style="color:#AE81FF;"> --start-position=317778</span><span style="color:#AE81FF;"> --stop-position=476606</span><span style="color:#AE81FF;"> -vv</span><span style="color:#F92672;"> &gt;</span><span style="color:#E6DB74;"> /tmp/recover.sql</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>å¯¼å…¥æ•°æ®</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F8F8F2;">source </span><span style="color:#F92672;">/</span><span style="color:#F8F8F2;">tmp</span><span style="color:#F92672;">/</span><span style="color:#AE81FF;">recover</span><span style="color:#F8F8F2;">.</span><span style="color:#AE81FF;">sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">select</span><span style="color:#F92672;"> *</span><span style="color:#F92672;"> from</span><span style="color:#F8F8F2;"> tb01;</span></span>
<span class="line"><span style="color:#F8F8F2;"># </span><span style="color:#F92672;">+</span><span style="color:#88846F;">----+-------+</span></span>
<span class="line"><span style="color:#F8F8F2;"># | id | </span><span style="color:#F92672;">data</span><span style="color:#F8F8F2;">  |</span></span>
<span class="line"><span style="color:#F8F8F2;"># </span><span style="color:#F92672;">+</span><span style="color:#88846F;">----+-------+</span></span>
<span class="line"><span style="color:#F8F8F2;"># |  </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;"> | tom   |</span></span>
<span class="line"><span style="color:#F8F8F2;"># |  </span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;"> | jerry |</span></span>
<span class="line"><span style="color:#F8F8F2;"># |  </span><span style="color:#AE81FF;">3</span><span style="color:#F8F8F2;"> | mira  |</span></span>
<span class="line"><span style="color:#F8F8F2;"># </span><span style="color:#F92672;">+</span><span style="color:#88846F;">----+-------+</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div>`,31)])])}const m=n(o,[["render",e]]);export{b as __pageData,m as default};
