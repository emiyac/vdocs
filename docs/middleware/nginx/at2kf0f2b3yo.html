<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nginxé…ç½®è¯¦è§£ | vdocs</title>
    <meta name="description" content="vdocs by emiya">
    <meta name="generator" content="VitePress v2.0.0-alpha.15">
    <link rel="preload stylesheet" href="/vdocs/assets/style.MAMnki61.css" as="style">
    <link rel="preload stylesheet" href="/vdocs/vp-icons.css" as="style">
    <script type="module" src="/vdocs/assets/chunks/metadata.3f01c6ba.js"></script>
    <script type="module" src="/vdocs/assets/app.BOec1mtR.js"></script>
    <link rel="modulepreload" href="/vdocs/assets/chunks/theme.Bih3ygzX.js">
    <link rel="modulepreload" href="/vdocs/assets/chunks/framework.dRMRuUHH.js">
    <link rel="modulepreload" href="/vdocs/assets/docs_middleware_nginx_at2kf0f2b3yo.md.BY2KHZA9.lean.js">
    <link rel="icon" href="/vdocs/favicon.ico">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><!--[--><div class="w8 fixed right-2 bottom-2 z-12"><div class="flex-col-center gap1"><div class="wfull p1 cursor-pointer hover:translate-y--1 duration-300" style="display:none;"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><g><path d="M635.43296 701.89056H390.59456c-33.42336 0-63.71328-17.96096-79.6672-46.51008-20.6848 9.27744-39.97696 20.76672-57.42592 34.2016a59.111424 59.111424 0 0 1-59.57632 7.39328 59.14624 59.14624 0 0 1-35.36896-48.49664c-12.65664-129.86368 61.82912-191.77472 109.75232-217.8048 6.4512-133.55008 67.1744-259.33824 168.48896-347.648 43.43808-37.86752 108.9536-37.86752 152.39168 0 101.31456 88.30976 162.03776 214.09792 168.48896 347.648 47.9232 26.03008 122.40896 87.94112 109.75232 217.8048a59.107328 59.107328 0 0 1-35.36896 48.49664 59.158528 59.158528 0 0 1-59.57632-7.39328c-17.44896-13.43488-36.74112-24.92416-57.42592-34.2016-15.91296 28.54912-46.20288 46.51008-79.62624 46.51008z m-319.5904-113.13152c20.74624 0 40.52992 12.22656 49.0496 32.41984l0.22528 0.53248c4.28032 10.11712 14.27456 16.62976 25.47712 16.62976h244.8384c11.20256 0 21.1968-6.53312 25.47712-16.65024l0.22528-0.512c11.264-26.68544 42.20928-39.46496 68.99712-28.50816 26.8288 10.97728 51.9168 24.9856 74.71104 41.69728 2.74432-42.92608-6.9632-79.03232-28.91776-107.39712-19.39456-25.06752-44.4416-39.40352-62.03392-47.0016l-19.02592-8.21248-0.16384-20.72576c-0.96256-122.69568-54.64064-239.37024-147.2512-320.08192-19.61984-17.1008-49.23392-17.1008-68.87424 0-92.61056 80.73216-146.28864 197.38624-147.2512 320.08192l-0.16384 20.70528-19.02592 8.21248c-17.59232 7.59808-42.63936 21.9136-62.03392 47.0016-21.95456 28.3648-31.66208 64.45056-28.91776 107.39712 22.77376-16.6912 47.88224-30.69952 74.71104-41.69728 6.51264-2.64192 13.27104-3.8912 19.94752-3.8912z" fill="currentColor" p-id="41796"></path><path d="M513.024 444.64128c-54.9888 0-99.71712-44.72832-99.71712-99.71712s44.72832-99.71712 99.71712-99.71712 99.71712 44.72832 99.71712 99.71712-44.72832 99.71712-99.71712 99.71712z m0-135.8848c-19.94752 0-36.16768 16.22016-36.16768 36.16768s16.22016 36.16768 36.16768 36.16768 36.16768-16.22016 36.16768-36.16768c-0.02048-19.94752-16.24064-36.16768-36.16768-36.16768z" fill="currentColor"></path></g><g><path d="M392.54016 904.82688c-17.55136 0-31.78496-14.2336-31.78496-31.78496v-97.6896c0-17.55136 14.2336-31.78496 31.78496-31.78496s31.78496 14.2336 31.78496 31.78496v97.6896c-0.02048 17.55136-14.2336 31.78496-31.78496 31.78496z" fill="currentColor" p-id="41795"><animateTransform attributeName="transform" type="translate" values="0,0;0,100;0,0" begin="0" dur="3s" repeatCount="indefinite"></animateTransform></path><path d="M513.024 980.31616c-17.55136 0-31.78496-14.2336-31.78496-31.78496v-173.17888c0-17.55136 14.2336-31.78496 31.78496-31.78496s31.78496 14.2336 31.78496 31.78496v173.17888c0 17.57184-14.2336 31.78496-31.78496 31.78496z" fill="currentColor"><animateTransform attributeName="transform" type="translate" values="0,0;0,60;0,0" begin="1" dur="2s" repeatCount="indefinite"></animateTransform></path><path d="M633.50784 861.94176c-17.55136 0-31.78496-14.2336-31.78496-31.78496v-54.80448c0-17.55136 14.2336-31.78496 31.78496-31.78496s31.78496 14.2336 31.78496 31.78496v54.80448c0 17.57184-14.2336 31.78496-31.78496 31.78496z" fill="currentColor"><animateTransform attributeName="transform" type="translate" values="0,0;0,80;0,0" begin="2" dur="2.5s" repeatCount="indefinite"></animateTransform></path></g></svg></div><div class="wfull p1 cursor-pointer" style=""><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2a7.5 7.5 0 0 1 7.5 7.5c0 2.568-1.4 4.656-2.85 6.14a16.4 16.4 0 0 1-1.853 1.615c-.594.446-1.952 1.282-1.952 1.282a1.71 1.71 0 0 1-1.69 0a21 21 0 0 1-1.952-1.282A16 16 0 0 1 7.35 15.64C5.9 14.156 4.5 12.068 4.5 9.5A7.5 7.5 0 0 1 12 2m0 2a5.5 5.5 0 0 0-5.5 5.5c0 1.816.996 3.428 2.28 4.74c.966.988 2.03 1.74 2.767 2.202l.453.274l.453-.274c.736-.462 1.801-1.214 2.767-2.201c1.284-1.313 2.28-2.924 2.28-4.741A5.5 5.5 0 0 0 12 4m0 2.5a3 3 0 1 1 0 6a3 3 0 0 1 0-6m0 2a1 1 0 1 0 0 2a1 1 0 0 0 0-2Z"><animateTransform attributeName="transform" type="translate" values="0,0;0,-2;0,0" begin="2" dur="2s" repeatCount="indefinite"></animateTransform></path><path fill="currentColor" fill-rule="nonzero" d="M6.72 16.64a1 1 0 0 1 .56 1.92c-.5.146-.86.3-1.091.44c.238.143.614.303 1.136.452C8.48 19.782 10.133 20 12 20s3.52-.218 4.675-.548c.523-.149.898-.309 1.136-.452c-.23-.14-.59-.294-1.09-.44a1 1 0 0 1 .559-1.92c.668.195 1.28.445 1.75.766c.435.299.97.82.97 1.594c0 .783-.548 1.308-.99 1.607c-.478.322-1.103.573-1.786.768C15.846 21.77 14 22 12 22s-3.846-.23-5.224-.625c-.683-.195-1.308-.446-1.786-.768c-.442-.3-.99-.824-.99-1.607c0-.774.535-1.295.97-1.594c.47-.321 1.082-.571 1.75-.766Z"></path></svg></div><div class="wfull p1 cursor-pointer"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M512 750.933333c-132.266667 0-238.933333-106.666667-238.933333-238.933333s106.666667-238.933333 238.933333-238.933333 238.933333 106.666667 238.933333 238.933333-106.666667 238.933333-238.933333 238.933333z m0-426.666666c-102.4 0-187.733333 85.333333-187.733333 187.733333 0 102.4 85.333333 187.733333 187.733333 187.733333 102.4 0 187.733333-85.333333 187.733333-187.733333 0-102.4-85.333333-187.733333-187.733333-187.733333z" fill="currentColor" p-id="10152"></path><path d="M512 298.666667c-119.466667 0-213.333333 93.866667-213.333333 213.333333s93.866667 213.333333 213.333333 213.333333" fill="currentColor" p-id="10153"></path><path d="M512 750.933333c-132.266667 0-238.933333-106.666667-238.933333-238.933333s106.666667-238.933333 238.933333-238.933333v51.2c-102.4 0-187.733333 85.333333-187.733333 187.733333 0 102.4 85.333333 187.733333 187.733333 187.733333v51.2z" fill="currentColor" p-id="10154"></path><path d="M512 964.266667c-12.8 0-25.6-12.8-25.6-25.6v-81.066667c0-12.8 12.8-25.6 25.6-25.6s25.6 12.8 25.6 25.6v81.066667c0 12.8-12.8 25.6-25.6 25.6z m302.933333-123.733334c-8.533333 0-12.8-4.266667-17.066666-8.533333l-59.733334-59.733333c-8.533333-8.533333-8.533333-25.6 0-34.133334 8.533333-8.533333 25.6-8.533333 34.133334 0l59.733333 59.733334c8.533333 8.533333 8.533333 25.6 0 34.133333-4.266667 4.266667-12.8 8.533333-17.066667 8.533333z m-605.866666 0c-8.533333 0-12.8-4.266667-17.066667-8.533333-8.533333-8.533333-8.533333-25.6 0-34.133333l59.733333-59.733334c8.533333-8.533333 25.6-8.533333 34.133334 0 8.533333 8.533333 8.533333 25.6 0 34.133334l-59.733334 59.733333c-4.266667 4.266667-8.533333 8.533333-17.066666 8.533333z m729.6-302.933333h-81.066667c-12.8 0-25.6-12.8-25.6-25.6s12.8-25.6 25.6-25.6h81.066667c12.8 0 25.6 12.8 25.6 25.6s-12.8 25.6-25.6 25.6z m-772.266667 0h-81.066667c-12.8 0-25.6-12.8-25.6-25.6s12.8-25.6 25.6-25.6h81.066667c12.8 0 25.6 12.8 25.6 25.6s-12.8 25.6-25.6 25.6z m102.4-243.2c-8.533333 0-12.8-4.266667-17.066667-8.533333l-59.733333-59.733334c-8.533333-8.533333-8.533333-25.6 0-34.133333s25.6-8.533333 34.133333 0l59.733334 59.733333c8.533333 8.533333 8.533333 25.6 0 34.133334-4.266667 4.266667-12.8 8.533333-17.066667 8.533333z m486.4 0c-8.533333 0-12.8-4.266667-17.066667-8.533333-8.533333-8.533333-8.533333-25.6 0-34.133334l59.733334-59.733333c8.533333-8.533333 25.6-8.533333 34.133333 0s8.533333 25.6 0 34.133333l-59.733333 59.733334c-4.266667 4.266667-8.533333 8.533333-17.066667 8.533333z m-243.2-102.4c-12.8 0-25.6-12.8-25.6-25.6V85.333333c0-12.8 12.8-25.6 25.6-25.6s25.6 12.8 25.6 25.6v81.066667c0 12.8-12.8 25.6-25.6 25.6z" fill="currentColor" p-id="10155"><animateTransform attributeName="transform" type="rotate" fill="freeze" begin="0s" dur="25s" from="360 512 512" to="0 512 512" repeatCount="indefinite"></animateTransform></path></svg></div></div></div><div class="Layout" data-v-1df9f90f><!--[--><!--]--><!--[--><span tabindex="-1" data-v-331ec75c></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-331ec75c>Skip to content</a><!--]--><!----><header class="VPNav" data-v-1df9f90f data-v-da52a441><div class="VPNavBar" data-v-da52a441 data-v-70946a35><div class="wrapper" data-v-70946a35><div class="container" data-v-70946a35><div class="title" data-v-70946a35><div class="VPNavBarTitle has-sidebar" data-v-70946a35 data-v-1e38c6bc><a class="title" href="/vdocs/" data-v-1e38c6bc><!--[--><!--]--><!----><span data-v-1e38c6bc>vdocs</span><!--[--><!--]--></a></div></div><div class="content" data-v-70946a35><div class="content-body" data-v-70946a35><!--[--><!--]--><div class="VPNavBarSearch search" data-v-70946a35><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-70946a35 data-v-39714824><span id="main-nav-aria-label" class="visually-hidden" data-v-39714824> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/vdocs/" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/vdocs/markdown-examples" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>Examples</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-70946a35 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-70946a35 data-v-0394ad82 data-v-d07f11e6><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-70946a35 data-v-bf2fac68 data-v-42cb505d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-42cb505d><span class="vpi-more-horizontal icon" data-v-42cb505d></span></button><div class="menu" data-v-42cb505d><div class="VPMenu" data-v-42cb505d data-v-25a6cce8><!----><!--[--><!--[--><!----><div class="group" data-v-bf2fac68><div class="item appearance" data-v-bf2fac68><p class="label" data-v-bf2fac68>Appearance</p><div class="appearance-action" data-v-bf2fac68><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bf2fac68 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bf2fac68><div class="item social-links" data-v-bf2fac68><div class="VPSocialLinks social-links-list" data-v-bf2fac68 data-v-d07f11e6><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-70946a35 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-70946a35><div class="divider-line" data-v-70946a35></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-1df9f90f data-v-db738f89><div class="container" data-v-db738f89><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-db738f89><span class="vpi-align-left menu-icon" data-v-db738f89></span><span class="menu-text" data-v-db738f89>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-db738f89 data-v-0bf0e06f><button data-v-0bf0e06f>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-1df9f90f data-v-af661f50><div class="curtain" data-v-af661f50></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-af661f50><span class="visually-hidden" id="sidebar-aria-label" data-v-af661f50> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-8d50c081><section class="VPSidebarItem level-0 has-active" data-v-8d50c081 data-v-d81de50c><div class="item" role="button" tabindex="0" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><h2 class="text" data-v-d81de50c>middleware</h2><!----></div><div class="items" data-v-d81de50c><!--[--><section class="VPSidebarItem level-1" data-v-d81de50c data-v-d81de50c><div class="item" role="button" tabindex="0" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><h3 class="text" data-v-d81de50c>kafka</h3><!----></div><div class="items" data-v-d81de50c><!--[--><div class="VPSidebarItem level-2 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/vdocs/docs/middleware/kafka/at22f0f2b33c" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>kafkaå¿«é€Ÿéƒ¨ç½²å’Œä½¿ç”¨</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/vdocs/docs/middleware/kafka/at22f0f2b3gf" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>kafkaé›†ç¾¤éƒ¨ç½²</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-d81de50c data-v-d81de50c><div class="item" role="button" tabindex="0" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><h3 class="text" data-v-d81de50c>nacos</h3><!----></div><div class="items" data-v-d81de50c><!--[--><div class="VPSidebarItem level-2 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/vdocs/docs/middleware/nacos/at22f0f2b3Lu" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>nacosé…ç½®å’Œéƒ¨ç½²</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/vdocs/docs/middleware/nacos/at22f0f2b3Lw" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>nacosæ¼æ´</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 has-active" data-v-d81de50c data-v-d81de50c><div class="item" role="button" tabindex="0" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><h3 class="text" data-v-d81de50c>nginx</h3><!----></div><div class="items" data-v-d81de50c><!--[--><div class="VPSidebarItem level-2 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/vdocs/docs/middleware/nginx/at2kf0f2b3yf" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>æºç æ„å»ºnginxé•œåƒ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/vdocs/docs/middleware/nginx/at2kf0f2b3yo" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>nginxé…ç½®è¯¦è§£</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/vdocs/docs/middleware/nginx/at2kf0f2b3yd" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>nginxé…ç½®ssl</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-1df9f90f data-v-c87f25bf><div class="VPDoc has-sidebar has-aside" data-v-c87f25bf data-v-7011f0d8><!--[--><!--]--><div class="container" data-v-7011f0d8><div class="aside" data-v-7011f0d8><div class="aside-curtain" data-v-7011f0d8></div><div class="aside-container" data-v-7011f0d8><div class="aside-content" data-v-7011f0d8><div class="VPDocAside" data-v-7011f0d8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-60d5052e><div class="content" data-v-60d5052e><div class="outline-marker" data-v-60d5052e></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-60d5052e>æœ¬é¡µå¯¼èˆª</div><ul class="VPDocOutlineItem root" data-v-60d5052e data-v-1ce71065><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-7011f0d8><div class="content-container" data-v-7011f0d8><!--[--><!--[--><!--[--><div><h1 data-pagefind-meta="title" class="font-size-8 font-800 tracking-wide leading-loose">nginxé…ç½®è¯¦è§£</h1><div class="flex flex-wrap items-start gap2 font-size-3 op-80"><div data-pagefind-ignore class="flex items-center justify-center gap1 px2"><span class="w4 h4"><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M184.58940973 656.20225695s301.00651042-374.93793402 559.76649304-422.46527778C438.06857639 355.19574653 89.53472223 851.59244792 89.53472223 851.59244792h337.97222221s-5.28081598-15.84244792-26.40407986-15.84244791H131.78125s52.80815973-63.36979167 95.0546875-100.33550348c174.26692708-10.56163194 327.41059027-26.40407986 427.74609375-174.26692708 15.84244792-31.68489583-15.84244792-31.68489583-21.12326389-31.68489584 79.21223958-31.68489583 264.04079861-163.70529514 232.35590278-232.35590277-10.56163194-10.56163194-21.12326389-5.28081598-21.12326389-5.28081598s137.30121527-89.77387152 63.36979167-126.73958333c-63.36979167-36.96571181-237.63671875 26.40407986-237.63671875 26.40407986s10.56163194-26.40407986-26.40407986-26.40407986c-142.58203125 10.56163194-253.47916667 110.89713542-253.47916667 110.89713542s0-31.68489583-21.12326389-21.1232639C68.41145833 444.96961805 184.58940973 656.20225695 184.58940973 656.20225695z" fill="currentColor" fill-rule="evenodd"></path></svg></span><p>emiya</p></div><div class="flex items-center justify-center gap1 px2 cursor-pointer"><span class="w4 h4"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24"><path fill="currentColor" d="M16.07 9.952c1.329 0 2.462 0 3.366.102q.23.025.458.064c.532.09 1.05.235 1.53.488v-.85c0-.91 0-1.663-.085-2.264c-.09-.635-.286-1.197-.756-1.66a3 3 0 0 0-.241-.214c-.512-.408-1.126-.575-1.82-.652c-.67-.074-1.512-.074-2.545-.074h-.353c-.982 0-1.335-.006-1.653-.087a2.7 2.7 0 0 1-.536-.196c-.285-.14-.532-.351-1.228-.968l-.474-.42a7 7 0 0 0-.48-.403a4.3 4.3 0 0 0-2.182-.803A8 8 0 0 0 8.413 2h-.116c-.641 0-1.064 0-1.431.061c-1.605.268-2.903 1.39-3.219 2.875c-.072.337-.071.724-.071 1.283v4.387c.48-.253.998-.399 1.53-.488q.227-.039.458-.064c.904-.102 2.037-.102 3.367-.102z"></path><path fill="currentColor" fill-rule="evenodd" d="M3.358 12.779c-.61.941-.358 2.25.145 4.868c.363 1.885.544 2.827 1.172 3.452q.246.245.544.429C5.982 22 6.995 22 9.022 22h6.956c2.027 0 3.04 0 3.803-.472q.298-.184.544-.429c.628-.625.81-1.567 1.172-3.452c.503-2.618.755-3.927.145-4.868a3 3 0 0 0-.57-.646c-.87-.735-2.279-.735-5.094-.735H9.022c-2.815 0-4.223 0-5.094.735a3 3 0 0 0-.57.646m6.337 4.402c0-.4.343-.723.765-.723h4.08c.422 0 .765.324.765.723s-.343.723-.765.723h-4.08c-.422 0-.765-.324-.765-.723" clip-rule="evenodd"></path></svg></span><p data-pagefind-ignore data-pagefind-filter="category">middleware</p></div><div data-pagefind-ignore class="flex items-center justify-center gap1 px2"><span class="w4 h4"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24"><path fill="currentColor" d="M7.75 2.5a.75.75 0 0 0-1.5 0v1.58c-1.44.115-2.384.397-3.078 1.092c-.695.694-.977 1.639-1.093 3.078h19.842c-.116-1.44-.398-2.384-1.093-3.078c-.694-.695-1.639-.977-3.078-1.093V2.5a.75.75 0 0 0-1.5 0v1.513C15.585 4 14.839 4 14 4h-4c-.839 0-1.585 0-2.25.013z"></path><path fill="currentColor" fill-rule="evenodd" d="M22 12c0-.839 0-1.585-.013-2.25H2.013C2 10.415 2 11.161 2 12v2c0 3.771 0 5.657 1.172 6.828S6.229 22 10 22h4c3.771 0 5.657 0 6.828-1.172S22 17.771 22 14zm-8 .25A1.75 1.75 0 0 0 12.25 14v2a1.75 1.75 0 1 0 3.5 0v-2A1.75 1.75 0 0 0 14 12.25m0 1.5a.25.25 0 0 0-.25.25v2a.25.25 0 1 0 .5 0v-2a.25.25 0 0 0-.25-.25m-3.213-1.443a.75.75 0 0 1 .463.693v4a.75.75 0 0 1-1.5 0v-2.19l-.22.22a.75.75 0 0 1-1.06-1.06l1.5-1.5a.75.75 0 0 1 .817-.163" clip-rule="evenodd"></path></svg></span><p>2024-02-04 17:41:14</p></div></div></div><!--]--><!--]--><!--]--><main class="main" data-v-7011f0d8><div style="position:relative;" class="vp-doc _vdocs_docs_middleware_nginx_at2kf0f2b3yo" data-v-7011f0d8><div><p>ğŸ‘‰<a href="https://nginx.org/en/docs/" target="_blank" rel="noreferrer">nginxå®˜æ–¹æ–‡æ¡£</a></p><h2 id="nginxé…ç½®æ–‡ä»¶ç»“æ„" tabindex="-1">nginxé…ç½®æ–‡ä»¶ç»“æ„ <a class="header-anchor" href="#nginxé…ç½®æ–‡ä»¶ç»“æ„" aria-label="Permalink to â€œnginxé…ç½®æ–‡ä»¶ç»“æ„â€">â€‹</a></h2><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># mainå—</span></span>
<span class="line"><span style="color:#66D9EF;">...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># eventså—</span></span>
<span class="line"><span style="color:#A6E22E;">events</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#66D9EF;">    ...</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># mailå—</span></span>
<span class="line"><span style="color:#A6E22E;">mail</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#66D9EF;">    ...</span></span>
<span class="line"><span style="color:#88846F;">    # serverå—</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#66D9EF;">        ...</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># streamå—</span></span>
<span class="line"><span style="color:#A6E22E;">stream</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#66D9EF;">    ...</span></span>
<span class="line"><span style="color:#88846F;">    # upstreamå—, å¯ä»¥æœ‰å¤šä¸ª</span></span>
<span class="line"><span style="color:#A6E22E;">    upstream</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#66D9EF;">        ....</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#88846F;">    # serverå—, å¯ä»¥æœ‰å¤šä¸ª</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#66D9EF;">        ...</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># httpå—</span></span>
<span class="line"><span style="color:#A6E22E;">http</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#66D9EF;">    ...</span></span>
<span class="line"><span style="color:#88846F;">    # upstreamå—, å¯ä»¥æœ‰å¤šä¸ª</span></span>
<span class="line"><span style="color:#A6E22E;">    upstream</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#66D9EF;">        ...</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#88846F;">    # serverå—, å¯ä»¥æœ‰å¤šä¸ª</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#66D9EF;">        ...</span></span>
<span class="line"><span style="color:#88846F;">        # locationå—, å¯ä»¥æœ‰å¤šä¸ª</span></span>
<span class="line"><span style="color:#A6E22E;">        location</span><span style="color:#F8F8F2;"> [pattern] {</span></span>
<span class="line"><span style="color:#66D9EF;">            ...</span></span>
<span class="line"><span style="color:#F8F8F2;">        }</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><ul><li>mainï¼šæä¾›äº†<code>nginx</code>æœåŠ¡è¿è¡Œçš„åŸºæœ¬åŠŸèƒ½, åŒ…æ‹¬è¿›ç¨‹ç®¡ç†ã€<code>cpu</code>äº²ç¼˜æ€§ã€å†…å­˜ç®¡ç†ã€é…ç½®æ–‡ä»¶è§£æã€æ—¥å¿—ç®¡ç†ç­‰</li><li>eventså—ï¼šè´Ÿè´£è¿›è¡Œè¿æ¥å¤„ç†, æä¾›å¯¹ä¸åŒæ“ä½œç³»ç»Ÿçš„<code>I/O</code>ç½‘ç»œæ¨¡å‹æ”¯æŒï¼Œ è‡ªåŠ¨æ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©æœ€æœ‰æ•ˆçš„<code>I/O</code>ç½‘ç»œæ¨¡å‹ã€‚</li><li>mailå—ï¼šæä¾›é‚®ä»¶ä»£ç†åŠŸèƒ½ <ul><li>server</li></ul></li><li>streamå—ï¼šæä¾›<code>tcp</code>å’Œ<code>udp</code>ä¼šè¯çš„ä»£ç†å’Œè´Ÿè½½ç›¸å…³åŠŸèƒ½ <ul><li>upstream</li><li>server</li></ul></li><li>httpå—ï¼šæä¾›<code>http</code>å¤„ç†çš„æ ¸å¿ƒåŠŸèƒ½å’Œéƒ¨åˆ†åŠŸèƒ½æ¨¡å— <ul><li>upstream</li><li>server <ul><li>location</li></ul></li></ul></li></ul><h2 id="nginxå¸¸ç”¨å˜é‡" tabindex="-1">nginxå¸¸ç”¨å˜é‡ <a class="header-anchor" href="#nginxå¸¸ç”¨å˜é‡" aria-label="Permalink to â€œnginxå¸¸ç”¨å˜é‡â€">â€‹</a></h2><table tabindex="0"><thead><tr><th style="text-align:left;">å˜é‡å</th><th style="text-align:left;">åŠŸèƒ½</th></tr></thead><tbody><tr><td style="text-align:left;"><code>$arg_</code></td><td style="text-align:left;">è·å–æŒ‡å®šè¯·æ±‚å‚æ•°çš„å€¼, ä¾‹å¦‚<code>?key=100</code>, <code>$arg_key=100</code></td></tr><tr><td style="text-align:left;"><code>$args</code></td><td style="text-align:left;">è·å–æ‰€æœ‰çš„è¯·æ±‚å‚æ•°</td></tr><tr><td style="text-align:left;"><code>$connection</code></td><td style="text-align:left;">è¿æ¥çš„åºåˆ—å·</td></tr><tr><td style="text-align:left;"><code>$connection_requests</code></td><td style="text-align:left;">å½“å‰è¿æ¥æ•°</td></tr><tr><td style="text-align:left;"><code>$connection_time</code></td><td style="text-align:left;">å»ºç«‹è¿æ¥çš„æ—¶é—´(å•ä½ç§’)</td></tr><tr><td style="text-align:left;"><code>$content_length</code></td><td style="text-align:left;">è¯·æ±‚å¤´çš„<code>Content-Length</code>å­—æ®µ</td></tr><tr><td style="text-align:left;"><code>$content_type</code></td><td style="text-align:left;">è¯·æ±‚å¤´çš„<code>Content-Type</code>å­—æ®µ</td></tr><tr><td style="text-align:left;"><code>$host</code></td><td style="text-align:left;">ä¾æ¬¡è·å–è¯·æ±‚ä¿¡æ¯ä¸­çš„ä¸»æœºåã€è¯·æ±‚å¤´ä¸­çš„<code>host</code>å­—æ®µã€ä¸è¯·æ±‚åŒ¹é…çš„æœåŠ¡å™¨å; ä¸åŒ…å«ç«¯å£</td></tr><tr><td style="text-align:left;"><code>$http_</code></td><td style="text-align:left;">è·å–httpç›¸å…³çš„ä¿¡æ¯; ä¾‹å¦‚<code>$http_user_agent</code>, <code>$http_cookie</code></td></tr><tr><td style="text-align:left;"><code>$remote_addr</code></td><td style="text-align:left;">å®¢æˆ·ç«¯ip</td></tr><tr><td style="text-align:left;"><code>$remote_port</code></td><td style="text-align:left;">å®¢æˆ·ç«¯ç«¯å£</td></tr><tr><td style="text-align:left;"><code>$request</code></td><td style="text-align:left;">å®Œæ•´çš„åŸå§‹è¯·æ±‚, ä¾‹å¦‚<code>POST /t01?cname=tom&amp;age=12 HTTP/1.1</code></td></tr><tr><td style="text-align:left;"><code>$request_length</code></td><td style="text-align:left;">è¯·æ±‚é•¿åº¦, åŒ…æ‹¬è¯·æ±‚è·¯å¾„ã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“</td></tr><tr><td style="text-align:left;"><code>$request_method</code></td><td style="text-align:left;">è¯·æ±‚æ–¹æ³•</td></tr><tr><td style="text-align:left;"><code>$request_time</code></td><td style="text-align:left;">è¯·æ±‚å¤„ç†æ—¶é—´(å•ä½: ç§’), åŒ…æ‹¬<code>nginx</code>æœåŠ¡ä»å‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯è·å–åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚å¼€å§‹ï¼Œåˆ°è¿”å›ç»™å®¢æˆ·ç«¯æœ€åä¸€ä¸ªå­—èŠ‚åç»è¿‡çš„æ—¶é—´</td></tr><tr><td style="text-align:left;"><code>$request_uri</code></td><td style="text-align:left;">å¸¦å‚æ•°çš„å®Œæ•´çš„uri; ä¾‹å¦‚ <code>/t01?cname=tom&amp;age=12</code></td></tr><tr><td style="text-align:left;"><code>$scheme</code></td><td style="text-align:left;">è¯·æ±‚åè®®</td></tr><tr><td style="text-align:left;"><code>$upstream_addr</code></td><td style="text-align:left;"><code>nginx</code>è½¬å‘ç»™åç«¯æœåŠ¡èŠ‚ç‚¹çš„åœ°å€, å³çœŸæ­£å¤„ç†è¯·æ±‚çš„æœåŠ¡å™¨åœ°å€</td></tr><tr><td style="text-align:left;"><code>$upstream_bytes_received</code></td><td style="text-align:left;">ä»åç«¯æœåŠ¡å™¨æ”¶åˆ°çš„å­—èŠ‚æ•°</td></tr><tr><td style="text-align:left;"><code>$upstream_bytes_sent</code></td><td style="text-align:left;">å‘é€ç»™åç«¯æœåŠ¡å™¨çš„å­—èŠ‚æ•°</td></tr><tr><td style="text-align:left;"><code>$upstream_connect_time</code></td><td style="text-align:left;">å’Œåç«¯æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„æ—¶é—´, å¦‚æœç”¨åˆ°åŠ å¯†åè®®è¿˜åŒ…æ‹¬æ¡æ‰‹æ—¶é—´</td></tr><tr><td style="text-align:left;"><code>$upstream_header_time</code></td><td style="text-align:left;">ä»åç«¯æœåŠ¡å™¨æ¥æ”¶å“åº”å¤´çš„æ—¶é—´, åŒ…æ‹¬å’Œåç«¯æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„æ—¶é—´, åˆ°æ¥æ”¶å®Œå“åº”å¤´çš„æ—¶é—´</td></tr><tr><td style="text-align:left;"><code>$upstream_response_length</code></td><td style="text-align:left;">ä»åç«¯æœåŠ¡å™¨æ¥æ”¶å“åº”çš„é•¿åº¦</td></tr><tr><td style="text-align:left;"><code>$upstream_response_time</code></td><td style="text-align:left;">ä»åç«¯æœåŠ¡å™¨æ¥æ”¶å“åº”çš„æ—¶é—´, åŒ…æ‹¬å’Œåç«¯æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„æ—¶é—´, æ¥æ”¶åˆ°å“åº”å¤´çš„æ—¶é—´, å’Œæ¥æ”¶å®Œå“åº”ä½“çš„æ—¶é—´</td></tr><tr><td style="text-align:left;"><code>$upstream_status</code></td><td style="text-align:left;">ä»åç«¯æœåŠ¡å™¨æ¥æ”¶çš„çŠ¶æ€ç </td></tr><tr><td style="text-align:left;"><code>$upstream_http_</code></td><td style="text-align:left;">ä»åç«¯æœåŠ¡å™¨æ¥æ”¶å“åº”å¤´çš„å€¼, ä¾‹å¦‚<code>upstream_http_content_type</code></td></tr></tbody></table><h2 id="main" tabindex="-1">main <a class="header-anchor" href="#main" aria-label="Permalink to â€œmainâ€">â€‹</a></h2><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># æŒ‡å®šè¿è¡ŒnginxæœåŠ¡çš„ç”¨æˆ·å’Œç»„, </span></span>
<span class="line"><span style="color:#88846F;"># syntax:	user user [group];</span></span>
<span class="line"><span style="color:#88846F;"># default:	user nobody nobody;</span></span>
<span class="line"><span style="color:#88846F;"># context:	main</span></span>
<span class="line"><span style="color:#A6E22E;">user</span><span style="color:#E6DB74;"> nginx</span><span style="color:#E6DB74;"> nginx</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># æŒ‡å®šå·¥ä½œè¿›ç¨‹æ•°, å¯ä»¥æŒ‡å®šå…·ä½“çš„è¿›ç¨‹æ•°, ä¹Ÿå¯ä»¥autoè‡ªåŠ¨è®¾ç½®</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	worker_processes number | auto;</span></span>
<span class="line"><span style="color:#88846F;"># default:	worker_processes 1;</span></span>
<span class="line"><span style="color:#88846F;"># context:	main</span></span>
<span class="line"><span style="color:#A6E22E;">worker_processes</span><span style="color:#AE81FF;"> 4</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># æŒ‡å®šå•ä¸ªè¿›ç¨‹æœ€å¤§èƒ½å¤Ÿæ‰“å¼€çš„æ–‡ä»¶æ•°é‡, å³æ–‡ä»¶æè¿°ç¬¦æ•°</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	worker_rlimit_nofile number;</span></span>
<span class="line"><span style="color:#88846F;"># default:	é»˜è®¤å€¼ä¸å½“å‰linuxç³»ç»Ÿä¸­è¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°é‡ç›¸åŒ</span></span>
<span class="line"><span style="color:#88846F;"># context:	main</span></span>
<span class="line"><span style="color:#A6E22E;">worker_rlimit_nofile</span><span style="color:#AE81FF;"> 65536</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># æŒ‡å®špidæ–‡ä»¶ä½ç½®, è¯¥æŒ‡ä»¤åªèƒ½åœ¨å…¨å±€å—é…ç½®</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	pid file;</span></span>
<span class="line"><span style="color:#88846F;"># default:	pid logs/nginx.pid;</span></span>
<span class="line"><span style="color:#88846F;"># context:	main</span></span>
<span class="line"><span style="color:#A6E22E;">pid</span><span style="color:#E6DB74;"> /var/run/nginx.pid</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># ç”¨æ¥åŒ…å«å…¶ä»–çš„é…ç½®æ–‡ä»¶, æ­¤å¤„ç”¨æ¥æŒ‡å®šåª’ä½“ç±»å‹é…ç½®æ–‡ä»¶</span></span>
<span class="line"><span style="color:#88846F;"># syntax:   include file;</span></span>
<span class="line"><span style="color:#88846F;"># context:  main, http, mail, stream, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">include</span><span style="color:#E6DB74;"> mime.types</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># å¯¹äºæ— æ‰©å±•åçš„æ–‡ä»¶, é»˜è®¤å…¶ä¸ºapplication/octet-streamç±»å‹, å³nginxä¼šå°†å…¶ä½œä¸ºä¸€ä¸ªå…«è¿›åˆ¶æµæ–‡ä»¶æ¥å¤„ç†</span></span>
<span class="line"><span style="color:#88846F;"># module:   ngx_http_core_module</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	default_type mime-type;</span></span>
<span class="line"><span style="color:#88846F;"># default:	default_type text/plain;</span></span>
<span class="line"><span style="color:#88846F;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">default_type</span><span style="color:#E6DB74;"> application/octet-stream</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># æ˜¯å¦å¼€å¯linuxç³»ç»Ÿçš„é›¶æ‹·è´æœºåˆ¶, å½“ç„¶è¿˜éœ€è¦å½“å‰æ“ä½œç³»ç»Ÿæ”¯æŒ</span></span>
<span class="line"><span style="color:#88846F;"># module:   ngx_http_core_module</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	sendfile on | off;</span></span>
<span class="line"><span style="color:#88846F;"># default:	sendfile off;</span></span>
<span class="line"><span style="color:#88846F;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">sendfile</span><span style="color:#E6DB74;"> on</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># å½“å¼€å¯è¯¥æŒ‡ä»¤æ˜¯ä¼šè°ƒç”¨æ“ä½œç³»ç»Ÿçš„tcp_corkæ–¹æ³•, å³åœ¨ä¸€å®šçš„æ—¶é—´æ®µ(é€šå¸¸ä¸º200ms), å°†å°æ•°æ®åŒ…æš‚å­˜, å¹¶å°†è¿™äº›å°æ•°æ®åŒ…æ•´åˆä¸ºä¸€ä¸ªå¤§çš„æ•°æ®åŒ…åå‘é€å‡ºå», å¯ä»¥ä¸€å®šç¨‹åº¦çš„æ”¹å–„ç½‘ç»œä¼ è¾“æ•ˆç‡</span></span>
<span class="line"><span style="color:#88846F;"># å½“å¼€å¯sendfileæŒ‡ä»¤æ—¶tcp_nopushæ‰ä¼šç”Ÿæ•ˆ, ä¸”å’Œtcp_nodelayæŒ‡ä»¤äº’æ–¥</span></span>
<span class="line"><span style="color:#88846F;"># module:   ngx_http_core_module</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	tcp_nopush on | off;</span></span>
<span class="line"><span style="color:#88846F;"># default:	tcp_nopush off;</span></span>
<span class="line"><span style="color:#88846F;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">tcp_nopush</span><span style="color:#E6DB74;"> off</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># å¼€å¯åä¼šç¦ç”¨tcp_nopushæŒ‡ä»¤, ä¸”åœ¨nginxå¼€å¯é•¿è¿æ¥æ‰ä¼šç”Ÿæ•ˆ, å³æ”¶åˆ°æ•°æ®åŒ…åå°½å¿«å‘é€å‡ºå»</span></span>
<span class="line"><span style="color:#88846F;"># module:   ngx_http_core_module</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	tcp_nodelay on | off;</span></span>
<span class="line"><span style="color:#88846F;"># default:	tcp_nodelay on;</span></span>
<span class="line"><span style="color:#88846F;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">tcp_nodelay</span><span style="color:#E6DB74;"> off</span><span style="color:#F8F8F2;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h2 id="events" tabindex="-1">events <a class="header-anchor" href="#events" aria-label="Permalink to â€œeventsâ€">â€‹</a></h2><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#A6E22E;">events</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#88846F;">    # å¯¹nginxå·¥ä½œè¿›ç¨‹æ¥æ”¶è¿æ¥åºåˆ—åŒ–, é˜²æ­¢å¤šä¸ªå·¥ä½œè¿›ç¨‹å¯¹è¿æ¥è¿›è¡Œäº‰æŠ¢(å½“å®¢æˆ·ç«¯å‘æ¥ä¸€ä¸ªè¯·æ±‚æ—¶, ä¼šæœ‰å¤šä¸ªnginxå·¥ä½œè¿›ç¨‹è¢«åŒæ—¶å”¤é†’, å³ä½¿æœ€ç»ˆåªæœ‰ä¸€ä¸ªå·¥ä½œè¿›ç¨‹ä¼šè·å¾—è¿æ¥, ä¸”å…¶ä»–å·¥ä½œè¿›ç¨‹ä¼šè¿›å…¥é˜»å¡çŠ¶æ€, å¦‚æœæ¯æ¬¡å”¤é†’çš„å·¥ä½œè¿›ç¨‹è¿‡å¤š, å°±ä¼šå½±å“nginxçš„æ•´ä½“æ€§èƒ½)</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	accept_mutex on | off;</span></span>
<span class="line"><span style="color:#88846F;">    # default:	accept_mutex off;</span></span>
<span class="line"><span style="color:#88846F;">    # context:	events</span></span>
<span class="line"><span style="color:#A6E22E;">    accept_mutex</span><span style="color:#E6DB74;"> on</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®å•ä¸ªnginxå·¥ä½œè¿›ç¨‹æ˜¯å¦å…è®¸åŒæ—¶æ¥æ”¶å¤šä¸ªç½‘ç»œè¿æ¥</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	multi_accept on | off;</span></span>
<span class="line"><span style="color:#88846F;">    # default:	multi_accept off;</span></span>
<span class="line"><span style="color:#88846F;">    # context:	events</span></span>
<span class="line"><span style="color:#A6E22E;">    multi_accept</span><span style="color:#E6DB74;"> on</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®I/Oäº‹ä»¶é©±åŠ¨æ¨¡å‹</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:   use  [method];</span></span>
<span class="line"><span style="color:#88846F;">    ## method:  [select | poll | kqueue | epoll | resig | /dev/poll | eventport]</span></span>
<span class="line"><span style="color:#88846F;">    # default:  é€‰æ‹©å½“å‰æ“ä½œç³»ç»Ÿæ”¯æŒçš„äº‹ä»¶é©±åŠ¨æ¨¡å‹</span></span>
<span class="line"><span style="color:#88846F;">    # context:  events</span></span>
<span class="line"><span style="color:#A6E22E;">    use</span><span style="color:#E6DB74;"> epoll</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®å•ä¸ªnginxå·¥ä½œè¿›ç¨‹å¯ä»¥åŒæ—¶å¼€å¯çš„æœ€å¤§è¿æ¥æ•°, å½“è¶…è¿‡è¿™ä¸ªå€¼æ—¶å°†ä¸åœ¨æ¥æ”¶è¿æ¥</span></span>
<span class="line"><span style="color:#88846F;">    # syntax: worker_connections number;</span></span>
<span class="line"><span style="color:#88846F;">    # default: worker_connections 512;</span></span>
<span class="line"><span style="color:#88846F;">    # context: events</span></span>
<span class="line"><span style="color:#A6E22E;">    worker_connections</span><span style="color:#AE81FF;"> 1024</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="httpä¸ƒå±‚ä»£ç†" tabindex="-1">httpä¸ƒå±‚ä»£ç† <a class="header-anchor" href="#httpä¸ƒå±‚ä»£ç†" aria-label="Permalink to â€œhttpä¸ƒå±‚ä»£ç†â€">â€‹</a></h2><h3 id="upstream" tabindex="-1">upstream <a class="header-anchor" href="#upstream" aria-label="Permalink to â€œupstreamâ€">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># ç”¨äºå®šä¹‰å¯ä»¥ç”±proxy_passæŒ‡ä»¤å¼•ç”¨çš„æœåŠ¡å™¨ç»„, å¯ä»¥æŒ‡å®šæœåŠ¡èŠ‚ç‚¹çš„åœ°å€å’Œç›¸å…³çš„å‚æ•°, æœåŠ¡å™¨åœ°å€å¯ä»¥æ˜¯å¸¦ç«¯å£çš„åŸŸåæˆ–è€…ipåœ°å€ã€unixå¥—æ¥å­—è·¯å¾„, å‚æ•°å¯ä»¥è®¾ç½®æœåŠ¡æƒé‡ã€å¥åº·æ£€æŸ¥ç­‰</span></span>
<span class="line"><span style="color:#88846F;"># module: ngx_http_upstream_module</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	server address [parameters];</span></span>
<span class="line"><span style="color:#88846F;"># default:	â€”</span></span>
<span class="line"><span style="color:#88846F;"># context:	http</span></span>
<span class="line"><span style="color:#A6E22E;">upstream</span><span style="color:#E6DB74;"> backend</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.100:8080</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> ep01.example.com:8081</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> unix:/opt/app/uwsgi.sock</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®æœåŠ¡èŠ‚ç‚¹çš„æƒé‡</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	server address weight=number;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.101:8080</span><span style="color:#E6DB74;"> weight=</span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®åŒæ—¶è¿æ¥åˆ°è¯¥æœåŠ¡èŠ‚ç‚¹çš„æœ€å¤§è¿æ¥æ•°, é™åˆ¶æµé‡</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	server address max_conns=number;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.102:8080</span><span style="color:#E6DB74;"> max_conns=</span><span style="color:#AE81FF;">10</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # åœ¨fail_timeoutæ—¶é—´å†…ä¸æœåŠ¡å°è¯•é€šä¿¡å¤±è´¥max_failsæ¬¡, åˆ™è§†ä¸ºæœåŠ¡ä¸å¯ç”¨ä¸”æµé‡ä¸ä¼šè½¬å‘åˆ°è¯¥æœåŠ¡èŠ‚ç‚¹ä¸Š;å¦‚æœåªæœ‰ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹å°†å¿½ç•¥è¯¥å‚æ•°</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	server address max_fails=number fail_timeout=time; </span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.103:8080</span><span style="color:#E6DB74;"> max_fails=</span><span style="color:#AE81FF;">3</span><span style="color:#E6DB74;"> fail_timeout=</span><span style="color:#AE81FF;">10</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # æ ‡è®°å½“å‰æœåŠ¡èŠ‚ç‚¹ä¸ºå¤‡ç”¨èŠ‚ç‚¹, å½“ä¸»æœåŠ¡èŠ‚ç‚¹ä¸å¯ç”¨æ—¶, è¯¥èŠ‚ç‚¹æ‰ä¼šæ¥æ”¶è¿æ¥å¤„ç†è¯·æ±‚æ³¨æ„è¯¥å‚æ•°ä¸èƒ½ä¸hashå’Œrandomä¸€èµ·ä½¿ç”¨</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	server address backup;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.104:8080</span><span style="color:#E6DB74;"> backup</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # ç”¨äºæ ‡è®°èŠ‚ç‚¹ä¸ºä¸å¯ç”¨</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	server address down;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.101:8080</span><span style="color:#E6DB74;"> down</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®æœåŠ¡èŠ‚ç‚¹ä»æƒé‡ä»0æ¢å¤åˆ°æ­£å¸¸å€¼çš„æ—¶é—´; æ³¨æ„è¯¥å‚æ•°ä¸èƒ½ç”¨åœ¨åªæœ‰ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹æˆ–è€…ä½¿ç”¨hashã€randomè´Ÿè½½æ¨¡å¼ä¸‹</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	server address slow_start=time;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.101:8080</span><span style="color:#E6DB74;"> weight=</span><span style="color:#AE81FF;">4</span><span style="color:#E6DB74;"> slow_start=</span><span style="color:#AE81FF;">60</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="server" tabindex="-1">server <a class="header-anchor" href="#server" aria-label="Permalink to â€œserverâ€">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># ç”¨æ¥é…ç½®è™šæ‹Ÿä¸»æœº, å³æ¯ä¸€ä¸ªserverå—å°±æ˜¯ä¸€ä¸ªè™šæ‹Ÿä¸»æœº</span></span>
<span class="line"><span style="color:#88846F;"># module: ngx_http_core_module</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># syntax:	server { ... }</span></span>
<span class="line"><span style="color:#88846F;"># default:	â€”</span></span>
<span class="line"><span style="color:#88846F;"># context:	http</span></span>
<span class="line"><span style="color:#A6E22E;">server</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®nginxæœåŠ¡å™¨ç›‘å¬çš„åœ°å€å’Œç«¯å£</span></span>
<span class="line"><span style="color:#88846F;">    # æ²¡æœ‰æ˜¾ç¤ºçš„ç”³æ˜default_serveræ˜¯, nginxä¼šå°†é…ç½®çš„ç¬¬ä¸€ä¸ªserverä½œä¸ºdefault_server</span></span>
<span class="line"><span style="color:#88846F;">    # å½“è¯·æ±‚æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•server_nameæ—¶,default_serverä¼šå¤„ç†è¯¥è¯·æ±‚</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	listen port [default_server] [ssl] [http2 | quic];</span></span>
<span class="line"><span style="color:#88846F;">    # default:	listen *:80 | *:8000;</span></span>
<span class="line"><span style="color:#88846F;">    # context:	server</span></span>
<span class="line"><span style="color:#A6E22E;">    listen</span><span style="color:#AE81FF;"> 80</span><span style="color:#E6DB74;"> default_server</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    listen</span><span style="color:#F8F8F2;"> [::]:80;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # ä¸ºè™šæ‹Ÿä¸»æœºè®¾ç½®åç§°, å¯ä»¥é…ç½®å¤šä¸ªserver_name, å¯ä»¥ä½¿ç”¨é€šé…ç¬¦, æ­£åˆ™è¡¨è¾¾å¼ç­‰</span></span>
<span class="line"><span style="color:#88846F;">    # åŒ¹é…è§„åˆ™: ä¾æ¬¡æŒ‰ç…§ç²¾ç¡®åŒ¹é…ã€ä»¥*é€šé…ç¬¦å¼€å§‹çš„æœ€é•¿å­—ç¬¦ä¸²åŒ¹é…ã€ä»¥*é€šé…ç¬¦ç»“æŸçš„æœ€é•¿å­—ç¬¦ä¸²åŒ¹é…ã€ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	server_name name ...;</span></span>
<span class="line"><span style="color:#88846F;">    # default:	server_name &quot;&quot;;</span></span>
<span class="line"><span style="color:#88846F;">    # context:	server</span></span>
<span class="line"><span style="color:#A6E22E;">    server_name</span><span style="color:#E6DB74;"> www.example.com</span><span style="color:#E6DB74;"> bbs.example.com</span><span style="color:#E6DB74;"> .example.com</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server_name</span><span style="color:#FD971F;"> *</span><span style="color:#E6DB74;">.example.com</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server_name</span><span style="color:#E6DB74;"> www.example.</span><span style="color:#FD971F;">*</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server_name</span><span style="color:#E6DB74;"> www</span><span style="color:#AE81FF;">\d</span><span style="color:#E6DB74;">+</span><span style="color:#AE81FF;">\.</span><span style="color:#E6DB74;">example</span><span style="color:#AE81FF;">\.</span><span style="color:#E6DB74;">com</span><span style="color:#F8F8F2;">$;</span></span>
<span class="line"><span style="color:#A6E22E;">    server_name</span><span style="color:#E6DB74;"> _</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # æ˜¯å¦å¼€å¯åœ¨å“åº”å¤´ä¸­æ˜¾ç¤ºnginxæœåŠ¡å™¨ç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	server_tokens on | off | build;</span></span>
<span class="line"><span style="color:#88846F;">    # default:	server_tokens on;</span></span>
<span class="line"><span style="color:#88846F;">    # context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">    server_tokens</span><span style="color:#E6DB74;"> off</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # æ·»åŠ å“åº”å¤´</span></span>
<span class="line"><span style="color:#88846F;">    # module:   ngx_http_headers_module</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	add_header name value [always];</span></span>
<span class="line"><span style="color:#88846F;">    # default:	â€”</span></span>
<span class="line"><span style="color:#88846F;">    # context:	http, server, location</span></span>
<span class="line"><span style="color:#88846F;">    # æ·»åŠ å“åº”å¤´è§£å†³è·¨åŸŸé—®é¢˜</span></span>
<span class="line"><span style="color:#A6E22E;">    add_header</span><span style="color:#E6DB74;"> &#39;Access-Control-Allow-Origin&#39;</span><span style="color:#F8F8F2;"> $http_origin;</span></span>
<span class="line"><span style="color:#A6E22E;">    add_header</span><span style="color:#E6DB74;"> &#39;Access-Control-Allow-Credentials&#39;</span><span style="color:#E6DB74;"> &#39;true&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    add_header</span><span style="color:#E6DB74;"> &#39;Access-Control-Allow-Methods&#39;</span><span style="color:#E6DB74;"> &#39;GET, POST, OPTIONS&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    add_header</span><span style="color:#E6DB74;"> &#39;Access-Control-Allow-Headers&#39;</span><span style="color:#E6DB74;"> &#39;DNT,Authorization,Accept,Origin,Keep-Alive,User-Agent,X-Mx-ReqToken,X-Data-Type,X-Auth-Token,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    add_header</span><span style="color:#E6DB74;"> &#39;Access-Control-Expose-Headers&#39;</span><span style="color:#E6DB74;"> &#39;Content-Length,Content-Range&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®è¢«åµŒå…¥(iframe)è§„åˆ™</span></span>
<span class="line"><span style="color:#88846F;">    # DENY è¯¥é¡µé¢ä¸å…è®¸åœ¨frameä¸­å±•ç¤º</span></span>
<span class="line"><span style="color:#88846F;">    # SAMEORIGIN è¯¥é¡µé¢å¯ä»¥åœ¨ç›¸åŒåŸŸåé¡µé¢çš„frameä¸­å±•ç¤º</span></span>
<span class="line"><span style="color:#88846F;">    # ALLOW-FROM uri è¡¨ç¤ºè¯¥é¡µé¢å¯ä»¥åœ¨æŒ‡å®šæ¥æºçš„frameä¸­å±•ç¤º</span></span>
<span class="line"><span style="color:#A6E22E;">    add_header</span><span style="color:#E6DB74;"> X-Frame-Options</span><span style="color:#E6DB74;"> &quot;SAMEORIGIN&quot;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®ç”¨äºè¯»å–å®¢æˆ·ç«¯è¯·æ±‚ä½“çš„ç¼“å†²å™¨å¤§å°, å¦‚æœè¯·æ±‚ä½“å¤§äºç¼“å†²åŒºå¤§å°, åˆ™ä¼šå†™å…¥ä¸´æ—¶æ–‡ä»¶ä¸­</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	client_body_buffer_size size;</span></span>
<span class="line"><span style="color:#88846F;">    # default:	client_body_buffer_size 8k|16k;</span></span>
<span class="line"><span style="color:#88846F;">    # context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">    client_body_buffer_size</span><span style="color:#E6DB74;"> 1024k</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®ç”¨äºå­˜å‚¨å®¢æˆ·ç«¯è¯·æ±‚ä½“çš„å†å²æ–‡ä»¶, åœ¨æŒ‡å®šçš„ç›®å½•ä¸‹æœ€å¤šå¯ä»¥ä½¿ç”¨ä¸‰æç›®å½•ç»“æ„</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	client_body_temp_path path [level1 [level2 [level3]]];</span></span>
<span class="line"><span style="color:#88846F;">    # default:	client_body_temp_path client_body_temp;</span></span>
<span class="line"><span style="color:#88846F;">    # context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">    client_body_temp_path</span><span style="color:#E6DB74;"> /opt/nginx/client_body_temp</span><span style="color:#AE81FF;"> 1</span><span style="color:#AE81FF;"> 2</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚ä½“çš„æœ€å¤§å¤§å°, è¶…è¿‡è¿™ä¸ªå¤§å°åˆ™è¿”å›413 Request Entity Too Large</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	client_max_body_size size;</span></span>
<span class="line"><span style="color:#88846F;">    # default:	client_max_body_size 1m;</span></span>
<span class="line"><span style="color:#88846F;">    # context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">    client_max_body_size</span><span style="color:#E6DB74;"> 10m</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®ç”¨äºè¯»å–å®¢æˆ·ç«¯è¯·æ±‚å¤´çš„ç¼“å†²å™¨å¤§å°, å¦‚æœè¯·æ±‚å¤´è¿‡é•¿, åˆ™åˆ†é…large_client_header_buffers</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	client_header_buffer_size size;</span></span>
<span class="line"><span style="color:#88846F;">    # default:	client_header_buffer_size 1k;</span></span>
<span class="line"><span style="color:#88846F;">    # context:	http, server</span></span>
<span class="line"><span style="color:#A6E22E;">    client_header_buffer_size</span><span style="color:#E6DB74;"> 4k</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®ç”¨äºè¯»å–å¤§å‹å®¢æˆ·ç«¯è¯·æ±‚å¤´çš„ç¼“å†²åŒºæ•°é‡å’Œå¤§å°</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	large_client_header_buffers number size;</span></span>
<span class="line"><span style="color:#88846F;">    # default:	large_client_header_buffers 4 8k;</span></span>
<span class="line"><span style="color:#88846F;">    # context:	http, server</span></span>
<span class="line"><span style="color:#A6E22E;">    large_client_header_buffers</span><span style="color:#AE81FF;"> 4</span><span style="color:#E6DB74;"> 32k</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®è¯»å–å®¢æˆ·ç«¯è¯·æ±‚å¤´çš„è¶…æ—¶æ—¶é—´, è¶…æ—¶åˆ™è¿”å›408 Request Timed Out</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	client_header_timeout time;</span></span>
<span class="line"><span style="color:#88846F;">    # default:	client_header_timeout 60s;</span></span>
<span class="line"><span style="color:#88846F;">    # context:	http, server</span></span>
<span class="line"><span style="color:#A6E22E;">    client_header_timeout</span><span style="color:#E6DB74;"> 20s</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®keepalivecè¶…æ—¶æ—¶é—´, åœ¨ä¸€ä¸ªæ´»è·ƒè¿æ¥è¶…è¿‡è¯¥æ—¶é—´å, æœåŠ¡å™¨å’Œæµè§ˆå™¨éƒ½ä¼šå»å…³é—­è¿™ä¸ªè¿æ¥, å½“ç„¶è¯¥å‚æ•°æ˜¯çº¦æŸnginxæœåŠ¡å™¨çš„, nginxä¹Ÿä¼šæŒ‰ç…§è§„èŒƒæŠŠè¿™ä¸ªæ—¶é—´ä¼ ç»™æµè§ˆå™¨, ä½†æ¯ä¸ªæµè§ˆå™¨å¯¹å¾…keepaliveçš„ç­–ç•¥æœ‰å¯èƒ½æ˜¯ä¸åŒçš„</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	keepalive_timeout timeout [header_timeout];</span></span>
<span class="line"><span style="color:#88846F;">    # default:	keepalive_timeout 75s;</span></span>
<span class="line"><span style="color:#88846F;">    # context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">    keepalive_timeout</span><span style="color:#E6DB74;"> 60s</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®ä½¿ç”¨proxy_hide_headerå’Œproxy_set_headeræŒ‡ä»¤æ—¶ä½¿ç”¨çš„æœ€å¤§hashè¡¨å¤§å°</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	proxy_headers_hash_max_size size;</span></span>
<span class="line"><span style="color:#88846F;">    # default:	proxy_headers_hash_max_size 512;</span></span>
<span class="line"><span style="color:#88846F;">    # context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">    proxy_headers_hash_max_size</span><span style="color:#AE81FF;"> 512</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®ä½¿ç”¨proxy_hide_headerå’Œproxy_set_headeræŒ‡ä»¤æ—¶ä½¿ç”¨çš„hashè¡¨å­˜å‚¨æ¡¶çš„å¤§å°</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	proxy_headers_hash_bucket_size size;</span></span>
<span class="line"><span style="color:#88846F;">    # default:	proxy_headers_hash_bucket_size 64;</span></span>
<span class="line"><span style="color:#88846F;">    # context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">    proxy_headers_hash_bucket_size</span><span style="color:#AE81FF;"> 64</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # å’Œåç«¯ä»£ç†æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	proxy_connect_timeout time;</span></span>
<span class="line"><span style="color:#88846F;">    # default:	proxy_connect_timeout 60s;</span></span>
<span class="line"><span style="color:#88846F;">    # context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">    proxy_connect_timeout</span><span style="color:#E6DB74;"> 20s</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®æ ¹æ®uriåŒ¹é…å¹¶ä¸”å®šä½åˆ°å¯¹åº”çš„å¤„ç†è¯¥è¯·æ±‚çš„é…ç½®</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	location [ = | ~ | ~* | ^~ ] uri { ... }</span></span>
<span class="line"><span style="color:#88846F;">    # default:	â€”</span></span>
<span class="line"><span style="color:#88846F;">    # context:	server</span></span>
<span class="line"><span style="color:#A6E22E;">    location</span><span style="color:#E6DB74;"> /</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">        # ä¿®æ”¹æˆ–è¿½åŠ ä¼ é€’ç»™åç«¯æœåŠ¡èŠ‚ç‚¹çš„è¯·æ±‚å¤´</span></span>
<span class="line"><span style="color:#88846F;">        # syntax:	proxy_set_header field value;</span></span>
<span class="line"><span style="color:#88846F;">        # default:	proxy_set_header Host $proxy_host;</span></span>
<span class="line"><span style="color:#88846F;">        #           proxy_set_header Connection close;</span></span>
<span class="line"><span style="color:#88846F;">        # context:	http, server, location</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span></span>
<span class="line"><span style="color:#88846F;">        # example01: è®¾ç½®è¯·æ±‚å¤´host</span></span>
<span class="line"><span style="color:#A6E22E;">        proxy_set_header</span><span style="color:#E6DB74;"> Host</span><span style="color:#F8F8F2;"> $host;</span></span>
<span class="line"><span style="color:#88846F;">        # example02: è®¾ç½®è¯·æ±‚å¤´X-Real-IPä¸º$remote_addr</span></span>
<span class="line"><span style="color:#88846F;">        # $remote_addræ˜¯æŒ‡è®¿é—®nginxæœåŠ¡å™¨çš„å®¢æˆ·ç«¯, å¹¶éæœ€åˆçš„å®¢æˆ·ç«¯ipåœ°å€</span></span>
<span class="line"><span style="color:#A6E22E;">        proxy_set_header</span><span style="color:#E6DB74;"> X-Real-IP</span><span style="color:#F8F8F2;"> $remote_addr;</span></span>
<span class="line"><span style="color:#88846F;">        # example03: è®¾ç½®è¯·æ±‚å¤´X-Forwarded-For $proxy_add_x_forwarded_for</span></span>
<span class="line"><span style="color:#88846F;">        # $proxy_add_x_forwarded_forä»£è¡¨é™„åŠ $remote_addrå˜é‡çš„å®¢æˆ·ç«¯è¯·æ±‚å¤´X-Forwarded-For, å¯ä»¥ç†è§£ä¸º$proxy_add_x_forwarded_forä¼šä¾æ¬¡è®°å½•$remote_addrå€¼å¹¶ä»¥é€—å·åˆ†éš”, ç¬¬ä¸€ä¸ªå€¼å°±æ˜¯å®¢æˆ·ç«¯ip</span></span>
<span class="line"><span style="color:#88846F;">        # å¦‚æœX-Forwarded-Forå­—æ®µæ²¡å‡ºç°åœ¨å®¢æˆ·ç«¯è¯·æ±‚å¤´ä¸­, $proxy_add_x_forwarded_forç­‰åŒäº$remote_addr</span></span>
<span class="line"><span style="color:#A6E22E;">        proxy_set_header</span><span style="color:#E6DB74;"> X-Forwarded-For</span><span style="color:#F8F8F2;"> $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span></span>
<span class="line"><span style="color:#88846F;">        # è®¾ç½®ä»£ç†æœåŠ¡å™¨åœ°å€ç«¯å£å’Œåè®®, åè®®å¯ä»¥æ˜¯httpæˆ–è€…https, åœ°å€å¯ä»¥ä½¿ipåŸŸåæˆ–è€…upstreamä¸­é…ç½®çš„æœåŠ¡å™¨ç»„</span></span>
<span class="line"><span style="color:#88846F;">        # syntax:	proxy_pass URL;</span></span>
<span class="line"><span style="color:#88846F;">        # default:	â€”</span></span>
<span class="line"><span style="color:#88846F;">        # context:	location</span></span>
<span class="line"><span style="color:#A6E22E;">        proxy_pass</span><span style="color:#E6DB74;"> http://www.example.com</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br></div></div><h3 id="locationåŒ¹é…è§„åˆ™" tabindex="-1">locationåŒ¹é…è§„åˆ™ <a class="header-anchor" href="#locationåŒ¹é…è§„åˆ™" aria-label="Permalink to â€œlocationåŒ¹é…è§„åˆ™â€">â€‹</a></h3><table tabindex="0"><thead><tr><th style="text-align:left;">è¡¨è¾¾å¼</th><th style="text-align:left;">æ¨¡å¼</th><th style="text-align:left;">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left;">=</td><td style="text-align:left;">ç²¾ç¡®åŒ¹é…</td><td style="text-align:left;">åŒ¹é…æˆåŠŸ,åˆ™ç»ˆæ­¢å…¶ä»–locationçš„åŒ¹é…é¡¹,ä¼˜å…ˆçº§æœ€é«˜</td></tr><tr><td style="text-align:left;">^~</td><td style="text-align:left;">å‰ç¼€åŒ¹é…</td><td style="text-align:left;">å’Œé¡ºåºæ— å…³,æŒ‰ç…§å‘½ä¸­é•¿çŸ­æ¥ç¡®å®š</td></tr><tr><td style="text-align:left;">~</td><td style="text-align:left;">æ­£åˆ™åŒ¹é…,åŒºåˆ†å¤§å°å†™</td><td style="text-align:left;">å’Œé¡ºåºæœ‰å…³ç³»,åŒ¹é…åˆ°äº†å°±åœæ­¢</td></tr><tr><td style="text-align:left;">~*</td><td style="text-align:left;">æ­£åˆ™åŒ¹é…,ä¸åŒºåˆ†å¤§å°å†™</td><td style="text-align:left;">å’Œé¡ºåºæœ‰å…³ç³»,åŒ¹é…åˆ°äº†å°±åœæ­¢</td></tr><tr><td style="text-align:left;">/</td><td style="text-align:left;">æ™®é€šåŒ¹é…</td><td style="text-align:left;">å’Œé¡ºåºæ— å…³,æŒ‰ç…§å‘½ä¸­é•¿çŸ­æ¥ç¡®å®š,ä¼˜å…ˆçº§æœ€ä½</td></tr></tbody></table><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># syntax:	location [ = | ~ | ~* | ^~ ] uri { ... }</span></span>
<span class="line"><span style="color:#88846F;"># default:	â€”</span></span>
<span class="line"><span style="color:#88846F;"># context:	server</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="ç²¾ç¡®åŒ¹é…" tabindex="-1">ç²¾ç¡®åŒ¹é… <a class="header-anchor" href="#ç²¾ç¡®åŒ¹é…" aria-label="Permalink to â€œç²¾ç¡®åŒ¹é…â€">â€‹</a></h4><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># uriå¿…é¡»å®Œå…¨ä¸€è‡´æ‰èƒ½åŒ¹é…åˆ°</span></span>
<span class="line"><span style="color:#A6E22E;">location</span><span style="color:#E6DB74;"> =</span><span style="color:#E6DB74;"> /abc</span><span style="color:#E6DB74;"> {}</span></span>
<span class="line"><span style="color:#88846F;"># å¯ä»¥åŒ¹é…åˆ°</span></span>
<span class="line"><span style="color:#A6E22E;">http://localhost/abc</span></span>
<span class="line"><span style="color:#A6E22E;">http://localhost/abc?key</span><span style="color:#E6DB74;">=1</span></span>
<span class="line"><span style="color:#88846F;"># ä¸èƒ½åŒ¹é…åˆ°</span></span>
<span class="line"><span style="color:#A6E22E;">http://localhost/abc/</span></span>
<span class="line"><span style="color:#A6E22E;">http://localhost/abcd</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="å‰ç¼€åŒ¹é…" tabindex="-1">å‰ç¼€åŒ¹é… <a class="header-anchor" href="#å‰ç¼€åŒ¹é…" aria-label="Permalink to â€œå‰ç¼€åŒ¹é…â€">â€‹</a></h4><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># uriå¿…é¡»ä»¥æŒ‡å®šçš„å‰ç¼€å¼€å¤´æ‰èƒ½åŒ¹é…åˆ°</span></span>
<span class="line"><span style="color:#A6E22E;">location</span><span style="color:#E6DB74;"> ^~</span><span style="color:#E6DB74;"> /static/</span><span style="color:#E6DB74;"> {}</span></span>
<span class="line"><span style="color:#88846F;"># åªæœ‰uriä»¥/static/å¼€å¤´æ‰èƒ½åŒ¹é…åˆ°</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="æ­£åˆ™åŒ¹é…" tabindex="-1">æ­£åˆ™åŒ¹é… <a class="header-anchor" href="#æ­£åˆ™åŒ¹é…" aria-label="Permalink to â€œæ­£åˆ™åŒ¹é…â€">â€‹</a></h4><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># uriéœ€è¦ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼æ‰èƒ½åŒ¹é…åˆ°</span></span>
<span class="line"><span style="color:#A6E22E;">location</span><span style="color:#E6DB74;"> =</span><span style="color:#E6DB74;"> ~</span><span style="color:#FD971F;">*</span><span style="color:#AE81FF;"> \.</span><span style="color:#F8F8F2;">(</span><span style="color:#A6E22E;">jpg</span><span style="color:#F92672;">|</span><span style="color:#A6E22E;">png</span><span style="color:#F92672;">|</span><span style="color:#A6E22E;">gif</span><span style="color:#F8F8F2;">)$  </span><span style="color:#E6DB74;">{}</span></span>
<span class="line"><span style="color:#88846F;"># uriä¸­ä»¥.jpg .png .gifç»“å°¾çš„æ‰èƒ½åŒ¹é…åˆ°</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="é€šç”¨åŒ¹é…" tabindex="-1">é€šç”¨åŒ¹é… <a class="header-anchor" href="#é€šç”¨åŒ¹é…" aria-label="Permalink to â€œé€šç”¨åŒ¹é…â€">â€‹</a></h4><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># ä»»ä½•uriéƒ½èƒ½åŒ¹é…åˆ°, ä½†æ˜¯ä¼˜å…ˆçº§æœ€ä½</span></span>
<span class="line"><span style="color:#A6E22E;">location</span><span style="color:#E6DB74;"> /</span><span style="color:#E6DB74;"> {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="proxy-passåŒ¹é…è§„åˆ™" tabindex="-1">proxy_passåŒ¹é…è§„åˆ™ <a class="header-anchor" href="#proxy-passåŒ¹é…è§„åˆ™" aria-label="Permalink to â€œproxy_passåŒ¹é…è§„åˆ™â€">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#A6E22E;">location</span><span style="color:#E6DB74;"> /apis/v1</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#88846F;">    # å¦‚æœproxy_passåé¢æ²¡æœ‰æºå¸¦uri, åˆ™å®¢æˆ·ç«¯è¯·æ±‚uriä¼šå®Œæ•´çš„ä¼ é€’åˆ°åç«¯æœåŠ¡å™¨; ä¾‹å¦‚å®¢æˆ·ç«¯çš„uri: /apis/v1/user, ä¼ é€’ç»™åç«¯èŠ‚ç‚¹çš„uri: /apis/v1/user</span></span>
<span class="line"><span style="color:#A6E22E;">    proxy_pass</span><span style="color:#E6DB74;"> http://192.168.10.100:8080</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6E22E;">location</span><span style="color:#E6DB74;"> /apis/v1</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#88846F;">    # å¦‚æœproxy_passåé¢æºå¸¦äº†uri, åˆ™å®¢æˆ·ç«¯çš„è¯·æ±‚uriåˆ™ä¼šå°†åŒ¹é…åˆ°çš„éƒ¨åˆ†æ›¿æ¢ä¸ºproxy_passæŒ‡ä»¤ä¸­é…ç½®çš„uri; ä¾‹å¦‚å®¢æˆ·ç«¯çš„uri: /apis/v1/user, ä¼ é€’ç»™åç«¯èŠ‚ç‚¹çš„uri: /api/v2/user</span></span>
<span class="line"><span style="color:#A6E22E;">    proxy_pass</span><span style="color:#E6DB74;"> http://192.168.10.100:8080/api/v2</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="gzipå‹ç¼©" tabindex="-1">gzipå‹ç¼© <a class="header-anchor" href="#gzipå‹ç¼©" aria-label="Permalink to â€œgzipå‹ç¼©â€">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># æ˜¯å¦å¼€å¯gzipå‹ç¼©æŒ‡ä»¤</span></span>
<span class="line"><span style="color:#88846F;"># module:   ngx_http_gzip_module</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	gzip on | off;</span></span>
<span class="line"><span style="color:#88846F;"># default:	gzip off;</span></span>
<span class="line"><span style="color:#88846F;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">gzip</span><span style="color:#E6DB74;"> on</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># è®¾ç½®éœ€è¦è¿›è¡Œgzipå‹ç¼©çš„æ–‡ä»¶ç±»å‹</span></span>
<span class="line"><span style="color:#88846F;"># module:   ngx_http_gzip_module</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	gzip_types mime-type ...;</span></span>
<span class="line"><span style="color:#88846F;"># default:	gzip_types text/html;</span></span>
<span class="line"><span style="color:#88846F;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">gzip_types</span><span style="color:#E6DB74;"> text/plain</span><span style="color:#E6DB74;"> text/css</span><span style="color:#E6DB74;"> application/javascript</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># è®¾ç½®å‹ç¼©ç­‰çº§, èŒƒå›´ä¸º1åˆ°9, æ•°å­—è¶Šå¤§å‹ç¼©ç‡è¶Šé«˜, ä½†åŒæ—¶ä¹Ÿä¼šå¢åŠ å‹ç¼©çš„æ—¶é—´</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	gzip_comp_level level;</span></span>
<span class="line"><span style="color:#88846F;"># default:	gzip_comp_level 1;</span></span>
<span class="line"><span style="color:#88846F;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">gzip_comp_level</span><span style="color:#AE81FF;"> 2</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># è®¾ç½®è¿›è¡Œgzipå‹ç¼©çš„æœ€å°æ–‡ä»¶å¤§å°, åªæœ‰å½“æ–‡ä»¶å¤§å°è¶…è¿‡è¯¥å€¼æ—¶, æ‰ä¼šè¿›è¡Œgzipå‹ç¼©</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	gzip_min_length length;</span></span>
<span class="line"><span style="color:#88846F;"># default:	gzip_min_length 20;</span></span>
<span class="line"><span style="color:#88846F;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">gzip_min_length</span><span style="color:#E6DB74;"> 1k</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># è®¾ç½®æœ€å°çš„éœ€è¦gzipå‹ç¼©å“åº”çš„httpåè®®ç‰ˆæœ¬å·</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	gzip_http_version 1.0 | 1.1;</span></span>
<span class="line"><span style="color:#88846F;"># default:	gzip_http_version 1.1;</span></span>
<span class="line"><span style="color:#88846F;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">gzip_http_version</span><span style="color:#AE81FF;"> 1.1</span><span style="color:#F8F8F2;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="æ—¥å¿—é…ç½®" tabindex="-1">æ—¥å¿—é…ç½® <a class="header-anchor" href="#æ—¥å¿—é…ç½®" aria-label="Permalink to â€œæ—¥å¿—é…ç½®â€">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># è®¾ç½®é”™è¯¯æ—¥å¿—å­˜å‚¨ä½ç½®å’Œæ—¥å¿—ç­‰çº§</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	error_log file [level: debug | info | notice | warn | error | crit | alert];</span></span>
<span class="line"><span style="color:#88846F;"># default:	error_log logs/error.log error;</span></span>
<span class="line"><span style="color:#88846F;"># context:	main, http, mail, stream, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">error_log</span><span style="color:#E6DB74;"> /var/log/nginx/error.log</span><span style="color:#E6DB74;"> notice</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># æ—¥å¿—æ ¼å¼, åŸºæœ¬åŒ…å«äº†æ‰€æœ‰çš„å­—æ®µ ,å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	log_format name [escape=default|json|none] string ...;</span></span>
<span class="line"><span style="color:#88846F;"># default:	log_format combined &quot;...&quot;;</span></span>
<span class="line"><span style="color:#88846F;"># context:	http</span></span>
<span class="line"><span style="color:#A6E22E;">log_format</span><span style="color:#E6DB74;"> main</span><span style="color:#E6DB74;"> &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span></span>
<span class="line"><span style="color:#A6E22E;">                &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span></span>
<span class="line"><span style="color:#A6E22E;">                &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot; &#39;</span></span>
<span class="line"><span style="color:#A6E22E;">                &#39;[$request_time $upstream_addr $upstream_connect_time $upstream_bytes_sent &#39;</span></span>
<span class="line"><span style="color:#A6E22E;">                &#39;$upstream_header_time $upstream_response_time $upstream_status $upstream_bytes_received $upstream_response_length $upstream_http_content_type]&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># è®¿é—®æ—¥å¿—</span></span>
<span class="line"><span style="color:#88846F;"># Syntax:	access_log path [format [buffer=size] [gzip[=level]] [flush=time] [if=condition]];</span></span>
<span class="line"><span style="color:#88846F;"># 			access_log off;</span></span>
<span class="line"><span style="color:#88846F;"># Default:	access_log logs/access.log combined;</span></span>
<span class="line"><span style="color:#88846F;"># Context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">access_log</span><span style="color:#E6DB74;"> /var/log/nginx/access.log</span><span style="color:#E6DB74;"> main</span><span style="color:#E6DB74;"> buffer=32k</span><span style="color:#F8F8F2;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="nginxæœåŠ¡çŠ¶æ€" tabindex="-1">nginxæœåŠ¡çŠ¶æ€ <a class="header-anchor" href="#nginxæœåŠ¡çŠ¶æ€" aria-label="Permalink to â€œnginxæœåŠ¡çŠ¶æ€â€">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># ä¸€èˆ¬ç”¨äºnginxè¿æ¥çš„çŠ¶æ€ç›‘æ§</span></span>
<span class="line"><span style="color:#88846F;"># module:   ngx_http_stub_status_module</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	stub_status;</span></span>
<span class="line"><span style="color:#88846F;"># default:	â€”</span></span>
<span class="line"><span style="color:#88846F;"># context:	server, location</span></span>
<span class="line"><span style="color:#A6E22E;">location</span><span style="color:#E6DB74;"> /ngx_status</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">    stub_status</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><table tabindex="0"><thead><tr><th style="text-align:left;">çŠ¶æ€</th><th style="text-align:left;">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left;"><code>Active connections</code></td><td style="text-align:left;">å½“å‰æ´»è·ƒçš„å®¢æˆ·ç«¯è¿æ¥æ•°, åŒ…æ‹¬ç­‰å¾…çš„è¿æ¥æ•°</td></tr><tr><td style="text-align:left;"><code>accepts</code></td><td style="text-align:left;">å·²æ¥æ”¶çš„å®¢æˆ·ç«¯è¯·æ±‚æ•°</td></tr><tr><td style="text-align:left;"><code>handled</code></td><td style="text-align:left;">å·²å¤„ç†çš„å®¢æˆ·ç«¯è¯·æ±‚æ•°</td></tr><tr><td style="text-align:left;"><code>requests</code></td><td style="text-align:left;">å®¢æˆ·ç«¯è¯·æ±‚æ•°</td></tr><tr><td style="text-align:left;"><code>Reading</code></td><td style="text-align:left;">æ­£åœ¨è¯»å–å®¢æˆ·ç«¯è¯·æ±‚å¤´çš„è¿æ¥æ•°</td></tr><tr><td style="text-align:left;"><code>Writing</code></td><td style="text-align:left;">æ­£åœ¨å›å†™å“åº”çš„å½“å‰è¿æ¥æ•°</td></tr><tr><td style="text-align:left;"><code>Waiting</code></td><td style="text-align:left;">å½“å‰ç©ºé—²çš„å®¢æˆ·ç«¯è¿æ¥æ•°</td></tr></tbody></table><h3 id="è®¿é—®æ§åˆ¶" tabindex="-1">è®¿é—®æ§åˆ¶ <a class="header-anchor" href="#è®¿é—®æ§åˆ¶" aria-label="Permalink to â€œè®¿é—®æ§åˆ¶â€">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># å…è®¸æŒ‡å®šçš„ç½‘ç»œåœ°å€è®¿é—®</span></span>
<span class="line"><span style="color:#88846F;"># module:   ngx_http_access_module</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	allow address | CIDR | unix: | all;</span></span>
<span class="line"><span style="color:#88846F;"># default:	â€”</span></span>
<span class="line"><span style="color:#88846F;"># context:	http, server, location</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># æ‹’ç»æŒ‡å®šçš„ç½‘ç»œåœ°å€è®¿é—®</span></span>
<span class="line"><span style="color:#88846F;"># module:   ngx_http_access_module</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	deny address | CIDR | unix: | all;</span></span>
<span class="line"><span style="color:#88846F;"># default:	â€”</span></span>
<span class="line"><span style="color:#88846F;"># context:	http, server, location, limit_except</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># åªå…è®¸localhostå’Œ172.17.0.0/16æ®µçš„åœ°å€è®¿é—®</span></span>
<span class="line"><span style="color:#A6E22E;">location</span><span style="color:#E6DB74;"> /ngx_status</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">    stub_status</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#A6E22E;">    allow</span><span style="color:#AE81FF;"> 127.0.0.1</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    allow</span><span style="color:#E6DB74;"> 172.17.0.0/16</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    deny</span><span style="color:#E6DB74;"> all</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="é™æµ" tabindex="-1">é™æµ <a class="header-anchor" href="#é™æµ" aria-label="Permalink to â€œé™æµâ€">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># è®¾ç½®è¯¥limit_reqå…±äº«åŒºåŸŸå‚æ•°</span></span>
<span class="line"><span style="color:#88846F;"># module:   ngx_http_limit_req_module</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	limit_req_zone key zone=name:size rate=rate [sync];</span></span>
<span class="line"><span style="color:#88846F;"># default:	â€”</span></span>
<span class="line"><span style="color:#88846F;"># context:	http</span></span>
<span class="line"><span style="color:#88846F;">## key å®šä¹‰ç”¨äºé™åˆ¶é€Ÿç‡çš„ä¾æ®,æ­¤å¤„ä½¿ç”¨$binary_remote_addræ˜¯å› ä¸ºæ¯”$remote_addrå ç”¨æ›´å°çš„å†…å­˜ç©ºé—´</span></span>
<span class="line"><span style="color:#88846F;">## zone å®šä¹‰å…±äº«åŒºåŸŸåç§°å’Œå¤§å°, 1må¤§çº¦èƒ½å­˜å‚¨8000ä¸ª$binary_remote_addr(64ä½)</span></span>
<span class="line"><span style="color:#88846F;">## rate æŒ‡å®šè¯·æ±‚é€Ÿç‡(r/s)æˆ–(r/m), è¯¥ç¤ºä¾‹ä¸­è¯·æ±‚é€Ÿç‡é™åˆ¶ä¸ºæ¯ç§’10ä¸ªè¯·æ±‚, å³æ¯100æ¯«ç§’1ä¸ª, è¶…è¿‡è¯¥é™åˆ¶é€Ÿç‡çš„è¯·æ±‚ä¼šè¿”å›503</span></span>
<span class="line"><span style="color:#A6E22E;">limit_req_zone</span><span style="color:#F8F8F2;"> $binary_remote_addr </span><span style="color:#E6DB74;">zone=mylimit:10m</span><span style="color:#E6DB74;"> rate=10r/s</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># è®¾ç½®limit_reqçš„å…±äº«åŒºåŸŸåç§°å’Œçªå‘è¯·æ±‚å¤§å°</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	limit_req zone=name [burst=number] [nodelay | delay=number];</span></span>
<span class="line"><span style="color:#88846F;"># default:	â€”</span></span>
<span class="line"><span style="color:#88846F;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#88846F;">## burst è¡¨ç¤ºå®¢æˆ·ç«¯å¯ä»¥è¶…è¿‡åŒºåŸŸæŒ‡å®šé€Ÿç‡çš„è¯·æ±‚æ•°</span></span>
<span class="line"><span style="color:#88846F;">## nodelay è¡¨ç¤ºè¯¥è¯·æ±‚ä¼šåŠæ—¶å¤„ç†, ä¸ä¼šæ”¾åˆ°è¯·æ±‚é˜Ÿåˆ—ä¸­</span></span>
<span class="line"><span style="color:#A6E22E;">server</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">    location</span><span style="color:#E6DB74;"> /apis</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">        limit_req</span><span style="color:#E6DB74;"> zone=mylimit</span><span style="color:#E6DB74;"> burst=</span><span style="color:#AE81FF;">5</span><span style="color:#E6DB74;"> nodelay</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;"># è®¾ç½®limit_connå…±äº«åŒºåŸŸå‚æ•°</span></span>
<span class="line"><span style="color:#88846F;"># module:   ngx_http_limit_conn_module</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	limit_conn_zone key zone=name:size;</span></span>
<span class="line"><span style="color:#88846F;"># default:	â€”</span></span>
<span class="line"><span style="color:#88846F;"># context:	http</span></span>
<span class="line"><span style="color:#A6E22E;">limit_conn_zone</span><span style="color:#F8F8F2;"> $binary_remote_addr </span><span style="color:#E6DB74;">zone=addr:10m</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># è®¾ç½®ç»™å®škeyçš„å…±äº«åŒºåŸŸå’Œå…è®¸çš„æœ€å¤§è¿æ¥æ•°</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	limit_conn zone number;</span></span>
<span class="line"><span style="color:#88846F;"># default:	â€”</span></span>
<span class="line"><span style="color:#88846F;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#A6E22E;">server</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">    location</span><span style="color:#E6DB74;"> /download/</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">        limit_conn</span><span style="color:#E6DB74;"> addr</span><span style="color:#AE81FF;"> 2</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h3 id="æ¨¡æ‹Ÿè·¨åŸŸ" tabindex="-1">æ¨¡æ‹Ÿè·¨åŸŸ <a class="header-anchor" href="#æ¨¡æ‹Ÿè·¨åŸŸ" aria-label="Permalink to â€œæ¨¡æ‹Ÿè·¨åŸŸâ€">â€‹</a></h3><p>step01 å¿«é€Ÿå¯åŠ¨nginx</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F92672;">version</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&quot;3&quot;</span></span>
<span class="line"><span style="color:#F92672;">services</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F92672;">  nginx</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F92672;">    hostname</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">nginx</span></span>
<span class="line"><span style="color:#F92672;">    image</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">nginx:alpine</span></span>
<span class="line"><span style="color:#F92672;">    container_name</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">nginx</span></span>
<span class="line"><span style="color:#F92672;">    volumes</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">      - </span><span style="color:#E6DB74;">./conf:/etc/nginx</span></span>
<span class="line"><span style="color:#F92672;">    ports</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">      - </span><span style="color:#E6DB74;">&quot;10000:10000&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">      - </span><span style="color:#E6DB74;">&quot;9000:9000&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">      - </span><span style="color:#E6DB74;">&quot;8000:8000&quot;</span></span>
<span class="line"><span style="color:#F92672;">    logging</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F92672;">      driver</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">json-file</span></span>
<span class="line"><span style="color:#F92672;">      options</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F92672;">        max-size</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">100m</span></span>
<span class="line"><span style="color:#F92672;">        max-file</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&quot;3&quot;</span></span>
<span class="line"><span style="color:#F92672;">    restart</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">on-failure</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>step02 <code>/etc/nginx/conf.d/default.conf</code></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#A6E22E;">server</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">    listen</span><span style="color:#AE81FF;">       10000</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server_name</span><span style="color:#E6DB74;">  localhost</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    location</span><span style="color:#E6DB74;"> /</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">        root</span><span style="color:#E6DB74;">   /etc/nginx/html</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">        index</span><span style="color:#E6DB74;">  index.html</span><span style="color:#E6DB74;"> index.htm</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6E22E;">server</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">    listen</span><span style="color:#AE81FF;">       9000</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server_name</span><span style="color:#E6DB74;">  localhost</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    location</span><span style="color:#E6DB74;"> /</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">        proxy_pass</span><span style="color:#E6DB74;"> http://localhost:8000</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6E22E;">server</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">    listen</span><span style="color:#AE81FF;">       8000</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server_name</span><span style="color:#E6DB74;">  localhost</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    location</span><span style="color:#E6DB74;"> /</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">        default_type</span><span style="color:#E6DB74;"> application/json</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">        return</span><span style="color:#AE81FF;"> 200</span><span style="color:#E6DB74;"> &#39;{&quot;code&quot;:&quot;0000&quot;,&quot;msg&quot;:&quot;success&quot;}&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>step03 <code>/etc/nginx/html/index.html</code></p><div class="language-html line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F8F8F2;">&lt;</span><span style="color:#F92672;">html</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">&lt;</span><span style="color:#F92672;">div</span><span style="color:#F8F8F2;">&gt;CORS&lt;/</span><span style="color:#F92672;">div</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">&lt;</span><span style="color:#F92672;">script</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#A6E22E;">fetch</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;http://192.168.10.11:9000/&quot;</span><span style="color:#F8F8F2;">, {</span></span>
<span class="line"><span style="color:#E6DB74;">  &quot;headers&quot;</span><span style="color:#F8F8F2;">: {</span></span>
<span class="line"><span style="color:#E6DB74;">    &quot;accept&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&quot;application/json&quot;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#E6DB74;">  &quot;body&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#AE81FF;">null</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#E6DB74;">  &quot;method&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&quot;GET&quot;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">}).</span><span style="color:#A6E22E;">then</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">res</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">   console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;res: &quot;</span><span style="color:#F8F8F2;">, res)</span></span>
<span class="line"><span style="color:#F8F8F2;">}).</span><span style="color:#A6E22E;">catch</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">err</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">   console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;err: &quot;</span><span style="color:#F8F8F2;">, err)</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"><span style="color:#F8F8F2;">&lt;/</span><span style="color:#F92672;">script</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">&lt;/</span><span style="color:#F92672;">html</span><span style="color:#F8F8F2;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>step04 æµè§ˆå™¨æµ‹è¯•è®¿é—®<code>http://192.168.10.11:10000</code></p><h3 id="å¤„ç†è·¨åŸŸ" tabindex="-1">å¤„ç†è·¨åŸŸ <a class="header-anchor" href="#å¤„ç†è·¨åŸŸ" aria-label="Permalink to â€œå¤„ç†è·¨åŸŸâ€">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#A6E22E;">server</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">    listen</span><span style="color:#AE81FF;">       9000</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server_name</span><span style="color:#E6DB74;">  localhost</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    location</span><span style="color:#E6DB74;"> /</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#88846F;">        # add_header &#39;Access-Control-Allow-Origin&#39; &#39;*&#39; always;</span></span>
<span class="line highlighted"><span style="color:#A6E22E;">        add_header</span><span style="color:#E6DB74;"> &#39;Access-Control-Allow-Origin&#39;</span><span style="color:#F8F8F2;"> $http_origin </span><span style="color:#E6DB74;">always</span><span style="color:#F8F8F2;">;</span></span>
<span class="line highlighted"><span style="color:#A6E22E;">        add_header</span><span style="color:#E6DB74;"> &#39;Access-Control-Allow-Credentials&#39;</span><span style="color:#E6DB74;"> &#39;true&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line highlighted"><span style="color:#A6E22E;">        add_header</span><span style="color:#E6DB74;"> &#39;Access-Control-Allow-Methods&#39;</span><span style="color:#E6DB74;"> &#39;GET, POST, OPTIONS&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line highlighted"><span style="color:#A6E22E;">        add_header</span><span style="color:#E6DB74;"> &#39;Access-Control-Allow-Headers&#39;</span><span style="color:#E6DB74;"> &#39;DNT,Authorization,Accept,Origin,Keep-Alive,User-Agent,X-Mx-ReqToken,X-Data-Type,X-Auth-Token,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line highlighted"><span style="color:#A6E22E;">        add_header</span><span style="color:#E6DB74;"> &#39;Access-Control-Expose-Headers&#39;</span><span style="color:#E6DB74;"> &#39;Content-Length,Content-Range&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line highlighted"><wbr></span>
<span class="line highlighted"><span style="color:#F92672;">        if</span><span style="color:#F8F8F2;"> ($request_method = </span><span style="color:#E6DB74;">&#39;OPTIONS&#39;</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line highlighted"><span style="color:#F92672;">                return</span><span style="color:#AE81FF;"> 204</span><span style="color:#F8F8F2;">;</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">        }</span></span>
<span class="line highlighted"><wbr></span>
<span class="line highlighted"><span style="color:#A6E22E;">        proxy_set_header</span><span style="color:#E6DB74;"> origin</span><span style="color:#E6DB74;"> &#39;&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">        proxy_pass</span><span style="color:#E6DB74;"> http://192.168.10.11:8000</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="åŠ¨æ€è·¯ç”±" tabindex="-1">åŠ¨æ€è·¯ç”± <a class="header-anchor" href="#åŠ¨æ€è·¯ç”±" aria-label="Permalink to â€œåŠ¨æ€è·¯ç”±â€">â€‹</a></h3><p>âš¡ä¾‹å¦‚<code>vue</code>é¡¹ç›®ä¸­ä½¿ç”¨åŠ¨æ€è·¯ç”±ï¼Œé€šå¸¸é…ç½®åœ¨é¡µé¢åˆ·æ–°åä¼šè·å–ä¸åˆ°èµ„æº</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#A6E22E;">location</span><span style="color:#E6DB74;"> /</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">    root</span><span style="color:#E6DB74;"> /usr/share/nginx/html/dist</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    index</span><span style="color:#E6DB74;"> index.html</span><span style="color:#E6DB74;"> index.htm</span><span style="color:#F8F8F2;">;</span></span>
<span class="line highlighted"><span style="color:#A6E22E;">    try_files</span><span style="color:#F8F8F2;"> $uri $uri</span><span style="color:#E6DB74;">/</span><span style="color:#E6DB74;"> /index.html</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="streamå››å±‚ä»£ç†" tabindex="-1">streamå››å±‚ä»£ç† <a class="header-anchor" href="#streamå››å±‚ä»£ç†" aria-label="Permalink to â€œstreamå››å±‚ä»£ç†â€">â€‹</a></h2><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># ä¸»è¦ç”¨äºå››å±‚ä»£ç†çš„é…ç½®ï¼Œæ¯”å¦‚æ•°æ®åº“ç­‰</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	stream { ... }</span></span>
<span class="line"><span style="color:#88846F;"># default:	â€”</span></span>
<span class="line"><span style="color:#88846F;"># context:	main</span></span>
<span class="line"><span style="color:#A6E22E;">stream</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#88846F;">    # æ˜¯å¦å¼€å¯tcp_nodelay,è¡¨ç¤ºæ”¶åˆ°æ•°æ®åŒ…åå°½å¿«å‘é€å‡ºå»</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	tcp_nodelay on | off;</span></span>
<span class="line"><span style="color:#88846F;">    # default:	</span></span>
<span class="line"><span style="color:#88846F;">    # tcp_nodelay on;</span></span>
<span class="line"><span style="color:#88846F;">    # Context:	stream, server</span></span>
<span class="line"><span style="color:#A6E22E;">    tcp_nodelay</span><span style="color:#E6DB74;"> on</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="upstream-1" tabindex="-1">upstream <a class="header-anchor" href="#upstream-1" aria-label="Permalink to â€œupstreamâ€">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># ç”¨äºå®šä¹‰å¯ä»¥ç”±proxy_passæŒ‡ä»¤å¼•ç”¨çš„æœåŠ¡å™¨ç»„, å¯ä»¥æŒ‡å®šæœåŠ¡èŠ‚ç‚¹çš„åœ°å€å’Œç›¸å…³çš„å‚æ•°, æœåŠ¡å™¨åœ°å€å¯ä»¥æ˜¯å¸¦ç«¯å£çš„åŸŸåæˆ–è€…ipåœ°å€ã€unixå¥—æ¥å­—è·¯å¾„, å‚æ•°å¯ä»¥è®¾ç½®æœåŠ¡æƒé‡ã€å¥åº·æ£€æŸ¥ç­‰</span></span>
<span class="line"><span style="color:#88846F;"># module: ngx_stream_upstream_module</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	server address [parameters];</span></span>
<span class="line"><span style="color:#88846F;"># default:	â€”</span></span>
<span class="line"><span style="color:#88846F;"># context:	stream</span></span>
<span class="line"><span style="color:#A6E22E;">upstream</span><span style="color:#E6DB74;"> backend</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> db1.example.com:13306</span><span style="color:#E6DB74;"> weight=</span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 127.0.0.1:13306</span><span style="color:#E6DB74;"> max_fails=</span><span style="color:#AE81FF;">3</span><span style="color:#E6DB74;"> fail_timeout=30s</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> unix:/tmp/backend2</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> db2.example.com:13306</span><span style="color:#E6DB74;">  backup</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="server-1" tabindex="-1">server <a class="header-anchor" href="#server-1" aria-label="Permalink to â€œserverâ€">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#A6E22E;">server</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#88846F;">    # æŒ‡å®šç›‘å¬çš„ç«¯å£åè®®ç­‰</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	listen address:port [ssl] [udp] [proxy_protocol] [fastopen=number] [backlog=number] [rcvbuf=size] [sndbuf=size] [bind] [ipv6only=on|off] [reuseport] [so_keepalive=on|off|[keepidle]:[keepintvl]:[keepcnt]];</span></span>
<span class="line"><span style="color:#88846F;">    # default:	â€”</span></span>
<span class="line"><span style="color:#88846F;">    # context:	server</span></span>
<span class="line"><span style="color:#A6E22E;">    listen</span><span style="color:#AE81FF;"> 60001</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # å’Œåç«¯æœåŠ¡å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´</span></span>
<span class="line"><span style="color:#88846F;">    # module:   ngx_stream_proxy_module</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	proxy_connect_timeout time;</span></span>
<span class="line"><span style="color:#88846F;">    # default:	proxy_connect_timeout 60s;</span></span>
<span class="line"><span style="color:#88846F;">    # context:	stream, server</span></span>
<span class="line"><span style="color:#A6E22E;">    proxy_connect_timeout</span><span style="color:#E6DB74;"> 1s</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # è®¾ç½®å®¢æˆ·ç«¯æˆ–ä»£ç†æœåŠ¡å™¨ä¸Šä¸¤ä¸ªè¿ç»­è¯»å–æˆ–å†™å…¥æ“ä½œä¹‹é—´çš„è¶…æ—¶æ—¶é—´, å¦‚æœåœ¨æ­¤æ—¶é—´å†…æœªä¼ è¾“ä»»ä½•æ•°æ®, è¿æ¥å°†hä¼šå…³é—­ã€‚</span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	proxy_timeout timeout;</span></span>
<span class="line"><span style="color:#88846F;">    # default:	proxy_timeout 10m;</span></span>
<span class="line"><span style="color:#88846F;">    # context:	stream, server</span></span>
<span class="line"><span style="color:#A6E22E;">    proxy_timeout</span><span style="color:#E6DB74;"> 30s</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#88846F;">    # </span></span>
<span class="line"><span style="color:#88846F;">    # syntax:	proxy_pass address;</span></span>
<span class="line"><span style="color:#88846F;">    # default:	â€”</span></span>
<span class="line"><span style="color:#88846F;">    # context:	server</span></span>
<span class="line"><span style="color:#A6E22E;">    proxy_pass</span><span style="color:#E6DB74;"> backend</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="æ—¥å¿—é…ç½®-1" tabindex="-1">æ—¥å¿—é…ç½® <a class="header-anchor" href="#æ—¥å¿—é…ç½®-1" aria-label="Permalink to â€œæ—¥å¿—é…ç½®â€">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># è®¾ç½®å››å±‚ä»£ç†çš„æ—¥å¿—æ ¼å¼</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	log_format name [escape=default|json|none] string ...;</span></span>
<span class="line"><span style="color:#88846F;"># default:	â€”</span></span>
<span class="line"><span style="color:#88846F;"># context:	stream</span></span>
<span class="line"><span style="color:#A6E22E;">log_format</span><span style="color:#E6DB74;"> l4log</span><span style="color:#E6DB74;"> &#39;$remote_addr [$time_local] &#39;</span></span>
<span class="line"><span style="color:#A6E22E;">                 &#39;$protocol $status $bytes_sent $bytes_received &#39;</span></span>
<span class="line"><span style="color:#A6E22E;">                 &#39;$session_time &quot;$upstream_addr&quot; &#39;</span></span>
<span class="line"><span style="color:#A6E22E;">                 &#39;&quot;$upstream_bytes_sent&quot; &quot;$upstream_bytes_received&quot; &quot;$upstream_connect_time&quot;&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># Syntax:	access_log path format [buffer=size] [gzip[=level]] [flush=time] [if=condition];</span></span>
<span class="line"><span style="color:#88846F;">#        	access_log off;</span></span>
<span class="line"><span style="color:#88846F;"># default:	access_log off;</span></span>
<span class="line"><span style="color:#88846F;"># context:	stream, server</span></span>
<span class="line"><span style="color:#A6E22E;">access_log</span><span style="color:#E6DB74;"> /var/log/nginx/access.log</span><span style="color:#E6DB74;"> l4log</span><span style="color:#F8F8F2;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="è´Ÿè½½å‡è¡¡ç®—æ³•" tabindex="-1">è´Ÿè½½å‡è¡¡ç®—æ³• <a class="header-anchor" href="#è´Ÿè½½å‡è¡¡ç®—æ³•" aria-label="Permalink to â€œè´Ÿè½½å‡è¡¡ç®—æ³•â€">â€‹</a></h2><h3 id="è½®è¯¢" tabindex="-1">è½®è¯¢ <a class="header-anchor" href="#è½®è¯¢" aria-label="Permalink to â€œè½®è¯¢â€">â€‹</a></h3><p>è½®è¯¢(Round Robin): é»˜è®¤ç®—æ³•,è¯·æ±‚ä¼šä¾æ¬¡è½¬å‘åˆ°åç«¯æœåŠ¡èŠ‚ç‚¹</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># module:   ngx_http_upstream_module</span></span>
<span class="line"><span style="color:#88846F;"># context:	upstream</span></span>
<span class="line"><span style="color:#A6E22E;">upstream</span><span style="color:#E6DB74;"> backend</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.100:8080</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.101:8080</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="åŠ æƒè½®è¯¢" tabindex="-1">åŠ æƒè½®è¯¢ <a class="header-anchor" href="#åŠ æƒè½®è¯¢" aria-label="Permalink to â€œåŠ æƒè½®è¯¢â€">â€‹</a></h3><p>åŠ æƒè½®è¯¢(Weight): å³weightè¶Šå¤§, åˆ†é…åˆ°çš„è¿æ¥è¶Šå¤š</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># module:   ngx_http_upstream_module</span></span>
<span class="line"><span style="color:#88846F;"># context:	upstream</span></span>
<span class="line"><span style="color:#A6E22E;">upstream</span><span style="color:#E6DB74;"> backend</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.100:8080</span><span style="color:#E6DB74;"> weight=</span><span style="color:#AE81FF;">4</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.101:8080</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="æœ€å°‘è¿æ¥" tabindex="-1">æœ€å°‘è¿æ¥ <a class="header-anchor" href="#æœ€å°‘è¿æ¥" aria-label="Permalink to â€œæœ€å°‘è¿æ¥â€">â€‹</a></h3><p>æœ€å°‘è¿æ¥ç®—æ³•(Least Connections): ä¼˜å…ˆå°†è¯·æ±‚è½¬å‘åˆ°è¿æ¥æ•°å°‘çš„æœåŠ¡èŠ‚ç‚¹</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># module:   ngx_http_upstream_module</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	least_conn;</span></span>
<span class="line"><span style="color:#88846F;"># default:	â€”</span></span>
<span class="line"><span style="color:#88846F;"># context:	upstream</span></span>
<span class="line"><span style="color:#A6E22E;">upstream</span><span style="color:#E6DB74;"> backend</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">    least_conn</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.100:8080</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.101:8080</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="å“ˆå¸Œ" tabindex="-1">å“ˆå¸Œ <a class="header-anchor" href="#å“ˆå¸Œ" aria-label="Permalink to â€œå“ˆå¸Œâ€">â€‹</a></h3><p>å“ˆå¸Œ(hash): åŸºäºhashçš„è°ƒåº¦ç®—æ³•, è®¡ç®—keyçš„å“ˆå¸Œå€¼, æ ¹æ®è®¡ç®—ç»“æœå°†è¯·æ±‚è½¬å‘è‡³ç‰¹å®šçš„æœåŠ¡èŠ‚ç‚¹</p><p>ç®—æ³•:<code>hash(key) % node_counts = index</code></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯å½“node_counts(èŠ‚ç‚¹æ•°é‡)å‘ç”Ÿå˜åŒ–æ—¶, index(æœåŠ¡èŠ‚ç‚¹ç´¢å¼•)ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># module:   ngx_http_upstream_module</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	hash key;</span></span>
<span class="line"><span style="color:#88846F;"># default:	â€”</span></span>
<span class="line"><span style="color:#88846F;"># context:	upstream</span></span>
<span class="line"><span style="color:#A6E22E;">upstream</span><span style="color:#E6DB74;"> backend</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#66D9EF;">    hash</span><span style="color:#F8F8F2;"> $request_uri;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.100:8080</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.101:8080</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="ipå“ˆå¸Œ" tabindex="-1">IPå“ˆå¸Œ <a class="header-anchor" href="#ipå“ˆå¸Œ" aria-label="Permalink to â€œIPå“ˆå¸Œâ€">â€‹</a></h3><p>IPå“ˆå¸Œ(IP Hash): åŸºäºè¯·æ±‚çš„å®¢æˆ·ç«¯ipçš„hashå€¼, ç¡®ä¿æ¥è‡ªåŒä¸€å®¢æˆ·ç«¯çš„è¯·æ±‚å°†å§‹ç»ˆè½¬å‘åˆ°åŒä¸€æœåŠ¡èŠ‚ç‚¹, ä¸€èˆ¬ç”¨äºä¼šè¯ä¿æŒ</p><p>ç®—æ³•:<code>hash(client_ip) % node_counts = index</code></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯å½“node_counts(èŠ‚ç‚¹æ•°é‡)å‘ç”Ÿå˜åŒ–æ—¶, index(æœåŠ¡èŠ‚ç‚¹ç´¢å¼•)ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># module:   ngx_http_upstream_module</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	ip_hash;</span></span>
<span class="line"><span style="color:#88846F;"># default:	â€”</span></span>
<span class="line"><span style="color:#88846F;"># context:	upstream</span></span>
<span class="line"><span style="color:#A6E22E;">upstream</span><span style="color:#E6DB74;"> backend</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">    ip_hash</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.100:8080</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.101:8080</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="ä¸€è‡´æ€§å“ˆå¸Œ" tabindex="-1">ä¸€è‡´æ€§å“ˆå¸Œ <a class="header-anchor" href="#ä¸€è‡´æ€§å“ˆå¸Œ" aria-label="Permalink to â€œä¸€è‡´æ€§å“ˆå¸Œâ€">â€‹</a></h3><p>ä¸€è‡´æ€§å“ˆå¸Œ(Consistent Hash): åœ¨ä¸Šè¿°å“ˆå¸Œç®—æ³•ä¸­, å¦‚æœæœ‰å¤§é‡çš„è¯·æ±‚è°ƒåº¦åˆ°æŸä¸€æœåŠ¡èŠ‚ç‚¹, è€ŒæŸäº›æœåŠ¡èŠ‚ç‚¹ä¸å¯ç”¨æˆ–è€…æ–°å¢æœåŠ¡èŠ‚ç‚¹å¯¼è‡´æœåŠ¡èŠ‚ç‚¹æ•°é‡å˜åŒ–, åˆ™è¯¥ç®—æ³•ä¼šé‡æ–°è®¡ç®—ç»“æœ, ä»è€Œé€ æˆå¤§é‡çš„è¯·æ±‚è¢«è½¬ç§»å…¶ä»–èŠ‚ç‚¹å¤„ç†, åˆ™ä¼šè¯å¤±æ•ˆ, éœ€è¦å®¢æˆ·ç«¯é‡æ–°å»ºç«‹å›è¯ä¿æŒ; ä¸ºè§£å†³ä¸Šè¿°é—®é¢˜, å°±éœ€è¦ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œ</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;"># module:   ngx_http_upstream_module</span></span>
<span class="line"><span style="color:#88846F;"># syntax:	hash key consistent;</span></span>
<span class="line"><span style="color:#88846F;"># default:	â€”</span></span>
<span class="line"><span style="color:#88846F;"># context:	upstream</span></span>
<span class="line"><span style="color:#A6E22E;">upstream</span><span style="color:#E6DB74;"> backend01</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#66D9EF;">    hash</span><span style="color:#F8F8F2;"> $remote_addr </span><span style="color:#E6DB74;">consistent</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.100:8080</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#A6E22E;">    server</span><span style="color:#E6DB74;"> 192.168.10.101:8080</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div></div></main><footer class="VPDocFooter" data-v-7011f0d8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/vdocs/docs/middleware/nginx/at2kf0f2b3yf" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>æºç æ„å»ºnginxé•œåƒ</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/vdocs/docs/middleware/nginx/at2kf0f2b3yd" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>nginxé…ç½®ssl</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div><!--]--></div>
    
    
  </body>
</html>